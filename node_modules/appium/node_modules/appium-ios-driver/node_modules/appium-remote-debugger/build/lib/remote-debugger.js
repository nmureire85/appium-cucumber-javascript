"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RPC_RESPONSE_TIMEOUT_MS = exports.REMOTE_DEBUGGER_PORT = exports.DEBUGGER_TYPES = exports.RemoteDebugger = void 0;

require("source-map-support/register");

var _events = _interopRequireDefault(require("events"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumBaseDriver = require("appium-base-driver");

var _remoteDebuggerRpcClient = _interopRequireDefault(require("./remote-debugger-rpc-client"));

var _messageHandlers = _interopRequireDefault(require("./message-handlers"));

var _helpers = require("./helpers");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _path = _interopRequireDefault(require("path"));

let VERSION;

try {
  VERSION = require(_path.default.resolve(__dirname, '..', '..', 'package.json')).version;
} catch (ign) {}

const DEBUGGER_TYPES = {
  webkit: 1,
  webinspector: 2
};
exports.DEBUGGER_TYPES = DEBUGGER_TYPES;
const SELECT_APP_RETRIES = 20;
const REMOTE_DEBUGGER_PORT = 27753;
exports.REMOTE_DEBUGGER_PORT = REMOTE_DEBUGGER_PORT;
const RPC_RESPONSE_TIMEOUT_MS = 5000;
exports.RPC_RESPONSE_TIMEOUT_MS = RPC_RESPONSE_TIMEOUT_MS;
const PAGE_READY_TIMEOUT = 5000;
const RESPONSE_LOG_LENGTH = 100;
const GARBAGE_COLLECT_TIMEOUT = 5000;

class RemoteDebugger extends _events.default.EventEmitter {
  constructor(opts = {}) {
    super();

    if (VERSION) {
      _logger.default.info(`Remote Debugger version ${VERSION}`);
    }

    const {
      bundleId,
      platformVersion,
      debuggerType = DEBUGGER_TYPES.webinspector,
      isSafari = true,
      useNewSafari = false,
      pageLoadMs,
      host,
      port = REMOTE_DEBUGGER_PORT,
      socketPath,
      pageReadyTimeout = PAGE_READY_TIMEOUT,
      remoteDebugProxy,
      garbageCollectOnExecute = false,
      logFullResponse = false
    } = opts;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this.isSafari = isSafari;
    this.debuggerType = debuggerType;

    if (this.debuggerType === DEBUGGER_TYPES.webinspector) {
      this.useNewSafari = useNewSafari;
      this.pageLoadMs = pageLoadMs;

      _logger.default.debug(`useNewSafari --> ${this.useNewSafari}`);
    }

    this.garbageCollectOnExecute = garbageCollectOnExecute;
    this.host = host;
    this.port = port;
    this.socketPath = socketPath;
    this.remoteDebugProxy = remoteDebugProxy;
    this.pageReadyTimeout = pageReadyTimeout;
    this.logFullResponse = logFullResponse;
  }

  setup() {
    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this._navigatingToPage = false;
    this.specialCbs = {
      '_rpc_reportIdentifier:': _lodash.default.noop,
      '_rpc_forwardGetListing:': this.onPageChange.bind(this),
      '_rpc_reportConnectedApplicationList:': _lodash.default.noop,
      '_rpc_applicationConnected:': this.onAppConnect.bind(this),
      '_rpc_applicationDisconnected:': this.onAppDisconnect.bind(this),
      '_rpc_applicationUpdated:': this.onAppUpdate.bind(this),
      '_rpc_reportConnectedDriverList:': this.onReportDriverList.bind(this),
      pageLoad: this.pageLoad.bind(this),
      frameDetached: this.frameDetached.bind(this),
      targetCreated: this.onTargetCreated.bind(this),
      targetDestroyed: this.onTargetDestroyed.bind(this)
    };
    this.rpcClient = null;
  }

  teardown() {
    _logger.default.debug('Cleaning up listeners');

    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this.specialCbs = {};
    this.rpcClient = null;
    this.removeAllListeners(RemoteDebugger.EVENT_PAGE_CHANGE);
    this.removeAllListeners(RemoteDebugger.EVENT_DISCONNECT);
  }

  async connect() {
    this.setup();
    this.rpcClient = new _remoteDebuggerRpcClient.default({
      platformVersion: this.platformVersion,
      isSafari: this.isSafari,
      host: this.host,
      port: this.port,
      socketPath: this.socketPath,
      specialMessageHandlers: this.specialCbs,
      messageProxy: this.remoteDebugProxy,
      logFullResponse: this.logFullResponse
    });
    await this.rpcClient.connect();

    try {
      const appInfo = await this.setConnectionKey();

      _logger.default.debug('Connected to application');

      return appInfo;
    } catch (err) {
      await this.disconnect();
      return null;
    }
  }

  async disconnect() {
    await this.rpcClient.disconnect();
    this.emit(RemoteDebugger.EVENT_DISCONNECT, true);
    this.teardown();
  }

  isConnected() {
    return !!(this.rpcClient && this.rpcClient.isConnected());
  }

  async setConnectionKey() {
    return await new _bluebird.default((resolve, reject) => {
      let connectCb = apps => {
        if (_lodash.default.isUndefined(apps) || _lodash.default.keys(apps).length === 0) {
          _logger.default.debug('Received no apps from remote debugger. Unable to connect.');

          return resolve(this.appDict);
        }

        let newDict = {};

        for (const dict of _lodash.default.values(apps)) {
          let [id, entry] = (0, _helpers.appInfoFromDict)(dict);
          newDict[id] = entry;
        }

        _lodash.default.defaults(this.appDict, newDict);

        resolve(newDict);
      };

      this.rpcClient.setSpecialMessageHandler('_rpc_reportConnectedApplicationList:', reject, connectCb);

      _logger.default.debug('Sending connection key request');

      return (async () => {
        let [simNameKey, simBuildKey, simPlatformVersion] = await this.rpcClient.send('setConnectionKey');

        _logger.default.debug(`Sim name: ${simNameKey}`);

        _logger.default.debug(`Sim build: ${simBuildKey}`);

        _logger.default.debug(`Sim platform version: ${simPlatformVersion}`);
      })();
    });
  }

  updateAppsWithDict(dict) {
    this.appDict = this.appDict || {};
    let [id, entry] = (0, _helpers.appInfoFromDict)(dict);

    if (this.appDict[id]) {
      entry.pageArray = this.appDict[id].pageArray;
    }

    this.appDict[id] = entry;

    if (_lodash.default.isUndefined(entry.pageArray)) {
      entry.pageArray = (0, _helpers.deferredPromise)();
    }

    if (!this.appIdKey) {
      this.appIdKey = (0, _helpers.getDebuggerAppKey)(this.bundleId, this.platformVersion, this.appDict);
    }
  }

  logApplicationDictionary(apps) {
    function getValueString(key, value) {
      if (_lodash.default.isFunction(value)) {
        return '[Function]';
      }

      if (key === 'pageArray' && !_lodash.default.isArray(value)) {
        return `'Waiting for data'`;
      }

      return JSON.stringify(value);
    }

    _logger.default.debug('Current applications available:');

    for (const [app, info] of _lodash.default.toPairs(apps)) {
      _logger.default.debug(`    Application: '${app}'`);

      for (const [key, value] of _lodash.default.toPairs(info)) {
        if (key === 'pageArray' && Array.isArray(value) && value.length) {
          _logger.default.debug(`        ${key}:`);

          for (const page of value) {
            let prefix = '- ';

            for (const [k, v] of _lodash.default.toPairs(page)) {
              _logger.default.debug(`          ${prefix}${k}: ${JSON.stringify(v)}`);

              prefix = '  ';
            }
          }
        } else {
          const valueString = getValueString(key, value);

          _logger.default.debug(`        ${key}: ${valueString}`);
        }
      }
    }
  }

  async selectApp(currentUrl = null, maxTries = SELECT_APP_RETRIES, ignoreAboutBlankUrl = false) {
    _logger.default.debug('Selecting application');

    if (!this.appDict || _lodash.default.keys(this.appDict).length === 0) {
      _logger.default.debug('No applications currently connected.');

      return [];
    }

    let pageDict, appIdKey;

    appLoop: for (let i = 0; i < maxTries; i++) {
      this.logApplicationDictionary(this.appDict);
      let possibleAppIds = (0, _helpers.getPossibleDebuggerAppKeys)(this.bundleId, this.platformVersion, this.appDict);

      _logger.default.debug(`Trying out the possible app ids: ${possibleAppIds.join(', ')}`);

      for (const attemptedAppIdKey of possibleAppIds) {
        try {
          _logger.default.debug(`Selecting app ${attemptedAppIdKey} (try #${i + 1} of ${maxTries})`);

          [appIdKey, pageDict] = await this.rpcClient.selectApp(attemptedAppIdKey, this.onAppConnect.bind(this));

          if (_lodash.default.isEmpty(pageDict)) {
            _logger.default.debug('Empty page dictionary received. Trying again.');

            continue;
          }

          this.appDict[appIdKey].pageArray = (0, _helpers.pageArrayFromDict)(pageDict);
          let found = false;

          dictLoop: for (const appDict of _lodash.default.values(this.appDict)) {
            if (found) break;

            if (!appDict || !appDict.pageArray) {
              continue;
            }

            if (appDict.pageArray.promise) {
              try {
                await _bluebird.default.resolve(appDict.pageArray.promise).timeout(10000);
              } catch (err) {
                if (!(err instanceof _bluebird.default.TimeoutError)) {
                  throw err;
                }

                continue;
              }
            }

            for (const dict of appDict.pageArray || []) {
              if ((!ignoreAboutBlankUrl || dict.url !== 'about:blank') && (!currentUrl || dict.url === currentUrl || dict.url === `${currentUrl}/`)) {
                appIdKey = appDict.id;
                pageDict = dict;
                found = true;
                break dictLoop;
              }
            }
          }

          if (!found) {
            if (currentUrl) {
              _logger.default.debug(`Received app, but expected url ('${currentUrl}') was not found. Trying again.`);
            } else {
              _logger.default.debug('Received app, but no match was found. Trying again.');
            }

            pageDict = null;
            continue;
          }

          break appLoop;
        } catch (err) {
          _logger.default.debug(`Error checking application: '${err.message}'. Retrying connection`);
        }
      }
    }

    if (!pageDict) {
      _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
    }

    if (this.appIdKey !== appIdKey) {
      _logger.default.debug(`Received altered app id, updating from '${this.appIdKey}' to '${appIdKey}'`);

      this.appIdKey = appIdKey;
    }

    const pagePromises = Object.values(this.appDict).filter(app => !!app.pageArray && !!app.pageArray.promise).map(app => app.pageArray.promise);

    if (pagePromises.length) {
      _logger.default.debug(`Waiting for ${pagePromises.length} pages to be fulfilled`);

      await _bluebird.default.any([_bluebird.default.delay(30000), _bluebird.default.all(pagePromises)]);
    }

    this.logApplicationDictionary(this.appDict);
    const pageArray = _lodash.default.isEmpty(this.appDict[appIdKey].pageArray) ? (0, _helpers.pageArrayFromDict)(pageDict) : this.appDict[appIdKey].pageArray;

    _logger.default.debug(`Finally selecting app ${this.appIdKey}: ${(0, _helpers.simpleStringify)(pageArray)}`);

    let fullPageArray = [];

    for (const [app, info] of _lodash.default.toPairs(this.appDict)) {
      if (!_lodash.default.isArray(info.pageArray)) continue;
      let id = app.replace('PID:', '');

      for (const page of info.pageArray) {
        if (page.url && (!ignoreAboutBlankUrl || page.url !== 'about:blank') && (!currentUrl || page.url === currentUrl || page.url === `${currentUrl}/`)) {
          let pageDict = _lodash.default.clone(page);

          pageDict.id = `${id}.${pageDict.id}`;
          fullPageArray.push(pageDict);
        }
      }
    }

    return fullPageArray;
  }

  async selectPage(appIdKey, pageIdKey, skipReadyCheck = false) {
    this.appIdKey = `PID:${appIdKey}`;
    this.pageIdKey = pageIdKey;

    _logger.default.debug(`Selecting page '${pageIdKey}' on app '${this.appIdKey}' and forwarding socket setup`);

    await this.rpcClient.send('setSenderKey', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    _logger.default.debug('Sender key set');

    this.rpcClient.shouldCheckForTarget = true;
    await this.rpcClient.send('enablePage', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType,
      targetId: 'page-1'
    });

    _logger.default.debug('Enabled activity on page');

    if (!skipReadyCheck && !(await this.checkPageIsReady())) {
      await this.pageUnload();
    }
  }

  async executeAtom(atom, args, frames) {
    if (!this.rpcClient.connected) throw new Error('Remote debugger is not connected');

    _logger.default.debug(`Executing atom '${atom}'`);

    const script = await (0, _helpers.getScriptForAtom)(atom, args, frames);
    const value = await this.execute(script, true);

    _logger.default.debug(`Received result for atom '${atom}' execution: ${_lodash.default.truncate((0, _helpers.simpleStringify)(value), {
      length: RESPONSE_LOG_LENGTH
    })}`);

    return value;
  }

  async executeAtomAsync(atom, args, frames, responseUrl) {
    let asyncCallBack = `function (res) { xmlHttp = new XMLHttpRequest(); ` + `xmlHttp.open('POST', '${responseUrl}', true);` + `xmlHttp.setRequestHeader('Content-type','application/json'); ` + `xmlHttp.send(res); }`;
    let script = await (0, _helpers.getScriptForAtom)(atom, args, frames, asyncCallBack);
    await this.execute(script);
  }

  frameDetached() {
    this.emit(RemoteDebugger.EVENT_FRAMES_DETACHED);
  }

  async pageLoad(startPageLoadMs, pageLoadVerifyHook) {
    let timeoutMs = 500;
    let start = startPageLoadMs || Date.now();

    _logger.default.debug('Page loaded, verifying whether ready');

    const verify = async () => {
      this.pageLoadDelay = _appiumSupport.util.cancellableDelay(timeoutMs);

      try {
        await this.pageLoadDelay;
      } catch (err) {
        if (err instanceof _bluebird.default.CancellationError) {
          return;
        }
      }

      if (!this.appIdKey) {
        _logger.default.debug('Not connected to an application. Ignoring page load');

        return;
      }

      if (_lodash.default.isFunction(pageLoadVerifyHook)) {
        await pageLoadVerifyHook();
      }

      const ready = await this.checkPageIsReady();

      if (ready || this.pageLoadMs > 0 && start + this.pageLoadMs < Date.now()) {
        _logger.default.debug('Page is ready');

        this.pageLoading = false;
      } else {
        _logger.default.debug('Page was not ready, retrying');

        await verify();
      }
    };

    await verify();
  }

  cancelPageLoad() {
    _logger.default.debug('Unregistering from page readiness notifications');

    this.pageLoading = false;

    if (this.pageLoadDelay) {
      this.pageLoadDelay.cancel();
    }
  }

  async pageUnload() {
    _logger.default.debug('Page unloading');

    this.pageLoading = true;
    await this.waitForDom();
  }

  async waitForDom(startPageLoadMs, pageLoadVerifyHook) {
    _logger.default.debug('Waiting for dom...');

    await this.pageLoad(startPageLoadMs, pageLoadVerifyHook);
  }

  async checkPageIsReady() {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey
    });
    if (errors) throw new Error(errors);

    _logger.default.debug('Checking document readyState');

    const readyCmd = '(function (){ return document.readyState; })()';
    let readyState = 'loading';

    try {
      readyState = await _bluebird.default.resolve(this.execute(readyCmd, true)).timeout(this.pageReadyTimeout);
    } catch (err) {
      if (!(err instanceof _bluebird.default.TimeoutError)) {
        throw err;
      }

      _logger.default.debug(`Page readiness check timed out after ${this.pageReadyTimeout}ms`);

      return false;
    }

    _logger.default.debug(`Document readyState is '${readyState}'`);

    return readyState === 'complete';
  }

  async navToUrl(url, pageLoadVerifyHook) {
    if (this.debuggerType === DEBUGGER_TYPES.webinspector) {
      const errors = (0, _helpers.checkParams)({
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
      if (errors) throw new Error(errors);
    }

    this._navigatingToPage = true;

    try {
      _logger.default.debug(`Navigating to new URL: '${url}'`);

      await this.rpcClient.send('setUrl', {
        url,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey,
        debuggerType: this.debuggerType
      });

      if (!this.useNewSafari) {
        await _bluebird.default.delay(1000);
      }

      if (this.debuggerType === DEBUGGER_TYPES.webinspector) {
        await this.waitForFrameNavigated();
      }

      await this.waitForDom(Date.now(), pageLoadVerifyHook);
    } finally {
      this._navigatingToPage = false;
    }
  }

  async waitForFrameNavigated() {
    return await new _bluebird.default(async (resolve, reject) => {
      _logger.default.debug('Waiting for frame navigated message...');

      let startMs = Date.now();

      let navEventListener = value => {
        _logger.default.debug(`Frame navigated in ${(Date.now() - startMs) / 1000} sec from source: ${value}`);

        if (this.navigationDelay) {
          this.navigationDelay.cancel();
        }

        resolve(value);
      };

      this.rpcClient.setSpecialMessageHandler('Page.frameNavigated', reject, navEventListener);

      if (!this.useNewSafari || this.pageLoadMs >= 0) {
        let timeout = this.useNewSafari ? this.pageLoadMs : 500;
        this.navigationDelay = _appiumSupport.util.cancellableDelay(timeout);

        try {
          await this.navigationDelay;
          navEventListener('timeout');
        } catch (err) {}
      }
    });
  }

  async startTimeline(fn) {
    _logger.default.debug('Starting to record the timeline');

    this.rpcClient.setTimelineEventHandler(fn);
    return await this.rpcClient.send('startTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
  }

  async stopTimeline() {
    _logger.default.debug('Stopping to record the timeline');

    await this.rpcClient.send('stopTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
  }

  async startConsole(fn) {
    _logger.default.debug('Starting to listen for JavaScript console');

    this.rpcClient.setConsoleLogEventHandler(fn);
    return await this.rpcClient.send('startConsole', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
  }

  async stopConsole() {
    _logger.default.debug('Stopping to listen for JavaScript console');

    await this.rpcClient.send('stopConsole', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
  }

  async startNetwork(fn) {
    _logger.default.debug('Starting to listen for network events');

    this.rpcClient.setNetworkLogEventHandler(fn);
    return await this.rpcClient.send('startNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
  }

  async stopNetwork() {
    _logger.default.debug('Stopping to listen for network events');

    await this.rpcClient.send('stopNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
  }

  async execute(command, override) {
    if (this.pageLoading && !override) {
      _logger.default.debug('Trying to execute but page is not loaded.');

      await this.waitForDom();
    }

    if (this.debuggerType === DEBUGGER_TYPES.webinspector) {
      let errors = (0, _helpers.checkParams)({
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
      if (errors) throw new Error(errors);
    }

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug(`Sending javascript command ${_lodash.default.truncate(command, {
      length: 50
    })}`);

    let res = await this.rpcClient.send('sendJSCommand', {
      command,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
    return this.convertResult(res);
  }

  async callFunction(objId, fn, args) {
    let errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    if (errors) throw new Error(errors);

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug('Calling javascript function');

    const res = await this.rpcClient.send('callJSFunction', {
      objId,
      fn,
      args,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    });
    return this.convertResult(res);
  }

  convertResult(res) {
    if (_lodash.default.isUndefined(res)) {
      throw new Error(`Did not get OK result from remote debugger. Result was: ${_lodash.default.truncate((0, _helpers.simpleStringify)(res), {
        length: RESPONSE_LOG_LENGTH
      })}`);
    } else if (_lodash.default.isString(res)) {
      try {
        res = JSON.parse(res);
      } catch (err) {}
    } else if (!_lodash.default.isObject(res)) {
      throw new Error(`Result has unexpected type: (${typeof res}).`);
    }

    if (res.status && res.status !== 0) {
      throw (0, _appiumBaseDriver.errorFromCode)(res.status, res.value.message || res.value);
    }

    return res.hasOwnProperty('value') ? res.value : res;
  }

  allowNavigationWithoutReload(allow = true) {
    if (_lodash.default.isFunction(this.rpcClient.allowNavigationWithoutReload)) {
      this.rpcClient.allowNavigationWithoutReload(allow);
    }
  }

  async getCookies(urls) {
    _logger.default.debug('Getting network cookies');

    return await this.rpcClient.send('getCookies', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType,
      urls
    });
  }

  async deleteCookie(cookieName, url) {
    _logger.default.debug(`Deleting cookie '${cookieName}' on '${url}'`);

    return await this.rpcClient.send('deleteCookie', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType,
      cookieName,
      url
    });
  }

  async garbageCollect(timeoutMs = GARBAGE_COLLECT_TIMEOUT) {
    _logger.default.debug(`Garbage collecting with ${timeoutMs}ms timeout`);

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      _logger.default.debug(`Unable to collect garbage at this time`);

      return;
    }

    await _bluebird.default.resolve(this.rpcClient.send('garbageCollect', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      debuggerType: this.debuggerType
    })).timeout(timeoutMs).then(function gcSuccess() {
      _logger.default.debug(`Garbage collection successful`);
    }).catch(function gcError(err) {
      if (err instanceof _bluebird.default.TimeoutError) {
        _logger.default.debug(`Garbage collection timed out after ${timeoutMs}ms`);
      } else {
        _logger.default.debug(`Unable to collect garbage: ${err.message}`);
      }
    });
  }

}

exports.RemoteDebugger = RemoteDebugger;
RemoteDebugger.EVENT_PAGE_CHANGE = 'remote_debugger_page_change';
RemoteDebugger.EVENT_FRAMES_DETACHED = 'remote_debugger_frames_detached';
RemoteDebugger.EVENT_DISCONNECT = 'remote_debugger_disconnect';

for (const [name, handler] of _lodash.default.toPairs(_messageHandlers.default)) {
  RemoteDebugger.prototype[name] = handler;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtZGVidWdnZXIuanMiXSwibmFtZXMiOlsiVkVSU0lPTiIsInJlcXVpcmUiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInZlcnNpb24iLCJpZ24iLCJERUJVR0dFUl9UWVBFUyIsIndlYmtpdCIsIndlYmluc3BlY3RvciIsIlNFTEVDVF9BUFBfUkVUUklFUyIsIlJFTU9URV9ERUJVR0dFUl9QT1JUIiwiUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVMiLCJQQUdFX1JFQURZX1RJTUVPVVQiLCJSRVNQT05TRV9MT0dfTEVOR1RIIiwiR0FSQkFHRV9DT0xMRUNUX1RJTUVPVVQiLCJSZW1vdGVEZWJ1Z2dlciIsImV2ZW50cyIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwib3B0cyIsImxvZyIsImluZm8iLCJidW5kbGVJZCIsInBsYXRmb3JtVmVyc2lvbiIsImRlYnVnZ2VyVHlwZSIsImlzU2FmYXJpIiwidXNlTmV3U2FmYXJpIiwicGFnZUxvYWRNcyIsImhvc3QiLCJwb3J0Iiwic29ja2V0UGF0aCIsInBhZ2VSZWFkeVRpbWVvdXQiLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJsb2dGdWxsUmVzcG9uc2UiLCJkZWJ1ZyIsInNldHVwIiwiYXBwRGljdCIsImFwcElkS2V5IiwicGFnZUlkS2V5IiwicGFnZUxvYWRpbmciLCJfbmF2aWdhdGluZ1RvUGFnZSIsInNwZWNpYWxDYnMiLCJfIiwibm9vcCIsIm9uUGFnZUNoYW5nZSIsImJpbmQiLCJvbkFwcENvbm5lY3QiLCJvbkFwcERpc2Nvbm5lY3QiLCJvbkFwcFVwZGF0ZSIsIm9uUmVwb3J0RHJpdmVyTGlzdCIsInBhZ2VMb2FkIiwiZnJhbWVEZXRhY2hlZCIsInRhcmdldENyZWF0ZWQiLCJvblRhcmdldENyZWF0ZWQiLCJ0YXJnZXREZXN0cm95ZWQiLCJvblRhcmdldERlc3Ryb3llZCIsInJwY0NsaWVudCIsInRlYXJkb3duIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJFVkVOVF9ESVNDT05ORUNUIiwiY29ubmVjdCIsIlJlbW90ZURlYnVnZ2VyUnBjQ2xpZW50Iiwic3BlY2lhbE1lc3NhZ2VIYW5kbGVycyIsIm1lc3NhZ2VQcm94eSIsImFwcEluZm8iLCJzZXRDb25uZWN0aW9uS2V5IiwiZXJyIiwiZGlzY29ubmVjdCIsImVtaXQiLCJpc0Nvbm5lY3RlZCIsIkIiLCJyZWplY3QiLCJjb25uZWN0Q2IiLCJhcHBzIiwiaXNVbmRlZmluZWQiLCJrZXlzIiwibGVuZ3RoIiwibmV3RGljdCIsImRpY3QiLCJ2YWx1ZXMiLCJpZCIsImVudHJ5IiwiZGVmYXVsdHMiLCJzZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIiLCJzaW1OYW1lS2V5Iiwic2ltQnVpbGRLZXkiLCJzaW1QbGF0Zm9ybVZlcnNpb24iLCJzZW5kIiwidXBkYXRlQXBwc1dpdGhEaWN0IiwicGFnZUFycmF5IiwibG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5IiwiZ2V0VmFsdWVTdHJpbmciLCJrZXkiLCJ2YWx1ZSIsImlzRnVuY3Rpb24iLCJpc0FycmF5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFwcCIsInRvUGFpcnMiLCJBcnJheSIsInBhZ2UiLCJwcmVmaXgiLCJrIiwidiIsInZhbHVlU3RyaW5nIiwic2VsZWN0QXBwIiwiY3VycmVudFVybCIsIm1heFRyaWVzIiwiaWdub3JlQWJvdXRCbGFua1VybCIsInBhZ2VEaWN0IiwiYXBwTG9vcCIsImkiLCJwb3NzaWJsZUFwcElkcyIsImpvaW4iLCJhdHRlbXB0ZWRBcHBJZEtleSIsImlzRW1wdHkiLCJmb3VuZCIsImRpY3RMb29wIiwicHJvbWlzZSIsInRpbWVvdXQiLCJUaW1lb3V0RXJyb3IiLCJ1cmwiLCJtZXNzYWdlIiwiZXJyb3JBbmRUaHJvdyIsInBhZ2VQcm9taXNlcyIsIk9iamVjdCIsImZpbHRlciIsIm1hcCIsImFueSIsImRlbGF5IiwiYWxsIiwiZnVsbFBhZ2VBcnJheSIsInJlcGxhY2UiLCJjbG9uZSIsInB1c2giLCJzZWxlY3RQYWdlIiwic2tpcFJlYWR5Q2hlY2siLCJzaG91bGRDaGVja0ZvclRhcmdldCIsInRhcmdldElkIiwiY2hlY2tQYWdlSXNSZWFkeSIsInBhZ2VVbmxvYWQiLCJleGVjdXRlQXRvbSIsImF0b20iLCJhcmdzIiwiZnJhbWVzIiwiY29ubmVjdGVkIiwiRXJyb3IiLCJzY3JpcHQiLCJleGVjdXRlIiwidHJ1bmNhdGUiLCJleGVjdXRlQXRvbUFzeW5jIiwicmVzcG9uc2VVcmwiLCJhc3luY0NhbGxCYWNrIiwiRVZFTlRfRlJBTUVTX0RFVEFDSEVEIiwic3RhcnRQYWdlTG9hZE1zIiwicGFnZUxvYWRWZXJpZnlIb29rIiwidGltZW91dE1zIiwic3RhcnQiLCJEYXRlIiwibm93IiwidmVyaWZ5IiwicGFnZUxvYWREZWxheSIsInV0aWwiLCJjYW5jZWxsYWJsZURlbGF5IiwiQ2FuY2VsbGF0aW9uRXJyb3IiLCJyZWFkeSIsImNhbmNlbFBhZ2VMb2FkIiwiY2FuY2VsIiwid2FpdEZvckRvbSIsImVycm9ycyIsInJlYWR5Q21kIiwicmVhZHlTdGF0ZSIsIm5hdlRvVXJsIiwid2FpdEZvckZyYW1lTmF2aWdhdGVkIiwic3RhcnRNcyIsIm5hdkV2ZW50TGlzdGVuZXIiLCJuYXZpZ2F0aW9uRGVsYXkiLCJzdGFydFRpbWVsaW5lIiwiZm4iLCJzZXRUaW1lbGluZUV2ZW50SGFuZGxlciIsInN0b3BUaW1lbGluZSIsInN0YXJ0Q29uc29sZSIsInNldENvbnNvbGVMb2dFdmVudEhhbmRsZXIiLCJzdG9wQ29uc29sZSIsInN0YXJ0TmV0d29yayIsInNldE5ldHdvcmtMb2dFdmVudEhhbmRsZXIiLCJzdG9wTmV0d29yayIsImNvbW1hbmQiLCJvdmVycmlkZSIsImdhcmJhZ2VDb2xsZWN0IiwicmVzIiwiY29udmVydFJlc3VsdCIsImNhbGxGdW5jdGlvbiIsIm9iaklkIiwiaXNTdHJpbmciLCJwYXJzZSIsImlzT2JqZWN0Iiwic3RhdHVzIiwiaGFzT3duUHJvcGVydHkiLCJhbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkIiwiYWxsb3ciLCJnZXRDb29raWVzIiwidXJscyIsImRlbGV0ZUNvb2tpZSIsImNvb2tpZU5hbWUiLCJ0aGVuIiwiZ2NTdWNjZXNzIiwiY2F0Y2giLCJnY0Vycm9yIiwibmFtZSIsImhhbmRsZXIiLCJtZXNzYWdlSGFuZGxlcnMiLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsSUFBSUEsT0FBSjs7QUFDQSxJQUFJO0FBQ0ZBLEVBQUFBLE9BQU8sR0FBR0MsT0FBTyxDQUFDQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsSUFBeEIsRUFBOEIsSUFBOUIsRUFBb0MsY0FBcEMsQ0FBRCxDQUFQLENBQTZEQyxPQUF2RTtBQUNELENBRkQsQ0FFRSxPQUFPQyxHQUFQLEVBQVksQ0FBRTs7QUFFaEIsTUFBTUMsY0FBYyxHQUFHO0FBQ3JCQyxFQUFBQSxNQUFNLEVBQUUsQ0FEYTtBQUVyQkMsRUFBQUEsWUFBWSxFQUFFO0FBRk8sQ0FBdkI7O0FBSUEsTUFBTUMsa0JBQWtCLEdBQUcsRUFBM0I7QUFDQSxNQUFNQyxvQkFBb0IsR0FBRyxLQUE3Qjs7QUFHQSxNQUFNQyx1QkFBdUIsR0FBRyxJQUFoQzs7QUFFQSxNQUFNQyxrQkFBa0IsR0FBRyxJQUEzQjtBQUVBLE1BQU1DLG1CQUFtQixHQUFHLEdBQTVCO0FBRUEsTUFBTUMsdUJBQXVCLEdBQUcsSUFBaEM7O0FBR0EsTUFBTUMsY0FBTixTQUE2QkMsZ0JBQU9DLFlBQXBDLENBQWlEO0FBVy9DQyxFQUFBQSxXQUFXLENBQUVDLElBQUksR0FBRyxFQUFULEVBQWE7QUFDdEI7O0FBRUEsUUFBSXBCLE9BQUosRUFBYTtBQUNYcUIsc0JBQUlDLElBQUosQ0FBVSwyQkFBMEJ0QixPQUFRLEVBQTVDO0FBQ0Q7O0FBRUQsVUFBTTtBQUNKdUIsTUFBQUEsUUFESTtBQUVKQyxNQUFBQSxlQUZJO0FBR0pDLE1BQUFB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QUFHQSxLQUFLLE1BQU0sQ0FBQ3VKLElBQUQsRUFBT0MsT0FBUCxDQUFYLElBQThCMUssZ0JBQUUwRCxPQUFGLENBQVVpSCx3QkFBVixDQUE5QixFQUEwRDtBQUN4RHZNLEVBQUFBLGNBQWMsQ0FBQ3dNLFNBQWYsQ0FBeUJILElBQXpCLElBQWlDQyxPQUFqQztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV2ZW50cyBmcm9tICdldmVudHMnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBlcnJvckZyb21Db2RlIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBSZW1vdGVEZWJ1Z2dlclJwY0NsaWVudCBmcm9tICcuL3JlbW90ZS1kZWJ1Z2dlci1ycGMtY2xpZW50JztcbmltcG9ydCBtZXNzYWdlSGFuZGxlcnMgZnJvbSAnLi9tZXNzYWdlLWhhbmRsZXJzJztcbmltcG9ydCB7IGFwcEluZm9Gcm9tRGljdCwgcGFnZUFycmF5RnJvbURpY3QsIGdldERlYnVnZ2VyQXBwS2V5LFxuICAgICAgICAgZ2V0UG9zc2libGVEZWJ1Z2dlckFwcEtleXMsIGNoZWNrUGFyYW1zLCBnZXRTY3JpcHRGb3JBdG9tLFxuICAgICAgICAgc2ltcGxlU3RyaW5naWZ5LCBkZWZlcnJlZFByb21pc2UgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuXG5sZXQgVkVSU0lPTjtcbnRyeSB7XG4gIFZFUlNJT04gPSByZXF1aXJlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICcuLicsICdwYWNrYWdlLmpzb24nKSkudmVyc2lvbjtcbn0gY2F0Y2ggKGlnbikge31cblxuY29uc3QgREVCVUdHRVJfVFlQRVMgPSB7XG4gIHdlYmtpdDogMSxcbiAgd2ViaW5zcGVjdG9yOiAyXG59O1xuY29uc3QgU0VMRUNUX0FQUF9SRVRSSUVTID0gMjA7XG5jb25zdCBSRU1PVEVfREVCVUdHRVJfUE9SVCA9IDI3NzUzO1xuXG4vKiBIb3cgbWFueSBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3Igd2Via2l0IHRvIHJldHVybiBhIHJlc3BvbnNlIGJlZm9yZSB0aW1pbmcgb3V0ICovXG5jb25zdCBSUENfUkVTUE9OU0VfVElNRU9VVF9NUyA9IDUwMDA7XG5cbmNvbnN0IFBBR0VfUkVBRFlfVElNRU9VVCA9IDUwMDA7XG5cbmNvbnN0IFJFU1BPTlNFX0xPR19MRU5HVEggPSAxMDA7XG5cbmNvbnN0IEdBUkJBR0VfQ09MTEVDVF9USU1FT1VUID0gNTAwMDtcblxuXG5jbGFzcyBSZW1vdGVEZWJ1Z2dlciBleHRlbmRzIGV2ZW50cy5FdmVudEVtaXR0ZXIge1xuICAvKlxuICAgKiBUaGUgY29uc3RydWN0b3IgdGFrZXMgYW4gb3B0cyBoYXNoIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgKiAgIC0gYnVuZGxlSWQgLSBpZCBvZiB0aGUgYXBwIGJlaW5nIGNvbm5lY3RlZCB0b1xuICAgKiAgIC0gcGxhdGZvcm1WZXJzaW9uIC0gdmVyc2lvbiBvZiBpT1NcbiAgICogICAtIGRlYnVnZ2VyVHlwZSAtIG9uZSBvZiB0aGUgREVCVUdHRVJfVFlQRVNcbiAgICogICAtIHVzZU5ld1NhZmFyaSAtIGZvciB3ZWIgaW5zcGVjdG9yLCB3aGV0aGVyIHRoaXMgaXMgYSBuZXcgU2FmYXJpIGluc3RhbmNlXG4gICAqICAgLSBwYWdlTG9hZE1zIC0gdGhlIHRpbWUsIGluIG1zLCB0aGF0IHNob3VsZCBiZSB3YWl0ZWQgZm9yIHBhZ2UgbG9hZGluZ1xuICAgKiAgIC0gaG9zdCAtIHRoZSByZW1vdGUgZGVidWdnZXIncyBob3N0IGFkZHJlc3NcbiAgICogICAtIHBvcnQgLSB0aGUgcmVtb3RlIGRlYnVnZ2VyIHBvcnQgdGhyb3VnaCB3aGljaCB0byBjb21tdW5pY2F0ZVxuICAgKi9cbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBpZiAoVkVSU0lPTikge1xuICAgICAgbG9nLmluZm8oYFJlbW90ZSBEZWJ1Z2dlciB2ZXJzaW9uICR7VkVSU0lPTn1gKTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBidW5kbGVJZCxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGRlYnVnZ2VyVHlwZSA9IERFQlVHR0VSX1RZUEVTLndlYmluc3BlY3RvcixcbiAgICAgIGlzU2FmYXJpID0gdHJ1ZSxcbiAgICAgIHVzZU5ld1NhZmFyaSA9IGZhbHNlLFxuICAgICAgcGFnZUxvYWRNcyxcbiAgICAgIGhvc3QsXG4gICAgICBwb3J0ID0gUkVNT1RFX0RFQlVHR0VSX1BPUlQsXG4gICAgICBzb2NrZXRQYXRoLFxuICAgICAgcGFnZVJlYWR5VGltZW91dCA9IFBBR0VfUkVBRFlfVElNRU9VVCxcbiAgICAgIHJlbW90ZURlYnVnUHJveHksXG4gICAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSA9IGZhbHNlLFxuICAgICAgbG9nRnVsbFJlc3BvbnNlID0gZmFsc2UsXG4gICAgfSA9IG9wdHM7XG5cbiAgICB0aGlzLmJ1bmRsZUlkID0gYnVuZGxlSWQ7XG4gICAgdGhpcy5wbGF0Zm9ybVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG4gICAgdGhpcy5pc1NhZmFyaSA9IGlzU2FmYXJpO1xuICAgIHRoaXMuZGVidWdnZXJUeXBlID0gZGVidWdnZXJUeXBlO1xuICAgIGlmICh0aGlzLmRlYnVnZ2VyVHlwZSA9PT0gREVCVUdHRVJfVFlQRVMud2ViaW5zcGVjdG9yKSB7XG4gICAgICB0aGlzLnVzZU5ld1NhZmFyaSA9IHVzZU5ld1NhZmFyaTtcbiAgICAgIHRoaXMucGFnZUxvYWRNcyA9IHBhZ2VMb2FkTXM7XG4gICAgICBsb2cuZGVidWcoYHVzZU5ld1NhZmFyaSAtLT4gJHt0aGlzLnVzZU5ld1NhZmFyaX1gKTtcbiAgICB9XG4gICAgdGhpcy5nYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSA9IGdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlO1xuXG4gICAgdGhpcy5ob3N0ID0gaG9zdDtcbiAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgIHRoaXMuc29ja2V0UGF0aCA9IHNvY2tldFBhdGg7XG4gICAgdGhpcy5yZW1vdGVEZWJ1Z1Byb3h5ID0gcmVtb3RlRGVidWdQcm94eTtcbiAgICB0aGlzLnBhZ2VSZWFkeVRpbWVvdXQgPSBwYWdlUmVhZHlUaW1lb3V0O1xuXG4gICAgdGhpcy5sb2dGdWxsUmVzcG9uc2UgPSBsb2dGdWxsUmVzcG9uc2U7XG4gIH1cblxuICBzZXR1cCAoKSB7XG4gICAgLy8gYXBwIGhhbmRsaW5nIGNvbmZpZ3VyYXRpb25cbiAgICB0aGlzLmFwcERpY3QgPSB7fTtcbiAgICB0aGlzLmFwcElkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMuX25hdmlnYXRpbmdUb1BhZ2UgPSBmYWxzZTtcblxuICAgIC8vIHNldCB1cCB0aGUgc3BlY2lhbCBjYWxsYmFja3MgZm9yIGhhbmRsaW5nIHJkIGV2ZW50c1xuICAgIHRoaXMuc3BlY2lhbENicyA9IHtcbiAgICAgICdfcnBjX3JlcG9ydElkZW50aWZpZXI6JzogXy5ub29wLFxuICAgICAgJ19ycGNfZm9yd2FyZEdldExpc3Rpbmc6JzogdGhpcy5vblBhZ2VDaGFuZ2UuYmluZCh0aGlzKSxcbiAgICAgICdfcnBjX3JlcG9ydENvbm5lY3RlZEFwcGxpY2F0aW9uTGlzdDonOiBfLm5vb3AsXG4gICAgICAnX3JwY19hcHBsaWNhdGlvbkNvbm5lY3RlZDonOiB0aGlzLm9uQXBwQ29ubmVjdC5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfYXBwbGljYXRpb25EaXNjb25uZWN0ZWQ6JzogdGhpcy5vbkFwcERpc2Nvbm5lY3QuYmluZCh0aGlzKSxcbiAgICAgICdfcnBjX2FwcGxpY2F0aW9uVXBkYXRlZDonOiB0aGlzLm9uQXBwVXBkYXRlLmJpbmQodGhpcyksXG4gICAgICAnX3JwY19yZXBvcnRDb25uZWN0ZWREcml2ZXJMaXN0Oic6IHRoaXMub25SZXBvcnREcml2ZXJMaXN0LmJpbmQodGhpcyksXG4gICAgICBwYWdlTG9hZDogdGhpcy5wYWdlTG9hZC5iaW5kKHRoaXMpLFxuICAgICAgZnJhbWVEZXRhY2hlZDogdGhpcy5mcmFtZURldGFjaGVkLmJpbmQodGhpcyksXG4gICAgICB0YXJnZXRDcmVhdGVkOiB0aGlzLm9uVGFyZ2V0Q3JlYXRlZC5iaW5kKHRoaXMpLFxuICAgICAgdGFyZ2V0RGVzdHJveWVkOiB0aGlzLm9uVGFyZ2V0RGVzdHJveWVkLmJpbmQodGhpcyksXG4gICAgfTtcblxuICAgIHRoaXMucnBjQ2xpZW50ID0gbnVsbDtcbiAgfVxuXG4gIHRlYXJkb3duICgpIHtcbiAgICBsb2cuZGVidWcoJ0NsZWFuaW5nIHVwIGxpc3RlbmVycycpO1xuXG4gICAgdGhpcy5hcHBEaWN0ID0ge307XG4gICAgdGhpcy5hcHBJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlSWRLZXkgPSBudWxsO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSBmYWxzZTtcblxuICAgIHRoaXMuc3BlY2lhbENicyA9IHt9O1xuXG4gICAgdGhpcy5ycGNDbGllbnQgPSBudWxsO1xuXG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UpO1xuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFJlbW90ZURlYnVnZ2VyLkVWRU5UX0RJU0NPTk5FQ1QpO1xuICB9XG5cbiAgYXN5bmMgY29ubmVjdCAoKSB7XG4gICAgdGhpcy5zZXR1cCgpO1xuXG4gICAgLy8gaW5pdGlhbGl6ZSB0aGUgcnBjIGNsaWVudFxuICAgIHRoaXMucnBjQ2xpZW50ID0gbmV3IFJlbW90ZURlYnVnZ2VyUnBjQ2xpZW50KHtcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogdGhpcy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICBpc1NhZmFyaTogdGhpcy5pc1NhZmFyaSxcbiAgICAgIGhvc3Q6IHRoaXMuaG9zdCxcbiAgICAgIHBvcnQ6IHRoaXMucG9ydCxcbiAgICAgIHNvY2tldFBhdGg6IHRoaXMuc29ja2V0UGF0aCxcbiAgICAgIHNwZWNpYWxNZXNzYWdlSGFuZGxlcnM6IHRoaXMuc3BlY2lhbENicyxcbiAgICAgIG1lc3NhZ2VQcm94eTogdGhpcy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgICAgbG9nRnVsbFJlc3BvbnNlOiB0aGlzLmxvZ0Z1bGxSZXNwb25zZSxcbiAgICB9KTtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5jb25uZWN0KCk7XG5cbiAgICAvLyBnZXQgdGhlIGNvbm5lY3Rpb24gaW5mb3JtYXRpb24gYWJvdXQgdGhlIGFwcFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcHBJbmZvID0gYXdhaXQgdGhpcy5zZXRDb25uZWN0aW9uS2V5KCk7XG4gICAgICBsb2cuZGVidWcoJ0Nvbm5lY3RlZCB0byBhcHBsaWNhdGlvbicpO1xuICAgICAgcmV0dXJuIGFwcEluZm87XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBhd2FpdCB0aGlzLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRpc2Nvbm5lY3QgKCkge1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LmRpc2Nvbm5lY3QoKTtcbiAgICB0aGlzLmVtaXQoUmVtb3RlRGVidWdnZXIuRVZFTlRfRElTQ09OTkVDVCwgdHJ1ZSk7XG4gICAgdGhpcy50ZWFyZG93bigpO1xuICB9XG5cbiAgaXNDb25uZWN0ZWQgKCkge1xuICAgIHJldHVybiAhISh0aGlzLnJwY0NsaWVudCAmJiB0aGlzLnJwY0NsaWVudC5pc0Nvbm5lY3RlZCgpKTtcbiAgfVxuXG4gIGFzeW5jIHNldENvbm5lY3Rpb25LZXkgKCkge1xuICAgIC8vIG9ubHkgcmVzb2x2ZSB3aGVuIHRoZSBjb25uZWN0aW9uIHJlc3BvbnNlIGlzIHJlY2VpdmVkXG4gICAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIGxvY2FsIGNhbGxiYWNrLCBjYWxsZWQgd2hlbiB0aGUgcmVtb3RlIGRlYnVnZ2VyIGhhcyBlc3RhYmxpc2hlZFxuICAgICAgLy8gYSBjb25uZWN0aW9uIHRvIHRoZSBhcHAgdW5kZXIgdGVzdFxuICAgICAgLy8gYGFwcGAgd2lsbCBiZSBhbiBhcnJheSBvZiBkaWN0aW9uYXJpZXMgb2YgYXBwIGluZm9ybWF0aW9uXG4gICAgICBsZXQgY29ubmVjdENiID0gKGFwcHMpID0+IHtcbiAgICAgICAgaWYgKF8uaXNVbmRlZmluZWQoYXBwcykgfHwgXy5rZXlzKGFwcHMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGxvZy5kZWJ1ZygnUmVjZWl2ZWQgbm8gYXBwcyBmcm9tIHJlbW90ZSBkZWJ1Z2dlci4gVW5hYmxlIHRvIGNvbm5lY3QuJyk7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUodGhpcy5hcHBEaWN0KTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV3RGljdCA9IHt9O1xuXG4gICAgICAgIC8vIHRyYW5zbGF0ZSB0aGUgcmVjZWl2ZWQgaW5mb3JtYXRpb24gaW50byBhbiBlYXNpZXItdG8tbWFuYWdlXG4gICAgICAgIC8vIGhhc2ggd2l0aCBhcHAgaWQgYXMga2V5LCBhbmQgYXBwIGluZm8gYXMgdmFsdWVcbiAgICAgICAgZm9yIChjb25zdCBkaWN0IG9mIF8udmFsdWVzKGFwcHMpKSB7XG4gICAgICAgICAgbGV0IFtpZCwgZW50cnldID0gYXBwSW5mb0Zyb21EaWN0KGRpY3QpO1xuICAgICAgICAgIG5ld0RpY3RbaWRdID0gZW50cnk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdXBkYXRlIHRoZSBvYmplY3QncyBsaXN0IG9mIGFwcHMsIGFuZCByZXR1cm4gaXQgdGhyb3VnaCB0aGUgcHJvbWlzZVxuICAgICAgICBfLmRlZmF1bHRzKHRoaXMuYXBwRGljdCwgbmV3RGljdCk7XG4gICAgICAgIHJlc29sdmUobmV3RGljdCk7XG4gICAgICB9O1xuICAgICAgdGhpcy5ycGNDbGllbnQuc2V0U3BlY2lhbE1lc3NhZ2VIYW5kbGVyKCdfcnBjX3JlcG9ydENvbm5lY3RlZEFwcGxpY2F0aW9uTGlzdDonLCByZWplY3QsIGNvbm5lY3RDYik7XG5cbiAgICAgIGxvZy5kZWJ1ZygnU2VuZGluZyBjb25uZWN0aW9uIGtleSByZXF1ZXN0Jyk7XG4gICAgICByZXR1cm4gKGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IFtzaW1OYW1lS2V5LCBzaW1CdWlsZEtleSwgc2ltUGxhdGZvcm1WZXJzaW9uXSA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3NldENvbm5lY3Rpb25LZXknKTtcbiAgICAgICAgbG9nLmRlYnVnKGBTaW0gbmFtZTogJHtzaW1OYW1lS2V5fWApO1xuICAgICAgICBsb2cuZGVidWcoYFNpbSBidWlsZDogJHtzaW1CdWlsZEtleX1gKTtcbiAgICAgICAgbG9nLmRlYnVnKGBTaW0gcGxhdGZvcm0gdmVyc2lvbjogJHtzaW1QbGF0Zm9ybVZlcnNpb259YCk7XG4gICAgICB9KSgpO1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlQXBwc1dpdGhEaWN0IChkaWN0KSB7XG4gICAgLy8gZ2V0IHRoZSBkaWN0aW9uYXJ5IGVudHJ5IGludG8gYSBuaWNlIGZvcm0sIGFuZCBhZGQgaXQgdG8gdGhlXG4gICAgLy8gYXBwbGljYXRpb24gZGljdGlvbmFyeVxuICAgIHRoaXMuYXBwRGljdCA9IHRoaXMuYXBwRGljdCB8fCB7fTtcbiAgICBsZXQgW2lkLCBlbnRyeV0gPSBhcHBJbmZvRnJvbURpY3QoZGljdCk7XG4gICAgaWYgKHRoaXMuYXBwRGljdFtpZF0pIHtcbiAgICAgIC8vIHByZXNlcnZlIHRoZSBwYWdlIGRpY3Rpb25hcnkgZm9yIHRoaXMgZW50cnlcbiAgICAgIGVudHJ5LnBhZ2VBcnJheSA9IHRoaXMuYXBwRGljdFtpZF0ucGFnZUFycmF5O1xuICAgIH1cbiAgICB0aGlzLmFwcERpY3RbaWRdID0gZW50cnk7XG5cbiAgICAvLyBhZGQgYSBwcm9taXNlIHRvIGdldCB0aGUgcGFnZSBkaWN0aW9uYXJ5XG4gICAgaWYgKF8uaXNVbmRlZmluZWQoZW50cnkucGFnZUFycmF5KSkge1xuICAgICAgZW50cnkucGFnZUFycmF5ID0gZGVmZXJyZWRQcm9taXNlKCk7XG4gICAgfVxuXG4gICAgLy8gdHJ5IHRvIGdldCB0aGUgYXBwIGlkIGZyb20gb3VyIGNvbm5lY3RlZCBhcHBzXG4gICAgaWYgKCF0aGlzLmFwcElkS2V5KSB7XG4gICAgICB0aGlzLmFwcElkS2V5ID0gZ2V0RGVidWdnZXJBcHBLZXkodGhpcy5idW5kbGVJZCwgdGhpcy5wbGF0Zm9ybVZlcnNpb24sIHRoaXMuYXBwRGljdCk7XG4gICAgfVxuICB9XG5cbiAgbG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5IChhcHBzKSB7XG4gICAgZnVuY3Rpb24gZ2V0VmFsdWVTdHJpbmcgKGtleSwgdmFsdWUpIHtcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSB7XG4gICAgICAgIHJldHVybiAnW0Z1bmN0aW9uXSc7XG4gICAgICB9XG4gICAgICBpZiAoa2V5ID09PSAncGFnZUFycmF5JyAmJiAhXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gYCdXYWl0aW5nIGZvciBkYXRhJ2A7XG4gICAgICB9XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgIH1cbiAgICBsb2cuZGVidWcoJ0N1cnJlbnQgYXBwbGljYXRpb25zIGF2YWlsYWJsZTonKTtcbiAgICBmb3IgKGNvbnN0IFthcHAsIGluZm9dIG9mIF8udG9QYWlycyhhcHBzKSkge1xuICAgICAgbG9nLmRlYnVnKGAgICAgQXBwbGljYXRpb246ICcke2FwcH0nYCk7XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMoaW5mbykpIHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ3BhZ2VBcnJheScgJiYgQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGAgICAgICAgICR7a2V5fTpgKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgdmFsdWUpIHtcbiAgICAgICAgICAgIGxldCBwcmVmaXggPSAnLSAnO1xuICAgICAgICAgICAgZm9yIChjb25zdCBbaywgdl0gb2YgXy50b1BhaXJzKHBhZ2UpKSB7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgICAgICAgICAgICR7cHJlZml4fSR7a306ICR7SlNPTi5zdHJpbmdpZnkodil9YCk7XG4gICAgICAgICAgICAgIHByZWZpeCA9ICcgICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHZhbHVlU3RyaW5nID0gZ2V0VmFsdWVTdHJpbmcoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgbG9nLmRlYnVnKGAgICAgICAgICR7a2V5fTogJHt2YWx1ZVN0cmluZ31gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbGVjdEFwcCAoY3VycmVudFVybCA9IG51bGwsIG1heFRyaWVzID0gU0VMRUNUX0FQUF9SRVRSSUVTLCBpZ25vcmVBYm91dEJsYW5rVXJsID0gZmFsc2UpIHtcbiAgICBsb2cuZGVidWcoJ1NlbGVjdGluZyBhcHBsaWNhdGlvbicpO1xuICAgIGlmICghdGhpcy5hcHBEaWN0IHx8IF8ua2V5cyh0aGlzLmFwcERpY3QpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbG9nLmRlYnVnKCdObyBhcHBsaWNhdGlvbnMgY3VycmVudGx5IGNvbm5lY3RlZC4nKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICAvLyBpdGVyYXRpdmUgc29sdXRpb24sIGFzIHJlY3Vyc2lvbiB3YXMgc3dhbGxvd2luZyB0aGUgcHJvbWlzZSBhdCBzb21lIHBvaW50XG4gICAgbGV0IHBhZ2VEaWN0LCBhcHBJZEtleTtcbiAgICBhcHBMb29wOiBmb3IgKGxldCBpID0gMDsgaSA8IG1heFRyaWVzOyBpKyspIHtcbiAgICAgIHRoaXMubG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5KHRoaXMuYXBwRGljdCk7XG4gICAgICBsZXQgcG9zc2libGVBcHBJZHMgPSBnZXRQb3NzaWJsZURlYnVnZ2VyQXBwS2V5cyh0aGlzLmJ1bmRsZUlkLCB0aGlzLnBsYXRmb3JtVmVyc2lvbiwgdGhpcy5hcHBEaWN0KTtcbiAgICAgIGxvZy5kZWJ1ZyhgVHJ5aW5nIG91dCB0aGUgcG9zc2libGUgYXBwIGlkczogJHtwb3NzaWJsZUFwcElkcy5qb2luKCcsICcpfWApO1xuICAgICAgZm9yIChjb25zdCBhdHRlbXB0ZWRBcHBJZEtleSBvZiBwb3NzaWJsZUFwcElkcykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgU2VsZWN0aW5nIGFwcCAke2F0dGVtcHRlZEFwcElkS2V5fSAodHJ5ICMke2kgKyAxfSBvZiAke21heFRyaWVzfSlgKTtcbiAgICAgICAgICBbYXBwSWRLZXksIHBhZ2VEaWN0XSA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbGVjdEFwcChhdHRlbXB0ZWRBcHBJZEtleSwgdGhpcy5vbkFwcENvbm5lY3QuYmluZCh0aGlzKSk7XG4gICAgICAgICAgLy8gaW4gaU9TIDguMiB0aGUgY29ubmVjdCBsb2dpYyBoYXBwZW5zLCBidXQgd2l0aCBhbiBlbXB0eSBkaWN0aW9uYXJ5XG4gICAgICAgICAgLy8gd2hpY2ggbGVhZHMgdG8gdGhlIHJlbW90ZSBkZWJ1Z2dlciBnZXR0aW5nIGRpc2Nvbm5lY3RlZCwgYW5kIGludG8gYSBsb29wXG4gICAgICAgICAgaWYgKF8uaXNFbXB0eShwYWdlRGljdCkpIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZygnRW1wdHkgcGFnZSBkaWN0aW9uYXJ5IHJlY2VpdmVkLiBUcnlpbmcgYWdhaW4uJyk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBzYXZlIHRoZSBwYWdlIGFycmF5IGZvciB0aGlzIGFwcFxuICAgICAgICAgIHRoaXMuYXBwRGljdFthcHBJZEtleV0ucGFnZUFycmF5ID0gcGFnZUFycmF5RnJvbURpY3QocGFnZURpY3QpO1xuXG4gICAgICAgICAgLy8gaWYgd2UgYXJlIGxvb2tpbmcgZm9yIGEgcGFydGljdWxhciB1cmwsIG1ha2Ugc3VyZSB3ZSBoYXZlIHRoZSByaWdodCBwYWdlLiBJZ25vcmUgZW1wdHkgb3IgdW5kZWZpbmVkIHVybHMuIElnbm9yZSBhYm91dDpibGFuayBpZiByZXF1ZXN0ZWQuXG4gICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgZGljdExvb3A6IGZvciAoY29uc3QgYXBwRGljdCBvZiBfLnZhbHVlcyh0aGlzLmFwcERpY3QpKSB7XG4gICAgICAgICAgICBpZiAoZm91bmQpIGJyZWFrOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICAgICAgICAgIGlmICghYXBwRGljdCB8fCAhYXBwRGljdC5wYWdlQXJyYXkpIHtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGlmIHRoZSBwYWdlIGRpY3Rpb25hcnkgaGFzIG5vdCBiZWVuIGxvYWRlZCB5ZXQgZnJvbSB0aGUgd2ViXG4gICAgICAgICAgICAvLyBpbnNwZWN0b3IsIHdhaXQgZm9yIGl0IG9yIHRpbWUgb3V0IGFmdGVyIDEwc1xuICAgICAgICAgICAgaWYgKGFwcERpY3QucGFnZUFycmF5LnByb21pc2UpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBCLnJlc29sdmUoYXBwRGljdC5wYWdlQXJyYXkucHJvbWlzZSkudGltZW91dCgxMDAwMCk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIEIuVGltZW91dEVycm9yKSkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBvbiB0aW1lb3V0LCBqdXN0IGdvIG9uXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yIChjb25zdCBkaWN0IG9mIChhcHBEaWN0LnBhZ2VBcnJheSB8fCBbXSkpIHtcbiAgICAgICAgICAgICAgaWYgKCghaWdub3JlQWJvdXRCbGFua1VybCB8fCBkaWN0LnVybCAhPT0gJ2Fib3V0OmJsYW5rJykgJiZcbiAgICAgICAgICAgICAgICAgICghY3VycmVudFVybCB8fCBkaWN0LnVybCA9PT0gY3VycmVudFVybCB8fCBkaWN0LnVybCA9PT0gYCR7Y3VycmVudFVybH0vYCkpIHtcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHdoZXJlIHdlIGZvdW5kIHRoZSByaWdodCBwYWdlXG4gICAgICAgICAgICAgICAgYXBwSWRLZXkgPSBhcHBEaWN0LmlkO1xuICAgICAgICAgICAgICAgIHBhZ2VEaWN0ID0gZGljdDtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWsgZGljdExvb3A7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRVcmwpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBhcHAsIGJ1dCBleHBlY3RlZCB1cmwgKCcke2N1cnJlbnRVcmx9Jykgd2FzIG5vdCBmb3VuZC4gVHJ5aW5nIGFnYWluLmApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKCdSZWNlaXZlZCBhcHAsIGJ1dCBubyBtYXRjaCB3YXMgZm91bmQuIFRyeWluZyBhZ2Fpbi4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhZ2VEaWN0ID0gbnVsbDtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIHdlIGhhdmUgZ290dGVuIHRoZSBjb3JyZWN0IGFwcGxpY2F0aW9uIGJ5IHRoaXMgcG9pbnQsIHNvIHNob3J0IGNpcmN1aXQgZXZlcnl0aGluZ1xuICAgICAgICAgIGJyZWFrIGFwcExvb3A7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgRXJyb3IgY2hlY2tpbmcgYXBwbGljYXRpb246ICcke2Vyci5tZXNzYWdlfScuIFJldHJ5aW5nIGNvbm5lY3Rpb25gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlmLCBhZnRlciBhbGwgdGhpcywgd2UgaGF2ZSBubyBkaWN0aW9uYXJ5LCB3ZSBoYXZlIGZhaWxlZFxuICAgIGlmICghcGFnZURpY3QpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY29ubmVjdCB0byBhIHZhbGlkIGFwcCBhZnRlciAke21heFRyaWVzfSB0cmllcy5gKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcHBJZEtleSAhPT0gYXBwSWRLZXkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgYWx0ZXJlZCBhcHAgaWQsIHVwZGF0aW5nIGZyb20gJyR7dGhpcy5hcHBJZEtleX0nIHRvICcke2FwcElkS2V5fSdgKTtcbiAgICAgIHRoaXMuYXBwSWRLZXkgPSBhcHBJZEtleTtcbiAgICB9XG5cbiAgICAvLyB3YWl0IGZvciBhbGwgdGhlIHByb21pc2VzIGFyZSBiYWNrLCBvciAzMHMgcGFzc2VzXG4gICAgY29uc3QgcGFnZVByb21pc2VzID0gT2JqZWN0LnZhbHVlcyh0aGlzLmFwcERpY3QpXG4gICAgICAuZmlsdGVyKChhcHApID0+ICEhYXBwLnBhZ2VBcnJheSAmJiAhIWFwcC5wYWdlQXJyYXkucHJvbWlzZSlcbiAgICAgIC5tYXAoKGFwcCkgPT4gYXBwLnBhZ2VBcnJheS5wcm9taXNlKTtcbiAgICBpZiAocGFnZVByb21pc2VzLmxlbmd0aCkge1xuICAgICAgbG9nLmRlYnVnKGBXYWl0aW5nIGZvciAke3BhZ2VQcm9taXNlcy5sZW5ndGh9IHBhZ2VzIHRvIGJlIGZ1bGZpbGxlZGApO1xuICAgICAgYXdhaXQgQi5hbnkoW0IuZGVsYXkoMzAwMDApLCBCLmFsbChwYWdlUHJvbWlzZXMpXSk7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkodGhpcy5hcHBEaWN0KTtcblxuICAgIC8vIHRyYW5zbGF0ZSB0aGUgZGljdGlvbmFyeSBpbnRvIGEgdXNlZnVsIGZvcm0sIGFuZCByZXR1cm4gdG8gc2VuZGVyXG4gICAgY29uc3QgcGFnZUFycmF5ID0gXy5pc0VtcHR5KHRoaXMuYXBwRGljdFthcHBJZEtleV0ucGFnZUFycmF5KVxuICAgICAgPyBwYWdlQXJyYXlGcm9tRGljdChwYWdlRGljdClcbiAgICAgIDogdGhpcy5hcHBEaWN0W2FwcElkS2V5XS5wYWdlQXJyYXk7XG4gICAgbG9nLmRlYnVnKGBGaW5hbGx5IHNlbGVjdGluZyBhcHAgJHt0aGlzLmFwcElkS2V5fTogJHtzaW1wbGVTdHJpbmdpZnkocGFnZUFycmF5KX1gKTtcblxuICAgIGxldCBmdWxsUGFnZUFycmF5ID0gW107XG4gICAgZm9yIChjb25zdCBbYXBwLCBpbmZvXSBvZiBfLnRvUGFpcnModGhpcy5hcHBEaWN0KSkge1xuICAgICAgaWYgKCFfLmlzQXJyYXkoaW5mby5wYWdlQXJyYXkpKSBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgICAgbGV0IGlkID0gYXBwLnJlcGxhY2UoJ1BJRDonLCAnJyk7XG4gICAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgaW5mby5wYWdlQXJyYXkpIHtcbiAgICAgICAgaWYgKHBhZ2UudXJsICYmICghaWdub3JlQWJvdXRCbGFua1VybCB8fCBwYWdlLnVybCAhPT0gJ2Fib3V0OmJsYW5rJykgJiYgKCFjdXJyZW50VXJsIHx8IHBhZ2UudXJsID09PSBjdXJyZW50VXJsIHx8IHBhZ2UudXJsID09PSBgJHtjdXJyZW50VXJsfS9gKSkge1xuICAgICAgICAgIGxldCBwYWdlRGljdCA9IF8uY2xvbmUocGFnZSk7XG4gICAgICAgICAgcGFnZURpY3QuaWQgPSBgJHtpZH0uJHtwYWdlRGljdC5pZH1gO1xuICAgICAgICAgIGZ1bGxQYWdlQXJyYXkucHVzaChwYWdlRGljdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZnVsbFBhZ2VBcnJheTtcbiAgfVxuXG4gIGFzeW5jIHNlbGVjdFBhZ2UgKGFwcElkS2V5LCBwYWdlSWRLZXksIHNraXBSZWFkeUNoZWNrID0gZmFsc2UpIHtcbiAgICB0aGlzLmFwcElkS2V5ID0gYFBJRDoke2FwcElkS2V5fWA7XG4gICAgdGhpcy5wYWdlSWRLZXkgPSBwYWdlSWRLZXk7XG5cbiAgICBsb2cuZGVidWcoYFNlbGVjdGluZyBwYWdlICcke3BhZ2VJZEtleX0nIG9uIGFwcCAnJHt0aGlzLmFwcElkS2V5fScgYW5kIGZvcndhcmRpbmcgc29ja2V0IHNldHVwYCk7XG5cbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZXRTZW5kZXJLZXknLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXlcbiAgICB9KTtcbiAgICBsb2cuZGVidWcoJ1NlbmRlciBrZXkgc2V0Jyk7XG5cbiAgICB0aGlzLnJwY0NsaWVudC5zaG91bGRDaGVja0ZvclRhcmdldCA9IHRydWU7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnZW5hYmxlUGFnZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGUsXG4gICAgICB0YXJnZXRJZDogJ3BhZ2UtMScsXG4gICAgfSk7XG4gICAgbG9nLmRlYnVnKCdFbmFibGVkIGFjdGl2aXR5IG9uIHBhZ2UnKTtcblxuICAgIC8vIG1ha2Ugc3VyZSBldmVyeXRoaW5nIGlzIHJlYWR5IHRvIGdvXG4gICAgaWYgKCFza2lwUmVhZHlDaGVjayAmJiAhYXdhaXQgdGhpcy5jaGVja1BhZ2VJc1JlYWR5KCkpIHtcbiAgICAgIGF3YWl0IHRoaXMucGFnZVVubG9hZCgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVBdG9tIChhdG9tLCBhcmdzLCBmcmFtZXMpIHtcbiAgICBpZiAoIXRoaXMucnBjQ2xpZW50LmNvbm5lY3RlZCkgdGhyb3cgbmV3IEVycm9yKCdSZW1vdGUgZGVidWdnZXIgaXMgbm90IGNvbm5lY3RlZCcpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyBhdG9tICcke2F0b219J2ApO1xuICAgIGNvbnN0IHNjcmlwdCA9IGF3YWl0IGdldFNjcmlwdEZvckF0b20oYXRvbSwgYXJncywgZnJhbWVzKTtcbiAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZXhlY3V0ZShzY3JpcHQsIHRydWUpO1xuICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgcmVzdWx0IGZvciBhdG9tICcke2F0b219JyBleGVjdXRpb246ICR7Xy50cnVuY2F0ZShzaW1wbGVTdHJpbmdpZnkodmFsdWUpLCB7bGVuZ3RoOiBSRVNQT05TRV9MT0dfTEVOR1RIfSl9YCk7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZUF0b21Bc3luYyAoYXRvbSwgYXJncywgZnJhbWVzLCByZXNwb25zZVVybCkge1xuICAgIGxldCBhc3luY0NhbGxCYWNrID0gYGZ1bmN0aW9uIChyZXMpIHsgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGB4bWxIdHRwLm9wZW4oJ1BPU1QnLCAnJHtyZXNwb25zZVVybH0nLCB0cnVlKTtgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGB4bWxIdHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsJ2FwcGxpY2F0aW9uL2pzb24nKTsgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgeG1sSHR0cC5zZW5kKHJlcyk7IH1gO1xuICAgIGxldCBzY3JpcHQgPSBhd2FpdCBnZXRTY3JpcHRGb3JBdG9tKGF0b20sIGFyZ3MsIGZyYW1lcywgYXN5bmNDYWxsQmFjayk7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlKHNjcmlwdCk7XG4gIH1cblxuICBmcmFtZURldGFjaGVkICgpIHtcbiAgICB0aGlzLmVtaXQoUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVEKTtcbiAgfVxuXG4gIGFzeW5jIHBhZ2VMb2FkIChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vaykge1xuICAgIGxldCB0aW1lb3V0TXMgPSA1MDA7XG4gICAgbGV0IHN0YXJ0ID0gc3RhcnRQYWdlTG9hZE1zIHx8IERhdGUubm93KCk7XG4gICAgbG9nLmRlYnVnKCdQYWdlIGxvYWRlZCwgdmVyaWZ5aW5nIHdoZXRoZXIgcmVhZHknKTtcblxuICAgIGNvbnN0IHZlcmlmeSA9IGFzeW5jICgpID0+IHtcbiAgICAgIHRoaXMucGFnZUxvYWREZWxheSA9IHV0aWwuY2FuY2VsbGFibGVEZWxheSh0aW1lb3V0TXMpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5wYWdlTG9hZERlbGF5O1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBCLkNhbmNlbGxhdGlvbkVycm9yKSB7XG4gICAgICAgICAgLy8gaWYgdGhlIHByb21pc2UgaGFzIGJlZW4gY2FuY2VsbGVkXG4gICAgICAgICAgLy8gd2Ugd2FudCB0byBza2lwIGNoZWNraW5nIHRoZSByZWFkaW5lc3NcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gd2UgY2FuIGdldCB0aGlzIGNhbGxlZCBpbiB0aGUgbWlkZGxlIG9mIHRyeWluZyB0byBmaW5kIGEgbmV3IGFwcFxuICAgICAgaWYgKCF0aGlzLmFwcElkS2V5KSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnTm90IGNvbm5lY3RlZCB0byBhbiBhcHBsaWNhdGlvbi4gSWdub3JpbmcgcGFnZSBsb2FkJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKF8uaXNGdW5jdGlvbihwYWdlTG9hZFZlcmlmeUhvb2spKSB7XG4gICAgICAgIGF3YWl0IHBhZ2VMb2FkVmVyaWZ5SG9vaygpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZWFkeSA9IGF3YWl0IHRoaXMuY2hlY2tQYWdlSXNSZWFkeSgpO1xuXG4gICAgICAvLyBpZiB3ZSBhcmUgcmVhZHksIG9yIHdlJ3ZlIHNwZW5kIHRvbyBtdWNoIHRpbWUgb24gdGhpc1xuICAgICAgaWYgKHJlYWR5IHx8ICh0aGlzLnBhZ2VMb2FkTXMgPiAwICYmIChzdGFydCArIHRoaXMucGFnZUxvYWRNcykgPCBEYXRlLm5vdygpKSkge1xuICAgICAgICBsb2cuZGVidWcoJ1BhZ2UgaXMgcmVhZHknKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmRlYnVnKCdQYWdlIHdhcyBub3QgcmVhZHksIHJldHJ5aW5nJyk7XG4gICAgICAgIGF3YWl0IHZlcmlmeSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgYXdhaXQgdmVyaWZ5KCk7XG4gIH1cblxuICBjYW5jZWxQYWdlTG9hZCAoKSB7XG4gICAgbG9nLmRlYnVnKCdVbnJlZ2lzdGVyaW5nIGZyb20gcGFnZSByZWFkaW5lc3Mgbm90aWZpY2F0aW9ucycpO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5wYWdlTG9hZERlbGF5KSB7XG4gICAgICB0aGlzLnBhZ2VMb2FkRGVsYXkuY2FuY2VsKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcGFnZVVubG9hZCAoKSB7XG4gICAgbG9nLmRlYnVnKCdQYWdlIHVubG9hZGluZycpO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMud2FpdEZvckRvbSgpO1xuICB9XG5cbiAgYXN5bmMgd2FpdEZvckRvbSAoc3RhcnRQYWdlTG9hZE1zLCBwYWdlTG9hZFZlcmlmeUhvb2spIHtcbiAgICBsb2cuZGVidWcoJ1dhaXRpbmcgZm9yIGRvbS4uLicpO1xuICAgIGF3YWl0IHRoaXMucGFnZUxvYWQoc3RhcnRQYWdlTG9hZE1zLCBwYWdlTG9hZFZlcmlmeUhvb2spO1xuICB9XG5cbiAgYXN5bmMgY2hlY2tQYWdlSXNSZWFkeSAoKSB7XG4gICAgY29uc3QgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5fSk7XG4gICAgaWYgKGVycm9ycykgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgIGxvZy5kZWJ1ZygnQ2hlY2tpbmcgZG9jdW1lbnQgcmVhZHlTdGF0ZScpO1xuICAgIGNvbnN0IHJlYWR5Q21kID0gJyhmdW5jdGlvbiAoKXsgcmV0dXJuIGRvY3VtZW50LnJlYWR5U3RhdGU7IH0pKCknO1xuICAgIGxldCByZWFkeVN0YXRlID0gJ2xvYWRpbmcnO1xuICAgIHRyeSB7XG4gICAgICByZWFkeVN0YXRlID0gYXdhaXQgQi5yZXNvbHZlKHRoaXMuZXhlY3V0ZShyZWFkeUNtZCwgdHJ1ZSkpLnRpbWVvdXQodGhpcy5wYWdlUmVhZHlUaW1lb3V0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIEIuVGltZW91dEVycm9yKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBsb2cuZGVidWcoYFBhZ2UgcmVhZGluZXNzIGNoZWNrIHRpbWVkIG91dCBhZnRlciAke3RoaXMucGFnZVJlYWR5VGltZW91dH1tc2ApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYERvY3VtZW50IHJlYWR5U3RhdGUgaXMgJyR7cmVhZHlTdGF0ZX0nYCk7XG5cbiAgICByZXR1cm4gcmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJztcbiAgfVxuXG4gIGFzeW5jIG5hdlRvVXJsICh1cmwsIHBhZ2VMb2FkVmVyaWZ5SG9vaykge1xuICAgIC8vIG5vIG5lZWQgdG8gZG8gdGhpcyBjaGVjayB3aGVuIHVzaW5nIHdlYmtpdFxuICAgIGlmICh0aGlzLmRlYnVnZ2VyVHlwZSA9PT0gREVCVUdHRVJfVFlQRVMud2ViaW5zcGVjdG9yKSB7XG4gICAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXl9KTtcbiAgICAgIGlmIChlcnJvcnMpIHRocm93IG5ldyBFcnJvcihlcnJvcnMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG4gICAgfVxuXG4gICAgdGhpcy5fbmF2aWdhdGluZ1RvUGFnZSA9IHRydWU7XG5cbiAgICB0cnkge1xuICAgICAgbG9nLmRlYnVnKGBOYXZpZ2F0aW5nIHRvIG5ldyBVUkw6ICcke3VybH0nYCk7XG4gICAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZXRVcmwnLCB7XG4gICAgICAgIHVybCxcbiAgICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRoaXMudXNlTmV3U2FmYXJpKSB7XG4gICAgICAgIC8vIGEgc21hbGwgcGF1c2UgZm9yIHRoZSBicm93c2VyIHRvIGNhdGNoIHVwXG4gICAgICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmRlYnVnZ2VyVHlwZSA9PT0gREVCVUdHRVJfVFlQRVMud2ViaW5zcGVjdG9yKSB7XG4gICAgICAgIGF3YWl0IHRoaXMud2FpdEZvckZyYW1lTmF2aWdhdGVkKCk7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JEb20oRGF0ZS5ub3coKSwgcGFnZUxvYWRWZXJpZnlIb29rKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5fbmF2aWdhdGluZ1RvUGFnZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHdhaXRGb3JGcmFtZU5hdmlnYXRlZCAoKSB7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBCKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGxvZy5kZWJ1ZygnV2FpdGluZyBmb3IgZnJhbWUgbmF2aWdhdGVkIG1lc3NhZ2UuLi4nKTtcbiAgICAgIGxldCBzdGFydE1zID0gRGF0ZS5ub3coKTtcblxuICAgICAgLy8gYWRkIGEgaGFuZGxlciBmb3IgdGhlIGBQYWdlLmZyYW1lTmF2aWdhdGVkYCBtZXNzYWdlXG4gICAgICAvLyBmcm9tIHRoZSByZW1vdGUgZGVidWdnZXJcbiAgICAgIGxldCBuYXZFdmVudExpc3RlbmVyID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgRnJhbWUgbmF2aWdhdGVkIGluICR7KChEYXRlLm5vdygpIC0gc3RhcnRNcykgLyAxMDAwKX0gc2VjIGZyb20gc291cmNlOiAke3ZhbHVlfWApO1xuICAgICAgICBpZiAodGhpcy5uYXZpZ2F0aW9uRGVsYXkpIHtcbiAgICAgICAgICB0aGlzLm5hdmlnYXRpb25EZWxheS5jYW5jZWwoKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgIH07XG4gICAgICB0aGlzLnJwY0NsaWVudC5zZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoJ1BhZ2UuZnJhbWVOYXZpZ2F0ZWQnLCByZWplY3QsIG5hdkV2ZW50TGlzdGVuZXIpO1xuXG4gICAgICAvLyB0aW1lb3V0LCBpbiBjYXNlIHJlbW90ZSBkZWJ1Z2dlciBkb2Vzbid0IHJlc3BvbmQsXG4gICAgICAvLyBvciB0YWtlcyBhIGxvbmcgdGltZVxuICAgICAgaWYgKCF0aGlzLnVzZU5ld1NhZmFyaSB8fCB0aGlzLnBhZ2VMb2FkTXMgPj0gMCkge1xuICAgICAgICAvLyB1c2UgcGFnZUxvYWRNcywgb3IgYSBzbWFsbCBhbW91bnQgb2YgdGltZVxuICAgICAgICBsZXQgdGltZW91dCA9IHRoaXMudXNlTmV3U2FmYXJpID8gdGhpcy5wYWdlTG9hZE1zIDogNTAwO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25EZWxheSA9IHV0aWwuY2FuY2VsbGFibGVEZWxheSh0aW1lb3V0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLm5hdmlnYXRpb25EZWxheTtcbiAgICAgICAgICBuYXZFdmVudExpc3RlbmVyKCd0aW1lb3V0Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIG5vdGhpbmcgdG8gZG86IHdlIG9ubHkgZ2V0IGhlcmUgaWYgdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgICAgIC8vIGFscmVhZHkgbm90aWZpZWQgb2YgZnJhbWUgbmF2aWdhdGlvbiwgYW5kIHRoZSBkZWxheVxuICAgICAgICAgIC8vIHdhcyBjYW5jZWxsZWRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRUaW1lbGluZSAoZm4pIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIHJlY29yZCB0aGUgdGltZWxpbmUnKTtcbiAgICB0aGlzLnJwY0NsaWVudC5zZXRUaW1lbGluZUV2ZW50SGFuZGxlcihmbik7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0YXJ0VGltZWxpbmUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICBkZWJ1Z2dlclR5cGU6IHRoaXMuZGVidWdnZXJUeXBlXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdG9wVGltZWxpbmUgKCkge1xuICAgIGxvZy5kZWJ1ZygnU3RvcHBpbmcgdG8gcmVjb3JkIHRoZSB0aW1lbGluZScpO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0b3BUaW1lbGluZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0Q29uc29sZSAoZm4pIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIGxpc3RlbiBmb3IgSmF2YVNjcmlwdCBjb25zb2xlJyk7XG4gICAgdGhpcy5ycGNDbGllbnQuc2V0Q29uc29sZUxvZ0V2ZW50SGFuZGxlcihmbik7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0YXJ0Q29uc29sZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0b3BDb25zb2xlICgpIHtcbiAgICBsb2cuZGVidWcoJ1N0b3BwaW5nIHRvIGxpc3RlbiBmb3IgSmF2YVNjcmlwdCBjb25zb2xlJyk7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc3RvcENvbnNvbGUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICBkZWJ1Z2dlclR5cGU6IHRoaXMuZGVidWdnZXJUeXBlXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdGFydE5ldHdvcmsgKGZuKSB7XG4gICAgbG9nLmRlYnVnKCdTdGFydGluZyB0byBsaXN0ZW4gZm9yIG5ldHdvcmsgZXZlbnRzJyk7XG4gICAgdGhpcy5ycGNDbGllbnQuc2V0TmV0d29ya0xvZ0V2ZW50SGFuZGxlcihmbik7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0YXJ0TmV0d29yaycsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0b3BOZXR3b3JrICgpIHtcbiAgICBsb2cuZGVidWcoJ1N0b3BwaW5nIHRvIGxpc3RlbiBmb3IgbmV0d29yayBldmVudHMnKTtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdG9wTmV0d29yaycsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGUgKGNvbW1hbmQsIG92ZXJyaWRlKSB7XG4gICAgLy8gaWYgdGhlIHBhZ2UgaXMgbm90IGxvYWRlZCB5ZXQsIHdhaXQgZm9yIGl0XG4gICAgaWYgKHRoaXMucGFnZUxvYWRpbmcgJiYgIW92ZXJyaWRlKSB7XG4gICAgICBsb2cuZGVidWcoJ1RyeWluZyB0byBleGVjdXRlIGJ1dCBwYWdlIGlzIG5vdCBsb2FkZWQuJyk7XG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JEb20oKTtcbiAgICB9XG5cbiAgICAvLyBubyBuZWVkIHRvIGNoZWNrIGVycm9ycyBpZiBpdCBpcyB3ZWJraXRcbiAgICBpZiAodGhpcy5kZWJ1Z2dlclR5cGUgPT09IERFQlVHR0VSX1RZUEVTLndlYmluc3BlY3Rvcikge1xuICAgICAgbGV0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHthcHBJZEtleTogdGhpcy5hcHBJZEtleSwgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleX0pO1xuICAgICAgaWYgKGVycm9ycykgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSkge1xuICAgICAgYXdhaXQgdGhpcy5nYXJiYWdlQ29sbGVjdCgpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgU2VuZGluZyBqYXZhc2NyaXB0IGNvbW1hbmQgJHtfLnRydW5jYXRlKGNvbW1hbmQsIHtsZW5ndGg6IDUwfSl9YCk7XG4gICAgbGV0IHJlcyA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3NlbmRKU0NvbW1hbmQnLCB7XG4gICAgICBjb21tYW5kLFxuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgZGVidWdnZXJUeXBlOiB0aGlzLmRlYnVnZ2VyVHlwZSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmNvbnZlcnRSZXN1bHQocmVzKTtcbiAgfVxuXG4gIGFzeW5jIGNhbGxGdW5jdGlvbiAob2JqSWQsIGZuLCBhcmdzKSB7XG4gICAgbGV0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHthcHBJZEtleTogdGhpcy5hcHBJZEtleSwgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleX0pO1xuICAgIGlmIChlcnJvcnMpIHRocm93IG5ldyBFcnJvcihlcnJvcnMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICBpZiAodGhpcy5nYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSkge1xuICAgICAgYXdhaXQgdGhpcy5nYXJiYWdlQ29sbGVjdCgpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZygnQ2FsbGluZyBqYXZhc2NyaXB0IGZ1bmN0aW9uJyk7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnY2FsbEpTRnVuY3Rpb24nLCB7XG4gICAgICBvYmpJZCxcbiAgICAgIGZuLFxuICAgICAgYXJncyxcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmNvbnZlcnRSZXN1bHQocmVzKTtcbiAgfVxuXG4gIGNvbnZlcnRSZXN1bHQgKHJlcykge1xuICAgIGlmIChfLmlzVW5kZWZpbmVkKHJlcykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRGlkIG5vdCBnZXQgT0sgcmVzdWx0IGZyb20gcmVtb3RlIGRlYnVnZ2VyLiBSZXN1bHQgd2FzOiAke18udHJ1bmNhdGUoc2ltcGxlU3RyaW5naWZ5KHJlcyksIHtsZW5ndGg6IFJFU1BPTlNFX0xPR19MRU5HVEh9KX1gKTtcbiAgICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcocmVzKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzID0gSlNPTi5wYXJzZShyZXMpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIHdlIG1pZ2h0IGdldCBhIHNlcmlhbGl6ZWQgb2JqZWN0LCBidXQgd2UgbWlnaHQgbm90XG4gICAgICAgIC8vIGlmIHdlIGdldCBoZXJlLCBpdCBpcyBqdXN0IGEgdmFsdWVcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFfLmlzT2JqZWN0KHJlcykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUmVzdWx0IGhhcyB1bmV4cGVjdGVkIHR5cGU6ICgke3R5cGVvZiByZXN9KS5gKTtcbiAgICB9XG5cbiAgICBpZiAocmVzLnN0YXR1cyAmJiByZXMuc3RhdHVzICE9PSAwKSB7XG4gICAgICAvLyB3ZSBnb3Qgc29tZSBmb3JtIG9mIGVycm9yLlxuICAgICAgdGhyb3cgZXJyb3JGcm9tQ29kZShyZXMuc3RhdHVzLCByZXMudmFsdWUubWVzc2FnZSB8fCByZXMudmFsdWUpO1xuICAgIH1cblxuICAgIC8vIHdpdGggZWl0aGVyIGhhdmUgYW4gb2JqZWN0IHdpdGggYSBgdmFsdWVgIHByb3BlcnR5IChldmVuIGlmIGBudWxsYCksXG4gICAgLy8gb3IgYSBwbGFpbiBvYmplY3RcbiAgICByZXR1cm4gcmVzLmhhc093blByb3BlcnR5KCd2YWx1ZScpID8gcmVzLnZhbHVlIDogcmVzO1xuICB9XG5cbiAgYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCAoYWxsb3cgPSB0cnVlKSB7XG4gICAgaWYgKF8uaXNGdW5jdGlvbih0aGlzLnJwY0NsaWVudC5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkKSkge1xuICAgICAgdGhpcy5ycGNDbGllbnQuYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZChhbGxvdyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0Q29va2llcyAodXJscykge1xuICAgIGxvZy5kZWJ1ZygnR2V0dGluZyBuZXR3b3JrIGNvb2tpZXMnKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnZ2V0Q29va2llcycsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGUsXG4gICAgICB1cmxzLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlQ29va2llIChjb29raWVOYW1lLCB1cmwpIHtcbiAgICBsb2cuZGVidWcoYERlbGV0aW5nIGNvb2tpZSAnJHtjb29raWVOYW1lfScgb24gJyR7dXJsfSdgKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnZGVsZXRlQ29va2llJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgZGVidWdnZXJUeXBlOiB0aGlzLmRlYnVnZ2VyVHlwZSxcbiAgICAgIGNvb2tpZU5hbWUsXG4gICAgICB1cmwsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnYXJiYWdlQ29sbGVjdCAodGltZW91dE1zID0gR0FSQkFHRV9DT0xMRUNUX1RJTUVPVVQpIHtcbiAgICBsb2cuZGVidWcoYEdhcmJhZ2UgY29sbGVjdGluZyB3aXRoICR7dGltZW91dE1zfW1zIHRpbWVvdXRgKTtcbiAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gICAgaWYgKGVycm9ycykge1xuICAgICAgbG9nLmRlYnVnKGBVbmFibGUgdG8gY29sbGVjdCBnYXJiYWdlIGF0IHRoaXMgdGltZWApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGF3YWl0IEIucmVzb2x2ZSh0aGlzLnJwY0NsaWVudC5zZW5kKCdnYXJiYWdlQ29sbGVjdCcsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIGRlYnVnZ2VyVHlwZTogdGhpcy5kZWJ1Z2dlclR5cGVcbiAgICB9KSkudGltZW91dCh0aW1lb3V0TXMpXG4gICAgLnRoZW4oZnVuY3Rpb24gZ2NTdWNjZXNzICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG4gICAgICBsb2cuZGVidWcoYEdhcmJhZ2UgY29sbGVjdGlvbiBzdWNjZXNzZnVsYCk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gZ2NFcnJvciAoZXJyKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzXG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgQi5UaW1lb3V0RXJyb3IpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBHYXJiYWdlIGNvbGxlY3Rpb24gdGltZWQgb3V0IGFmdGVyICR7dGltZW91dE1zfW1zYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBjb2xsZWN0IGdhcmJhZ2U6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuLy8gZXZlbnQgZW1pdHRlZCBwdWJsaWNhbGx5XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9QQUdFX0NIQU5HRSA9ICdyZW1vdGVfZGVidWdnZXJfcGFnZV9jaGFuZ2UnO1xuUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVEID0gJ3JlbW90ZV9kZWJ1Z2dlcl9mcmFtZXNfZGV0YWNoZWQnO1xuUmVtb3RlRGVidWdnZXIuRVZFTlRfRElTQ09OTkVDVCA9ICdyZW1vdGVfZGVidWdnZXJfZGlzY29ubmVjdCc7XG5cbi8vIGFkZCBnZW5lcmljIGNhbGxiYWNrc1xuZm9yIChjb25zdCBbbmFtZSwgaGFuZGxlcl0gb2YgXy50b1BhaXJzKG1lc3NhZ2VIYW5kbGVycykpIHtcbiAgUmVtb3RlRGVidWdnZXIucHJvdG90eXBlW25hbWVdID0gaGFuZGxlcjtcbn1cblxuZXhwb3J0IHtcbiAgUmVtb3RlRGVidWdnZXIsIERFQlVHR0VSX1RZUEVTLCBSRU1PVEVfREVCVUdHRVJfUE9SVCwgUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVMsXG59O1xuIl0sImZpbGUiOiJsaWIvcmVtb3RlLWRlYnVnZ2VyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
