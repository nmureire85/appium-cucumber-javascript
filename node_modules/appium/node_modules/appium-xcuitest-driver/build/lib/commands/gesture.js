"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.gesturesChainToString = gesturesChainToString;
exports.default = exports.commands = exports.helpers = exports.extensions = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _appiumIosDriver = require("appium-ios-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

let helpers = {},
    extensions = {},
    commands = {};
exports.commands = commands;
exports.extensions = extensions;
exports.helpers = helpers;
commands.moveTo = _appiumIosDriver.iosCommands.gesture.moveTo;

function requireFloatParameter(paramName, paramValue, methodName) {
  if (_lodash.default.isUndefined(paramValue)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter is mandatory for "${methodName}" call`);
  }

  const result = parseFloat(paramValue);

  if (isNaN(result)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter should be a valid number. "${paramValue}" is given instead`);
  }

  return result;
}

function requireIntParameter(paramName, paramValue, methodName) {
  if (_lodash.default.isUndefined(paramValue)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter is mandatory for "${methodName}" call`);
  }

  const result = parseInt(paramValue, 10);

  if (isNaN(result)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter should be a valid integer. "${paramValue}" is given instead`);
  }

  return result;
}

commands.mobileShake = async function mobileShake() {
  if (!this.isSimulator()) {
    throw new _appiumBaseDriver.errors.UnknownError('Shake is not supported on real devices');
  }

  await this.opts.device.shake();
};

commands.click = async function click(el) {
  if (!this.isWebContext()) {
    return await this.nativeClick(el);
  }

  el = _appiumSupport.util.unwrapElement(el);

  if ((await this.settings.getSettings()).nativeWebTap || (await this.settings.getSettings()).nativeWebTapStrict) {
    _logger.default.debug('Using native web tap');

    await this.nativeWebTap(el);
  } else {
    const atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('click', [atomsElement]);
  }
};

function gesturesChainToString(gestures, keysToInclude = ['options']) {
  return gestures.map(item => {
    let otherKeys = _lodash.default.difference(_lodash.default.keys(item), ['action']);

    otherKeys = _lodash.default.isArray(keysToInclude) ? _lodash.default.intersection(otherKeys, keysToInclude) : otherKeys;

    if (otherKeys.length) {
      return `${item.action}` + `(${_lodash.default.map(otherKeys, x => x + '=' + (_lodash.default.isPlainObject(item[x]) ? JSON.stringify(item[x]) : item[x])).join(', ')})`;
    }

    return item.action;
  }).join('-');
}

commands.performActions = async function performActions(actions) {
  _logger.default.debug(`Received the following W3C actions: ${JSON.stringify(actions, null, '  ')}`);

  const preprocessedActions = actions.map(action => Object.assign({}, action, action.type === 'pointer' ? {
    parameters: {
      pointerType: 'touch'
    }
  } : {})).map(action => {
    const modifiedAction = _lodash.default.clone(action) || {};
    modifiedAction.actions = (action.actions || []).filter(innerAction => !(innerAction.type === 'pause' && innerAction.duration === 0));
    return modifiedAction;
  });

  _logger.default.debug(`Preprocessed actions: ${JSON.stringify(preprocessedActions, null, '  ')}`);

  return await this.proxyCommand('/actions', 'POST', {
    actions: preprocessedActions
  });
};

commands.performTouch = async function performTouch(gestures) {
  _logger.default.debug(`Received the following touch action: ${gesturesChainToString(gestures)}`);

  try {
    return await this.proxyCommand('/wda/touch/perform', 'POST', {
      actions: gestures
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The Touch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate touch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.performMultiAction = async function performMultiAction(actions) {
  _logger.default.debug(`Received the following multi touch action:`);

  for (let i in actions) {
    _logger.default.debug(`    ${parseInt(i, 10) + 1}: ${_lodash.default.map(actions[i], 'action').join('-')}`);
  }

  try {
    return await this.proxyCommand('/wda/touch/multi/perform', 'POST', {
      actions
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The MultiTouch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate multitouch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.nativeClick = async function nativeClick(el) {
  el = _appiumSupport.util.unwrapElement(el);
  let endpoint = `/element/${el}/click`;
  return await this.proxyCommand(endpoint, 'POST', {});
};

helpers.mobileScroll = async function mobileScroll(opts = {}, swipe = false) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  let params = {};

  if (opts.name && !swipe) {
    params.name = opts.name;
  } else if (opts.direction) {
    if (!['up', 'down', 'left', 'right'].includes(opts.direction.toLowerCase())) {
      let msg = 'Direction must be up, down, left or right';

      _logger.default.errorAndThrow(msg);
    }

    params.direction = opts.direction;
  } else if (opts.predicateString && !swipe) {
    params.predicateString = opts.predicateString;
  } else if (opts.toVisible && !swipe) {
    params.toVisible = opts.toVisible;
  } else {
    let msg = swipe ? 'Mobile swipe requires direction' : 'Mobile scroll supports the following strategies: name, direction, predicateString, and toVisible. Specify one of these';

    _logger.default.errorAndThrow(msg);
  }

  if (!swipe && opts.distance) {
    params.distance = opts.distance;
  }

  let element = _appiumSupport.util.unwrapElement(opts.element);

  let endpoint = `/wda/element/${element}/${swipe ? 'swipe' : 'scroll'}`;
  return await this.proxyCommand(endpoint, 'POST', params);
};

helpers.mobileSwipe = async function mobileSwipe(opts = {}) {
  return await this.mobileScroll(opts, true);
};

helpers.mobilePinch = async function mobilePinch(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const params = {
    scale: requireFloatParameter('scale', opts.scale, 'pinch'),
    velocity: requireFloatParameter('velocity', opts.velocity, 'pinch')
  };

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/pinch`, 'POST', params);
};

helpers.mobileDoubleTap = async function mobileDoubleTap(opts = {}) {
  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/doubleTap`, 'POST');
  }

  const params = {
    x: requireFloatParameter('x', opts.x, 'doubleTap'),
    y: requireFloatParameter('y', opts.y, 'doubleTap')
  };
  return await this.proxyCommand('/wda/doubleTap', 'POST', params);
};

helpers.mobileTwoFingerTap = async function mobileTwoFingerTap(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/twoFingerTap`, 'POST');
};

helpers.mobileTouchAndHold = async function mobileTouchAndHold(opts = {}) {
  let params = {
    duration: requireFloatParameter('duration', opts.duration, 'touchAndHold')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/touchAndHold`, 'POST', params);
  }

  params.x = requireFloatParameter('x', opts.x, 'touchAndHold');
  params.y = requireFloatParameter('y', opts.y, 'touchAndHold');
  return await this.proxyCommand('/wda/touchAndHold', 'POST', params);
};

helpers.mobileTap = async function mobileTap(opts = {}) {
  const params = {
    x: requireFloatParameter('x', opts.x, 'tap'),
    y: requireFloatParameter('y', opts.y, 'tap')
  };
  const el = opts.element ? _appiumSupport.util.unwrapElement(opts.element) : '0';
  return await this.proxyCommand(`/wda/tap/${el}`, 'POST', params);
};

helpers.mobileDragFromToForDuration = async function mobileDragFromToForDuration(opts = {}) {
  const params = {
    duration: requireFloatParameter('duration', opts.duration, 'dragFromToForDuration'),
    fromX: requireFloatParameter('fromX', opts.fromX, 'dragFromToForDuration'),
    fromY: requireFloatParameter('fromY', opts.fromY, 'dragFromToForDuration'),
    toX: requireFloatParameter('toX', opts.toX, 'dragFromToForDuration'),
    toY: requireFloatParameter('toY', opts.toY, 'dragFromToForDuration')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/dragfromtoforduration`, 'POST', params);
  }

  return await this.proxyCommand('/wda/dragfromtoforduration', 'POST', params);
};

helpers.mobileTapWithNumberOfTaps = async function mobileTapWithNumberOfTaps(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for tapWithNumberOfTaps method');
  }

  const params = {
    numberOfTaps: requireIntParameter('numberOfTaps', opts.numberOfTaps, 'tapWithNumberOfTaps'),
    numberOfTouches: requireIntParameter('numberOfTouches', opts.numberOfTouches, 'tapWithNumberOfTaps')
  };

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/tapWithNumberOfTaps`, 'POST', params);
};

helpers.mobileSelectPickerWheelValue = async function mobileSelectPickerWheelValue(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for selectPickerWheelValue method');
  }

  if (!_lodash.default.isString(opts.order) || !['next', 'previous'].includes(opts.order.toLowerCase())) {
    _logger.default.errorAndThrow(`The mandatory 'order' parameter is expected to be equal either to 'next' or 'previous'. ` + `'${opts.order}' is given instead`);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  const params = {
    order: opts.order
  };

  if (opts.offset) {
    params.offset = requireFloatParameter('offset', opts.offset, 'selectPickerWheelValue');
  }

  return await this.proxyCommand(`/wda/pickerwheel/${el}/select`, 'POST', params);
};

helpers.mobileRotateElement = async function mobileRotateElement(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for rotateElement method');
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  const params = {
    rotation: requireFloatParameter('rotation', opts.rotation, 'rotateElement'),
    velocity: requireFloatParameter('velocity', opts.velocity, 'rotateElement')
  };
  return await this.proxyCommand(`/wda/element/${el}/rotate`, 'POST', params);
};

helpers.getCoordinates = async function getCoordinates(gesture) {
  let el = gesture.options.element;
  let coordinates = {
    x: 0,
    y: 0,
    areOffsets: false
  };
  let optionX = null;

  if (gesture.options.x) {
    optionX = requireFloatParameter('x', gesture.options.x, 'getCoordinates');
  }

  let optionY = null;

  if (gesture.options.y) {
    optionY = requireFloatParameter('y', gesture.options.y, 'getCoordinates');
  }

  if (el) {
    let rect = await this.getElementRect(el);
    let pos = {
      x: rect.x,
      y: rect.y
    };
    let size = {
      w: rect.width,
      h: rect.height
    };
    let offsetX = 0;
    let offsetY = 0;

    if (optionX || optionY) {
      offsetX = optionX || 0;
      offsetY = optionY || 0;
    } else {
      offsetX = size.w / 2;
      offsetY = size.h / 2;
    }

    coordinates.x = pos.x + offsetX;
    coordinates.y = pos.y + offsetY;
  } else {
    coordinates.areOffsets = gesture.action === 'moveTo';
    coordinates.x = optionX || 0;
    coordinates.y = optionY || 0;
  }

  return coordinates;
};

helpers.applyMoveToOffset = function applyMoveToOffset(firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

Object.assign(extensions, helpers, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbImhlbHBlcnMiLCJleHRlbnNpb25zIiwiY29tbWFuZHMiLCJtb3ZlVG8iLCJpb3NDb21tYW5kcyIsImdlc3R1cmUiLCJyZXF1aXJlRmxvYXRQYXJhbWV0ZXIiLCJwYXJhbU5hbWUiLCJwYXJhbVZhbHVlIiwibWV0aG9kTmFtZSIsIl8iLCJpc1VuZGVmaW5lZCIsImxvZyIsImVycm9yQW5kVGhyb3ciLCJyZXN1bHQiLCJwYXJzZUZsb2F0IiwiaXNOYU4iLCJyZXF1aXJlSW50UGFyYW1ldGVyIiwicGFyc2VJbnQiLCJtb2JpbGVTaGFrZSIsImlzU2ltdWxhdG9yIiwiZXJyb3JzIiwiVW5rbm93bkVycm9yIiwib3B0cyIsImRldmljZSIsInNoYWtlIiwiY2xpY2siLCJlbCIsImlzV2ViQ29udGV4dCIsIm5hdGl2ZUNsaWNrIiwidXRpbCIsInVud3JhcEVsZW1lbnQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibmF0aXZlV2ViVGFwIiwibmF0aXZlV2ViVGFwU3RyaWN0IiwiZGVidWciLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJleGVjdXRlQXRvbSIsImdlc3R1cmVzQ2hhaW5Ub1N0cmluZyIsImdlc3R1cmVzIiwia2V5c1RvSW5jbHVkZSIsIm1hcCIsIml0ZW0iLCJvdGhlcktleXMiLCJkaWZmZXJlbmNlIiwia2V5cyIsImlzQXJyYXkiLCJpbnRlcnNlY3Rpb24iLCJsZW5ndGgiLCJhY3Rpb24iLCJ4IiwiaXNQbGFpbk9iamVjdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJqb2luIiwicGVyZm9ybUFjdGlvbnMiLCJhY3Rpb25zIiwicHJlcHJvY2Vzc2VkQWN0aW9ucyIsIk9iamVjdCIsImFzc2lnbiIsInR5cGUiLCJwYXJhbWV0ZXJzIiwicG9pbnRlclR5cGUiLCJtb2RpZmllZEFjdGlvbiIsImNsb25lIiwiZmlsdGVyIiwiaW5uZXJBY3Rpb24iLCJkdXJhdGlvbiIsInByb3h5Q29tbWFuZCIsInBlcmZvcm1Ub3VjaCIsImUiLCJtZXNzYWdlIiwicGVyZm9ybU11bHRpQWN0aW9uIiwiaSIsImVuZHBvaW50IiwibW9iaWxlU2Nyb2xsIiwic3dpcGUiLCJlbGVtZW50IiwiZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzIiwicGFyYW1zIiwibmFtZSIsImRpcmVjdGlvbiIsImluY2x1ZGVzIiwidG9Mb3dlckNhc2UiLCJtc2ciLCJwcmVkaWNhdGVTdHJpbmciLCJ0b1Zpc2libGUiLCJkaXN0YW5jZSIsIm1vYmlsZVN3aXBlIiwibW9iaWxlUGluY2giLCJzY2FsZSIsInZlbG9jaXR5IiwibW9iaWxlRG91YmxlVGFwIiwieSIsIm1vYmlsZVR3b0ZpbmdlclRhcCIsIm1vYmlsZVRvdWNoQW5kSG9sZCIsIm1vYmlsZVRhcCIsIm1vYmlsZURyYWdGcm9tVG9Gb3JEdXJhdGlvbiIsImZyb21YIiwiZnJvbVkiLCJ0b1giLCJ0b1kiLCJtb2JpbGVUYXBXaXRoTnVtYmVyT2ZUYXBzIiwibnVtYmVyT2ZUYXBzIiwibnVtYmVyT2ZUb3VjaGVzIiwibW9iaWxlU2VsZWN0UGlja2VyV2hlZWxWYWx1ZSIsImlzU3RyaW5nIiwib3JkZXIiLCJvZmZzZXQiLCJtb2JpbGVSb3RhdGVFbGVtZW50Iiwicm90YXRpb24iLCJnZXRDb29yZGluYXRlcyIsIm9wdGlvbnMiLCJjb29yZGluYXRlcyIsImFyZU9mZnNldHMiLCJvcHRpb25YIiwib3B0aW9uWSIsInJlY3QiLCJnZXRFbGVtZW50UmVjdCIsInBvcyIsInNpemUiLCJ3Iiwid2lkdGgiLCJoIiwiaGVpZ2h0Iiwib2Zmc2V0WCIsIm9mZnNldFkiLCJhcHBseU1vdmVUb09mZnNldCIsImZpcnN0Q29vcmRpbmF0ZXMiLCJzZWNvbmRDb29yZGluYXRlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsSUFBSUEsT0FBTyxHQUFHLEVBQWQ7QUFBQSxJQUFrQkMsVUFBVSxHQUFHLEVBQS9CO0FBQUEs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V0FBTztBQUNMaEUsTUFBQUEsQ0FBQyxFQUFFOEUsZ0JBQWdCLENBQUM5RSxDQUFqQixHQUFxQitFLGlCQUFpQixDQUFDL0UsQ0FEckM7QUFFTDJDLE1BQUFBLENBQUMsRUFBRW1DLGdCQUFnQixDQUFDbkMsQ0FBakIsR0FBcUJvQyxpQkFBaUIsQ0FBQ3BDO0FBRnJDLEtBQVA7QUFJRCxHQUxELE1BS087QUFDTCxXQUFPb0MsaUJBQVA7QUFDRDtBQUNGLENBVEQ7O0FBV0F2RSxNQUFNLENBQUNDLE1BQVAsQ0FBYzVELFVBQWQsRUFBMEJELE9BQTFCLEVBQW1DRSxRQUFuQztlQUVlRCxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBpb3NDb21tYW5kcyB9IGZyb20gJ2FwcGl1bS1pb3MtZHJpdmVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5cblxubGV0IGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9LCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5tb3ZlVG8gPSBpb3NDb21tYW5kcy5nZXN0dXJlLm1vdmVUbztcblxuXG5mdW5jdGlvbiByZXF1aXJlRmxvYXRQYXJhbWV0ZXIgKHBhcmFtTmFtZSwgcGFyYW1WYWx1ZSwgbWV0aG9kTmFtZSkge1xuICBpZiAoXy5pc1VuZGVmaW5lZChwYXJhbVZhbHVlKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBcIiR7cGFyYW1OYW1lfVwiIHBhcmFtZXRlciBpcyBtYW5kYXRvcnkgZm9yIFwiJHttZXRob2ROYW1lfVwiIGNhbGxgKTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBwYXJzZUZsb2F0KHBhcmFtVmFsdWUpO1xuICBpZiAoaXNOYU4ocmVzdWx0KSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBcIiR7cGFyYW1OYW1lfVwiIHBhcmFtZXRlciBzaG91bGQgYmUgYSB2YWxpZCBudW1iZXIuIFwiJHtwYXJhbVZhbHVlfVwiIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiByZXF1aXJlSW50UGFyYW1ldGVyIChwYXJhbU5hbWUsIHBhcmFtVmFsdWUsIG1ldGhvZE5hbWUpIHtcbiAgaWYgKF8uaXNVbmRlZmluZWQocGFyYW1WYWx1ZSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgXCIke3BhcmFtTmFtZX1cIiBwYXJhbWV0ZXIgaXMgbWFuZGF0b3J5IGZvciBcIiR7bWV0aG9kTmFtZX1cIiBjYWxsYCk7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gcGFyc2VJbnQocGFyYW1WYWx1ZSwgMTApO1xuICBpZiAoaXNOYU4ocmVzdWx0KSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBcIiR7cGFyYW1OYW1lfVwiIHBhcmFtZXRlciBzaG91bGQgYmUgYSB2YWxpZCBpbnRlZ2VyLiBcIiR7cGFyYW1WYWx1ZX1cIiBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuY29tbWFuZHMubW9iaWxlU2hha2UgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTaGFrZSAoKSB7XG4gIGlmICghdGhpcy5pc1NpbXVsYXRvcigpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoJ1NoYWtlIGlzIG5vdCBzdXBwb3J0ZWQgb24gcmVhbCBkZXZpY2VzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5zaGFrZSgpO1xufTtcblxuY29tbWFuZHMuY2xpY2sgPSBhc3luYyBmdW5jdGlvbiBjbGljayAoZWwpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgLy8gdGhlcmUgYXJlIG11bHRpcGxlIGNvbW1hbmRzIHRoYXQgbWFwIGhlcmUsIHNvIG1hbnVhbGx5IHByb3h5XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubmF0aXZlQ2xpY2soZWwpO1xuICB9XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKChhd2FpdCB0aGlzLnNldHRpbmdzLmdldFNldHRpbmdzKCkpLm5hdGl2ZVdlYlRhcCB8fCAoYXdhaXQgdGhpcy5zZXR0aW5ncy5nZXRTZXR0aW5ncygpKS5uYXRpdmVXZWJUYXBTdHJpY3QpIHtcbiAgICAvLyBhdG9tcy1iYXNlZCBjbGlja3MgZG9uJ3QgYWx3YXlzIHdvcmsgaW4gc2FmYXJpIDdcbiAgICBsb2cuZGVidWcoJ1VzaW5nIG5hdGl2ZSB3ZWIgdGFwJyk7XG4gICAgYXdhaXQgdGhpcy5uYXRpdmVXZWJUYXAoZWwpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xpY2snLCBbYXRvbXNFbGVtZW50XSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdlc3R1cmVzQ2hhaW5Ub1N0cmluZyAoZ2VzdHVyZXMsIGtleXNUb0luY2x1ZGUgPSBbJ29wdGlvbnMnXSkge1xuICByZXR1cm4gZ2VzdHVyZXMubWFwKChpdGVtKSA9PiB7XG4gICAgbGV0IG90aGVyS2V5cyA9IF8uZGlmZmVyZW5jZShfLmtleXMoaXRlbSksIFsnYWN0aW9uJ10pO1xuICAgIG90aGVyS2V5cyA9IF8uaXNBcnJheShrZXlzVG9JbmNsdWRlKSA/IF8uaW50ZXJzZWN0aW9uKG90aGVyS2V5cywga2V5c1RvSW5jbHVkZSkgOiBvdGhlcktleXM7XG4gICAgaWYgKG90aGVyS2V5cy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBgJHtpdGVtLmFjdGlvbn1gICtcbiAgICAgICAgYCgke18ubWFwKG90aGVyS2V5cywgKHgpID0+IHggKyAnPScgKyAoXy5pc1BsYWluT2JqZWN0KGl0ZW1beF0pID8gSlNPTi5zdHJpbmdpZnkoaXRlbVt4XSkgOiBpdGVtW3hdKSkuam9pbignLCAnKX0pYDtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW0uYWN0aW9uO1xuICB9KS5qb2luKCctJyk7XG59XG5cbmNvbW1hbmRzLnBlcmZvcm1BY3Rpb25zID0gYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUFjdGlvbnMgKGFjdGlvbnMpIHtcbiAgbG9nLmRlYnVnKGBSZWNlaXZlZCB0aGUgZm9sbG93aW5nIFczQyBhY3Rpb25zOiAke0pTT04uc3RyaW5naWZ5KGFjdGlvbnMsIG51bGwsICcgICcpfWApO1xuICAvLyBUaGlzIGlzIG1hbmRhdG9yeSwgc2luY2UgV0RBIG9ubHkgc3VwcG9ydHMgVE9VQ0ggcG9pbnRlciB0eXBlXG4gIC8vIGFuZCBTZWxlbml1bSBBUEkgdXNlcyBNT1VTRSBhcyB0aGUgZGVmYXVsdCBvbmVcbiAgY29uc3QgcHJlcHJvY2Vzc2VkQWN0aW9ucyA9IGFjdGlvbnNcbiAgICAubWFwKChhY3Rpb24pID0+IE9iamVjdC5hc3NpZ24oe30sIGFjdGlvbiwgYWN0aW9uLnR5cGUgPT09ICdwb2ludGVyJyA/IHtcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgcG9pbnRlclR5cGU6ICd0b3VjaCdcbiAgICAgIH1cbiAgICB9IDoge30pKVxuICAgIC5tYXAoKGFjdGlvbikgPT4ge1xuICAgICAgY29uc3QgbW9kaWZpZWRBY3Rpb24gPSBfLmNsb25lKGFjdGlvbikgfHwge307XG4gICAgICAvLyBTZWxlbml1bSBBUEkgdW5leHBlY3RlZGx5IGluc2VydHMgemVybyBwYXVzZXMsIHdoaWNoIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IFdEQVxuICAgICAgbW9kaWZpZWRBY3Rpb24uYWN0aW9ucyA9IChhY3Rpb24uYWN0aW9ucyB8fCBbXSlcbiAgICAgICAgLmZpbHRlcigoaW5uZXJBY3Rpb24pID0+ICEoaW5uZXJBY3Rpb24udHlwZSA9PT0gJ3BhdXNlJyAmJiBpbm5lckFjdGlvbi5kdXJhdGlvbiA9PT0gMCkpO1xuICAgICAgcmV0dXJuIG1vZGlmaWVkQWN0aW9uO1xuICAgIH0pO1xuICBsb2cuZGVidWcoYFByZXByb2Nlc3NlZCBhY3Rpb25zOiAke0pTT04uc3RyaW5naWZ5KHByZXByb2Nlc3NlZEFjdGlvbnMsIG51bGwsICcgICcpfWApO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy9hY3Rpb25zJywgJ1BPU1QnLCB7YWN0aW9uczogcHJlcHJvY2Vzc2VkQWN0aW9uc30pO1xufTtcblxuY29tbWFuZHMucGVyZm9ybVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gcGVyZm9ybVRvdWNoIChnZXN0dXJlcykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgdG91Y2ggYWN0aW9uOiAke2dlc3R1cmVzQ2hhaW5Ub1N0cmluZyhnZXN0dXJlcyl9YCk7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL3RvdWNoL3BlcmZvcm0nLCAnUE9TVCcsIHthY3Rpb25zOiBnZXN0dXJlc30pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnVGhlIFRvdWNoIEFQSSBpcyBhaW1lZCBmb3IgdXNhZ2UgaW4gTkFUSVZFIGNvbnRleHQuICcgK1xuICAgICAgJ0NvbnNpZGVyIHVzaW5nIFwiZXhlY3V0ZVwiIEFQSSB3aXRoIGN1c3RvbSBldmVudHMgdHJpZ2dlciBzY3JpcHQgJyArXG4gICAgICBgdG8gZW11bGF0ZSB0b3VjaCBldmVudHMgYmVpbmcgaW4gV0VCVklFVyBjb250ZXh0LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnBlcmZvcm1NdWx0aUFjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1NdWx0aUFjdGlvbiAoYWN0aW9ucykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgbXVsdGkgdG91Y2ggYWN0aW9uOmApO1xuICBmb3IgKGxldCBpIGluIGFjdGlvbnMpIHtcbiAgICBsb2cuZGVidWcoYCAgICAke3BhcnNlSW50KGksIDEwKSArIDF9OiAke18ubWFwKGFjdGlvbnNbaV0sICdhY3Rpb24nKS5qb2luKCctJyl9YCk7XG4gIH1cbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvdG91Y2gvbXVsdGkvcGVyZm9ybScsICdQT1NUJywge2FjdGlvbnN9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ1RoZSBNdWx0aVRvdWNoIEFQSSBpcyBhaW1lZCBmb3IgdXNhZ2UgaW4gTkFUSVZFIGNvbnRleHQuICcgK1xuICAgICAgJ0NvbnNpZGVyIHVzaW5nIFwiZXhlY3V0ZVwiIEFQSSB3aXRoIGN1c3RvbSBldmVudHMgdHJpZ2dlciBzY3JpcHQgJyArXG4gICAgICBgdG8gZW11bGF0ZSBtdWx0aXRvdWNoIGV2ZW50cyBiZWluZyBpbiBXRUJWSUVXIGNvbnRleHQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuY29tbWFuZHMubmF0aXZlQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiBuYXRpdmVDbGljayAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBsZXQgZW5kcG9pbnQgPSBgL2VsZW1lbnQvJHtlbH0vY2xpY2tgO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsICdQT1NUJywge30pO1xufTtcblxuLypcbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svV2ViRHJpdmVyQWdlbnQvYmxvYi9tYXN0ZXIvV2ViRHJpdmVyQWdlbnRMaWIvQ29tbWFuZHMvRkJFbGVtZW50Q29tbWFuZHMubVxuICogdG8gZ2V0IHRoZSBpbmZvIGFib3V0IGF2YWlsYWJsZSBXREEgZ2VzdHVyZXMgQVBJXG4gKlxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9yZWZlcmVuY2UveGN0ZXN0L3hjdWllbGVtZW50IGFuZFxuICogaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL3JlZmVyZW5jZS94Y3Rlc3QveGN1aWNvb3JkaW5hdGUgdG8gZ2V0IHRoZSBkZXRhaWxlZCBkZXNjcmlwdGlvbiBvZlxuICogYWxsIFhDVGVzdCBnZXN0dXJlc1xuKi9cblxuaGVscGVycy5tb2JpbGVTY3JvbGwgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTY3JvbGwgKG9wdHMgPSB7fSwgc3dpcGUgPSBmYWxzZSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKGBjbGFzcyBuYW1lYCwgYFhDVUlFbGVtZW50VHlwZUFwcGxpY2F0aW9uYCwgZmFsc2UpO1xuICB9XG4gIC8vIFdEQSBzdXBwb3J0cyBmb3VyIHNjcm9sbGluZyBzdHJhdGVnaWVzOiBwcmVkaWNhdGlvbiBiYXNlZCBvbiBuYW1lLCBkaXJlY3Rpb24sXG4gIC8vIHByZWRpY2F0ZVN0cmluZywgYW5kIHRvVmlzaWJsZSwgaW4gdGhhdCBvcmRlci4gU3dpcGluZyByZXF1aXJlcyBkaXJlY3Rpb24uXG4gIGxldCBwYXJhbXMgPSB7fTtcbiAgaWYgKG9wdHMubmFtZSAmJiAhc3dpcGUpIHtcbiAgICBwYXJhbXMubmFtZSA9IG9wdHMubmFtZTtcbiAgfSBlbHNlIGlmIChvcHRzLmRpcmVjdGlvbikge1xuICAgIGlmICghWyd1cCcsICdkb3duJywgJ2xlZnQnLCAncmlnaHQnXS5pbmNsdWRlcyhvcHRzLmRpcmVjdGlvbi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgbGV0IG1zZyA9ICdEaXJlY3Rpb24gbXVzdCBiZSB1cCwgZG93biwgbGVmdCBvciByaWdodCc7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgIH1cbiAgICBwYXJhbXMuZGlyZWN0aW9uID0gb3B0cy5kaXJlY3Rpb247XG4gIH0gZWxzZSBpZiAob3B0cy5wcmVkaWNhdGVTdHJpbmcgJiYgIXN3aXBlKSB7XG4gICAgcGFyYW1zLnByZWRpY2F0ZVN0cmluZyA9IG9wdHMucHJlZGljYXRlU3RyaW5nO1xuICB9IGVsc2UgaWYgKG9wdHMudG9WaXNpYmxlICYmICFzd2lwZSkge1xuICAgIHBhcmFtcy50b1Zpc2libGUgPSBvcHRzLnRvVmlzaWJsZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgbXNnID0gc3dpcGVcbiAgICAgID8gJ01vYmlsZSBzd2lwZSByZXF1aXJlcyBkaXJlY3Rpb24nXG4gICAgICA6ICdNb2JpbGUgc2Nyb2xsIHN1cHBvcnRzIHRoZSBmb2xsb3dpbmcgc3RyYXRlZ2llczogbmFtZSwgZGlyZWN0aW9uLCBwcmVkaWNhdGVTdHJpbmcsIGFuZCB0b1Zpc2libGUuIFNwZWNpZnkgb25lIG9mIHRoZXNlJztcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICB9XG5cbiAgLy8gd2UgY2FuIGFsc28gb3B0aW9uYWxseSBwYXNzIGEgZGlzdGFuY2Ugd2hpY2ggYXBwZWFycyB0byBiZSBhIHJhdGlvIG9mXG4gIC8vIHNjcmVlbiBoZWlnaHQsIHNvIDEuMCBtZWFucyBhIGZ1bGwgc2NyZWVuJ3Mgd29ydGggb2Ygc2Nyb2xsaW5nXG4gIGlmICghc3dpcGUgJiYgb3B0cy5kaXN0YW5jZSkge1xuICAgIHBhcmFtcy5kaXN0YW5jZSA9IG9wdHMuZGlzdGFuY2U7XG4gIH1cblxuICBsZXQgZWxlbWVudCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICBsZXQgZW5kcG9pbnQgPSBgL3dkYS9lbGVtZW50LyR7ZWxlbWVudH0vJHtzd2lwZSA/ICdzd2lwZScgOiAnc2Nyb2xsJ31gO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlU3dpcGUgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTd2lwZSAob3B0cyA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLm1vYmlsZVNjcm9sbChvcHRzLCB0cnVlKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlUGluY2ggPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVQaW5jaCAob3B0cyA9IHt9KSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgb3B0cy5lbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoYGNsYXNzIG5hbWVgLCBgWENVSUVsZW1lbnRUeXBlQXBwbGljYXRpb25gLCBmYWxzZSk7XG4gIH1cbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHNjYWxlOiByZXF1aXJlRmxvYXRQYXJhbWV0ZXIoJ3NjYWxlJywgb3B0cy5zY2FsZSwgJ3BpbmNoJyksXG4gICAgdmVsb2NpdHk6IHJlcXVpcmVGbG9hdFBhcmFtZXRlcigndmVsb2NpdHknLCBvcHRzLnZlbG9jaXR5LCAncGluY2gnKVxuICB9O1xuICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS9waW5jaGAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlRG91YmxlVGFwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlRG91YmxlVGFwIChvcHRzID0ge30pIHtcbiAgaWYgKG9wdHMuZWxlbWVudCkge1xuICAgIC8vIERvdWJsZSB0YXAgZWxlbWVudFxuICAgIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vZG91YmxlVGFwYCwgJ1BPU1QnKTtcbiAgfVxuICAvLyBEb3VibGUgdGFwIGNvb3JkaW5hdGVzXG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICB4OiByZXF1aXJlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBvcHRzLngsICdkb3VibGVUYXAnKSxcbiAgICB5OiByZXF1aXJlRmxvYXRQYXJhbWV0ZXIoJ3knLCBvcHRzLnksICdkb3VibGVUYXAnKVxuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvZG91YmxlVGFwJywgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVUd29GaW5nZXJUYXAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVUd29GaW5nZXJUYXAgKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKGBjbGFzcyBuYW1lYCwgYFhDVUlFbGVtZW50VHlwZUFwcGxpY2F0aW9uYCwgZmFsc2UpO1xuICB9XG4gIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3R3b0ZpbmdlclRhcGAsICdQT1NUJyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVRvdWNoQW5kSG9sZCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVRvdWNoQW5kSG9sZCAob3B0cyA9IHt9KSB7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZHVyYXRpb246IHJlcXVpcmVGbG9hdFBhcmFtZXRlcignZHVyYXRpb24nLCBvcHRzLmR1cmF0aW9uLCAndG91Y2hBbmRIb2xkJylcbiAgfTtcbiAgaWYgKG9wdHMuZWxlbWVudCkge1xuICAgIC8vIExvbmcgdGFwIGVsZW1lbnRcbiAgICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3RvdWNoQW5kSG9sZGAsICdQT1NUJywgcGFyYW1zKTtcbiAgfVxuICAvLyBMb25nIHRhcCBjb29yZGluYXRlc1xuICBwYXJhbXMueCA9IHJlcXVpcmVGbG9hdFBhcmFtZXRlcigneCcsIG9wdHMueCwgJ3RvdWNoQW5kSG9sZCcpO1xuICBwYXJhbXMueSA9IHJlcXVpcmVGbG9hdFBhcmFtZXRlcigneScsIG9wdHMueSwgJ3RvdWNoQW5kSG9sZCcpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvdG91Y2hBbmRIb2xkJywgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVUYXAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVUYXAgKG9wdHMgPSB7fSkge1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgeDogcmVxdWlyZUZsb2F0UGFyYW1ldGVyKCd4Jywgb3B0cy54LCAndGFwJyksXG4gICAgeTogcmVxdWlyZUZsb2F0UGFyYW1ldGVyKCd5Jywgb3B0cy55LCAndGFwJylcbiAgfTtcbiAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQgPyAodXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCkpIDogJzAnO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvdGFwLyR7ZWx9YCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVEcmFnRnJvbVRvRm9yRHVyYXRpb24gPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVEcmFnRnJvbVRvRm9yRHVyYXRpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgZHVyYXRpb246IHJlcXVpcmVGbG9hdFBhcmFtZXRlcignZHVyYXRpb24nLCBvcHRzLmR1cmF0aW9uLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgZnJvbVg6IHJlcXVpcmVGbG9hdFBhcmFtZXRlcignZnJvbVgnLCBvcHRzLmZyb21YLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgZnJvbVk6IHJlcXVpcmVGbG9hdFBhcmFtZXRlcignZnJvbVknLCBvcHRzLmZyb21ZLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgdG9YOiByZXF1aXJlRmxvYXRQYXJhbWV0ZXIoJ3RvWCcsIG9wdHMudG9YLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgdG9ZOiByZXF1aXJlRmxvYXRQYXJhbWV0ZXIoJ3RvWScsIG9wdHMudG9ZLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJylcbiAgfTtcbiAgaWYgKG9wdHMuZWxlbWVudCkge1xuICAgIC8vIERyYWcgZWxlbWVudFxuICAgIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vZHJhZ2Zyb210b2ZvcmR1cmF0aW9uYCwgJ1BPU1QnLCBwYXJhbXMpO1xuICB9XG4gIC8vIERyYWcgY29vcmRpbmF0ZXNcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2RyYWdmcm9tdG9mb3JkdXJhdGlvbicsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlVGFwV2l0aE51bWJlck9mVGFwcyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVRhcFdpdGhOdW1iZXJPZlRhcHMgKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdFbGVtZW50IGlkIGlzIGV4cGVjdGVkIHRvIGJlIHNldCBmb3IgdGFwV2l0aE51bWJlck9mVGFwcyBtZXRob2QnKTtcbiAgfVxuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgbnVtYmVyT2ZUYXBzOiByZXF1aXJlSW50UGFyYW1ldGVyKCdudW1iZXJPZlRhcHMnLCBvcHRzLm51bWJlck9mVGFwcywgJ3RhcFdpdGhOdW1iZXJPZlRhcHMnKSxcbiAgICBudW1iZXJPZlRvdWNoZXM6IHJlcXVpcmVJbnRQYXJhbWV0ZXIoJ251bWJlck9mVG91Y2hlcycsIG9wdHMubnVtYmVyT2ZUb3VjaGVzLCAndGFwV2l0aE51bWJlck9mVGFwcycpLFxuICB9O1xuICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS90YXBXaXRoTnVtYmVyT2ZUYXBzYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU2VsZWN0UGlja2VyV2hlZWxWYWx1ZSAob3B0cyA9IHt9KSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0VsZW1lbnQgaWQgaXMgZXhwZWN0ZWQgdG8gYmUgc2V0IGZvciBzZWxlY3RQaWNrZXJXaGVlbFZhbHVlIG1ldGhvZCcpO1xuICB9XG4gIGlmICghXy5pc1N0cmluZyhvcHRzLm9yZGVyKSB8fCAhWyduZXh0JywgJ3ByZXZpb3VzJ10uaW5jbHVkZXMob3B0cy5vcmRlci50b0xvd2VyQ2FzZSgpKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBUaGUgbWFuZGF0b3J5ICdvcmRlcicgcGFyYW1ldGVyIGlzIGV4cGVjdGVkIHRvIGJlIGVxdWFsIGVpdGhlciB0byAnbmV4dCcgb3IgJ3ByZXZpb3VzJy4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYCcke29wdHMub3JkZXJ9JyBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgY29uc3QgcGFyYW1zID0ge29yZGVyOiBvcHRzLm9yZGVyfTtcbiAgaWYgKG9wdHMub2Zmc2V0KSB7XG4gICAgcGFyYW1zLm9mZnNldCA9IHJlcXVpcmVGbG9hdFBhcmFtZXRlcignb2Zmc2V0Jywgb3B0cy5vZmZzZXQsICdzZWxlY3RQaWNrZXJXaGVlbFZhbHVlJyk7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL3BpY2tlcndoZWVsLyR7ZWx9L3NlbGVjdGAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlUm90YXRlRWxlbWVudCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVJvdGF0ZUVsZW1lbnQgKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdFbGVtZW50IGlkIGlzIGV4cGVjdGVkIHRvIGJlIHNldCBmb3Igcm90YXRlRWxlbWVudCBtZXRob2QnKTtcbiAgfVxuICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgcm90YXRpb246IHJlcXVpcmVGbG9hdFBhcmFtZXRlcigncm90YXRpb24nLCBvcHRzLnJvdGF0aW9uLCAncm90YXRlRWxlbWVudCcpLFxuICAgIHZlbG9jaXR5OiByZXF1aXJlRmxvYXRQYXJhbWV0ZXIoJ3ZlbG9jaXR5Jywgb3B0cy52ZWxvY2l0eSwgJ3JvdGF0ZUVsZW1lbnQnKSxcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vcm90YXRlYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5nZXRDb29yZGluYXRlcyA9IGFzeW5jIGZ1bmN0aW9uIGdldENvb3JkaW5hdGVzIChnZXN0dXJlKSB7XG4gIGxldCBlbCA9IGdlc3R1cmUub3B0aW9ucy5lbGVtZW50O1xuXG4gIC8vIGRlZmF1bHRzXG4gIGxldCBjb29yZGluYXRlcyA9IHt4OiAwLCB5OiAwLCBhcmVPZmZzZXRzOiBmYWxzZX07XG5cbiAgbGV0IG9wdGlvblggPSBudWxsO1xuICBpZiAoZ2VzdHVyZS5vcHRpb25zLngpIHtcbiAgICBvcHRpb25YID0gcmVxdWlyZUZsb2F0UGFyYW1ldGVyKCd4JywgZ2VzdHVyZS5vcHRpb25zLngsICdnZXRDb29yZGluYXRlcycpO1xuICB9XG4gIGxldCBvcHRpb25ZID0gbnVsbDtcbiAgaWYgKGdlc3R1cmUub3B0aW9ucy55KSB7XG4gICAgb3B0aW9uWSA9IHJlcXVpcmVGbG9hdFBhcmFtZXRlcigneScsIGdlc3R1cmUub3B0aW9ucy55LCAnZ2V0Q29vcmRpbmF0ZXMnKTtcbiAgfVxuXG4gIC8vIGZpZ3VyZSBvdXQgdGhlIGVsZW1lbnQgY29vcmRpbmF0ZXMuXG4gIGlmIChlbCkge1xuICAgIGxldCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gICAgbGV0IHBvcyA9IHt4OiByZWN0LngsIHk6IHJlY3QueX07XG4gICAgbGV0IHNpemUgPSB7dzogcmVjdC53aWR0aCwgaDogcmVjdC5oZWlnaHR9O1xuXG4gICAgLy8gZGVmYXVsdHNcbiAgICBsZXQgb2Zmc2V0WCA9IDA7XG4gICAgbGV0IG9mZnNldFkgPSAwO1xuXG4gICAgLy8gZ2V0IHRoZSByZWFsIG9mZnNldHNcbiAgICBpZiAob3B0aW9uWCB8fCBvcHRpb25ZKSB7XG4gICAgICBvZmZzZXRYID0gKG9wdGlvblggfHwgMCk7XG4gICAgICBvZmZzZXRZID0gKG9wdGlvblkgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9mZnNldFggPSAoc2l6ZS53IC8gMik7XG4gICAgICBvZmZzZXRZID0gKHNpemUuaCAvIDIpO1xuICAgIH1cblxuICAgIC8vIGFwcGx5IHRoZSBvZmZzZXRzXG4gICAgY29vcmRpbmF0ZXMueCA9IHBvcy54ICsgb2Zmc2V0WDtcbiAgICBjb29yZGluYXRlcy55ID0gcG9zLnkgKyBvZmZzZXRZO1xuICB9IGVsc2Uge1xuICAgIC8vIG1vdmVUbyBjb29yZGluYXRlcyBhcmUgcGFzc2VkIGluIGFzIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy5hcmVPZmZzZXRzID0gKGdlc3R1cmUuYWN0aW9uID09PSAnbW92ZVRvJyk7XG4gICAgY29vcmRpbmF0ZXMueCA9IChvcHRpb25YIHx8IDApO1xuICAgIGNvb3JkaW5hdGVzLnkgPSAob3B0aW9uWSB8fCAwKTtcbiAgfVxuICByZXR1cm4gY29vcmRpbmF0ZXM7XG59O1xuXG5oZWxwZXJzLmFwcGx5TW92ZVRvT2Zmc2V0ID0gZnVuY3Rpb24gYXBwbHlNb3ZlVG9PZmZzZXQgKGZpcnN0Q29vcmRpbmF0ZXMsIHNlY29uZENvb3JkaW5hdGVzKSB7XG4gIGlmIChzZWNvbmRDb29yZGluYXRlcy5hcmVPZmZzZXRzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IGZpcnN0Q29vcmRpbmF0ZXMueCArIHNlY29uZENvb3JkaW5hdGVzLngsXG4gICAgICB5OiBmaXJzdENvb3JkaW5hdGVzLnkgKyBzZWNvbmRDb29yZGluYXRlcy55LFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHNlY29uZENvb3JkaW5hdGVzO1xuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzKTtcbmV4cG9ydCB7IGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzLCBnZXN0dXJlc0NoYWluVG9TdHJpbmcgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
