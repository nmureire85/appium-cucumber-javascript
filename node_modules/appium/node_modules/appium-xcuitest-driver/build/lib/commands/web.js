"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _appiumIosDriver = require("appium-ios-driver");

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

const IPHONE_TOP_BAR_HEIGHT = 71;
const IPHONE_SCROLLED_TOP_BAR_HEIGHT = 41;
const IPHONE_X_SCROLLED_OFFSET = 55;
const IPHONE_X_NOTCH_OFFSET_IOS = 24;
const IPHONE_X_NOTCH_OFFSET_IOS_13 = 20;
const IPHONE_LANDSCAPE_TOP_BAR_HEIGHT = 51;
const IPHONE_BOTTOM_BAR_OFFSET = 49;
const TAB_BAR_OFFSET = 33;
const IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET = 84;
const IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET = 95;
const NOTCHED_DEVICE_SIZES = [{
  w: 1125,
  h: 2436
}, {
  w: 828,
  h: 1792
}, {
  w: 1242,
  h: 2688
}];
const ATOM_WAIT_TIMEOUT = 2 * 60000;
const ATOM_WAIT_ALERT_WAIT = 400;
let extensions = {};
Object.assign(extensions, _appiumIosDriver.iosCommands.web);
extensions.getSafariIsIphone = _lodash.default.memoize(async function getSafariIsIphone() {
  try {
    const userAgent = await this.execute('return navigator.userAgent');
    return userAgent.toLowerCase().includes('iphone');
  } catch (err) {
    _logger.default.warn(`Unable to find device type from useragent. Assuming iPhone`);

    _logger.default.debug(`Error: ${err.message}`);
  }

  return true;
});
extensions.getSafariDeviceSize = _lodash.default.memoize(async function getSafariDeviceSize() {
  const script = 'return {height: window.screen.availHeight * window.devicePixelRatio, width: window.screen.availWidth * window.devicePixelRatio};';
  const {
    width,
    height
  } = await this.execute(script);
  const [normHeight, normWidth] = height > width ? [height, width] : [width, height];
  return {
    width: normWidth,
    height: normHeight
  };
});
extensions.getSafariIsNotched = _lodash.default.memoize(async function getSafariIsNotched() {
  try {
    const {
      width,
      height
    } = await this.getSafariDeviceSize();

    for (const device of NOTCHED_DEVICE_SIZES) {
      if (device.w === width && device.h === height) {
        return true;
      }
    }
  } catch (err) {
    _logger.default.warn(`Unable to find device type from dimensions. Assuming the device is not notched`);

    _logger.default.debug(`Error: ${err.message}`);
  }

  return false;
});

extensions.getExtraTranslateWebCoordsOffset = async function getExtraTranslateWebCoordsOffset(wvPos, realDims) {
  let topOffset = 0;
  let bottomOffset = 0;
  const isIphone = await this.getSafariIsIphone();
  const isNotched = isIphone && (await this.getSafariIsNotched());
  const orientation = realDims.h > realDims.w ? 'PORTRAIT' : 'LANDSCAPE';
  const notchOffset = isNotched ? _appiumSupport.util.compareVersions(this.opts.platformVersion, '=', '13.0') ? IPHONE_X_NOTCH_OFFSET_IOS_13 : IPHONE_X_NOTCH_OFFSET_IOS : 0;
  const isScrolled = await this.execute('return document.documentElement.scrollTop > 0');

  if (isScrolled) {
    topOffset = IPHONE_SCROLLED_TOP_BAR_HEIGHT + notchOffset;

    if (isNotched) {
      topOffset -= IPHONE_X_SCROLLED_OFFSET;
    }

    if (orientation === 'LANDSCAPE' && isIphone) {
      topOffset = 0;
    }
  } else {
    topOffset = IPHONE_TOP_BAR_HEIGHT + notchOffset;

    if (isIphone) {
      if (orientation === 'PORTRAIT') {
        bottomOffset = IPHONE_BOTTOM_BAR_OFFSET;
      } else {
        topOffset = IPHONE_LANDSCAPE_TOP_BAR_HEIGHT;
      }
    }

    if (orientation === 'LANDSCAPE' || !isIphone) {
      const tabs = await this.findNativeElementOrElements('-ios predicate string', `name LIKE '*, Tab' AND visible = 1`, true);

      if (tabs.length > 0) {
        topOffset += TAB_BAR_OFFSET;
      }
    }
  }

  topOffset += await this.getExtraNativeWebTapOffset();
  wvPos.y += topOffset;
  realDims.h -= topOffset + bottomOffset;
};

extensions.getExtraNativeWebTapOffset = async function getExtraNativeWebTapOffset() {
  let offset = 0;
  const banners = await this.findNativeElementOrElements('accessibility id', 'Close app download offer', true);

  if (banners.length > 0) {
    offset += (await this.getSafariIsIphone()) ? IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET : IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET;
  }

  _logger.default.debug(`Additional native web tap offset computed: ${offset}`);

  return offset;
};

async function tapWebElementNatively(driver, atomsElement) {
  try {
    let text = await driver.executeAtom('get_text', [atomsElement]);

    if (!text) {
      text = await driver.executeAtom('get_attribute_value', [atomsElement, 'value']);
    }

    if (text) {
      const els = await driver.findNativeElementOrElements('accessibility id', text, true);

      if (els.length === 1 || els.length === 2) {
        const el = els[0];
        const rect = await driver.proxyCommand(`/element/${_appiumSupport.util.unwrapElement(el)}/rect`, 'GET');

        if (els.length === 2) {
          const el2 = els[1];
          const rect2 = await driver.proxyCommand(`/element/${_appiumSupport.util.unwrapElement(el2)}/rect`, 'GET');

          if (rect.x !== rect2.x || rect.y !== rect2.y || rect.width !== rect2.width || rect.height !== rect2.height) {
            return false;
          }
        }

        const coords = {
          x: Math.round(rect.x + rect.width / 2),
          y: Math.round(rect.y + rect.height / 2)
        };
        await driver.clickCoords(coords);
        return true;
      }
    }
  } catch (err) {
    _logger.default.warn(`Error attempting to click: ${err.message}`);
  }

  return false;
}

extensions.nativeWebTap = async function nativeWebTap(el) {
  const atomsElement = this.useAtomsElement(el);

  if (!(await this.settings.getSettings()).nativeWebTapStrict && (await tapWebElementNatively(this, atomsElement))) {
    return;
  }

  _logger.default.warn('Unable to do simple native web tap. Attempting to convert coordinates');

  await this.executeAtom('get_size', [atomsElement]);
  await this.executeAtom('get_top_left_coordinates', [atomsElement]);
  const {
    width,
    height
  } = await this.executeAtom('get_size', [atomsElement]);
  let {
    x,
    y
  } = await this.executeAtom('get_top_left_coordinates', [atomsElement]);
  x += width / 2;
  y += height / 2;
  this.curWebCoords = {
    x,
    y
  };
  await this.clickWebCoords();
};

extensions.clickCoords = async function clickCoords(coords) {
  await this.performTouch([{
    action: 'tap',
    options: coords
  }]);
};

extensions.translateWebCoords = async function translateWebCoords(coords) {
  _logger.default.debug(`Translating coordinates (${JSON.stringify(coords)}) to web coordinates`);

  let webview = await (0, _asyncbox.retryInterval)(5, 100, async () => {
    const webviews = await this.findNativeElementOrElements('class name', 'XCUIElementTypeWebView', true);

    if (webviews.length === 0) {
      throw new Error(`No webviews found. Unable to translate web coordinates for native web tap`);
    }

    return webviews[0];
  });
  webview = _appiumSupport.util.unwrapElement(webview);
  const rect = await this.proxyCommand(`/element/${webview}/rect`, 'GET');
  const wvPos = {
    x: rect.x,
    y: rect.y
  };
  const realDims = {
    w: rect.width,
    h: rect.height
  };
  const cmd = '(function () { return {w: window.innerWidth, h: window.innerHeight}; })()';
  const wvDims = await this.remote.execute(cmd);
  await this.getExtraTranslateWebCoordsOffset(wvPos, realDims);

  if (wvDims && realDims && wvPos) {
    let xRatio = realDims.w / wvDims.w;
    let yRatio = realDims.h / wvDims.h;
    let newCoords = {
      x: wvPos.x + Math.round(xRatio * coords.x),
      y: wvPos.y + Math.round(yRatio * coords.y)
    };

    _logger.default.debug(`Converted coordinates: ${JSON.stringify(newCoords)}`);

    _logger.default.debug(`    rect: ${JSON.stringify(rect)}`);

    _logger.default.debug(`    wvPos: ${JSON.stringify(wvPos)}`);

    _logger.default.debug(`    realDims: ${JSON.stringify(realDims)}`);

    _logger.default.debug(`    wvDims: ${JSON.stringify(wvDims)}`);

    _logger.default.debug(`    xRatio: ${JSON.stringify(xRatio)}`);

    _logger.default.debug(`    yRatio: ${JSON.stringify(yRatio)}`);

    _logger.default.debug(`Converted web coords ${JSON.stringify(coords)} ` + `into real coords ${JSON.stringify(newCoords)}`);

    return newCoords;
  }
};

extensions.checkForAlert = async function checkForAlert() {
  return _lodash.default.isString(await this.getAlertText());
};

extensions.waitForAtom = async function waitForAtom(promise) {
  const timer = new _appiumSupport.timing.Timer().start();
  let done = false;
  let error = null;
  promise = _bluebird.default.resolve(promise).timeout(ATOM_WAIT_TIMEOUT).catch(function (err) {
    _logger.default.debug(`Error received while executing atom: ${err.message}`);

    if (err instanceof _bluebird.default.TimeoutError) {
      err = new Error(`Did not get any response for atom execution after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    }

    error = err;
  }).finally(function () {
    done = true;
  });

  for (let i = 0; i < 10; i++) {
    try {
      await (0, _asyncbox.waitForCondition)(() => done, {
        waitMs: ATOM_WAIT_ALERT_WAIT,
        intervalMs: 0
      });
      break;
    } catch (ign) {}

    try {
      const res = await _bluebird.default.any([this.checkForAlert(), promise]);

      if (error) {
        throw error;
      }

      return this.parseExecuteResponse(res);
    } catch (err) {
      _logger.default.debug(`No alert found: ${err.message}`);
    }
  }

  const res = await promise;

  if (error) {
    throw error;
  }

  return this.parseExecuteResponse(res);
};

extensions.mobileWebNav = async function mobileWebNav(navType) {
  this.remote.allowNavigationWithoutReload = true;

  try {
    await this.executeAtom('execute_script', [`history.${navType}();`, null]);
  } finally {
    this.remote.allowNavigationWithoutReload = false;
  }
};

var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy93ZWIuanMiXSwibmFtZXMiOlsiSVBIT05FX1RPUF9CQVJfSEVJR0hUIiwiSVBIT05FX1NDUk9MTEVEX1RPUF9CQVJfSEVJR0hUIiwiSVBIT05FX1hfU0NST0xMRURfT0ZGU0VUIiwiSVBIT05FX1hfTk9UQ0hfT0ZGU0VUX0lPUyIsIklQSE9ORV9YX05PVENIX09GRlNFVF9JT1NfMTMiLCJJUEhPTkVfTEFORFNDQVBFX1RPUF9CQVJfSEVJR0hUIiwiSVBIT05FX0JPVFRPTV9CQVJfT0ZGU0VUIiwiVEFCX0JBUl9PRkZTRVQiLCJJUEhPTkVfV0VCX0NPT1JEX1NNQVJUX0FQUF9CQU5ORVJfT0ZGU0VUIiwiSVBBRF9XRUJfQ09PUkRfU01BUlRfQVBQX0JBTk5FUl9PRkZTRVQiLCJOT1RDSEVEX0RFVklDRV9TSVpFUyIsInciLCJoIiwiQVRPTV9XQUlUX1RJTUVPVVQiLCJBVE9NX1dBSVRfQUxFUlRfV0FJVCIsImV4dGVuc2lvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJpb3NDb21tYW5kcyIsIndlYiIsImdldFNhZmFyaUlzSXBob25lIiwiXyIsIm1lbW9pemUiLCJ1c2VyQWdlbnQiLCJleGVjdXRlIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImVyciIsImxvZyIsIndhcm4iLCJkZWJ1ZyIsIm1lc3NhZ2UiLCJnZXRTYWZhcmlEZXZpY2VTaXplIiwic2NyaXB0Iiwid2lkdGgiLCJoZWlnaHQiLCJub3JtSGVpZ2h0Iiwibm9ybVdpZHRoIiwiZ2V0U2FmYXJpSXNOb3RjaGVkIiwiZGV2aWNlIiwiZ2V0RXh0cmFUcmFuc2xhdGVXZWJDb29yZHNPZmZzZXQiLCJ3dlBvcyIsInJlYWxEaW1zIiwidG9wT2Zmc2V0IiwiYm90dG9tT2Zmc2V0IiwiaXNJcGhvbmUiLCJpc05vdGNoZWQiLCJvcmllbnRhdGlvbiIsIm5vdGNoT2Zmc2V0IiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsIm9wdHMiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc1Njcm9sbGVkIiwidGFicyIsImZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyIsImxlbmd0aCIsImdldEV4dHJhTmF0aXZlV2ViVGFwT2Zmc2V0IiwieSIsIm9mZnNldCIsImJhbm5lcnMiLCJ0YXBXZWJFbGVtZW50TmF0aXZlbHkiLCJkcml2ZXIiLCJhdG9tc0VsZW1lbnQiLCJ0ZXh0IiwiZXhlY3V0ZUF0b20iLCJlbHMiLCJlbCIsInJlY3QiLCJwcm94eUNvbW1hbmQiLCJ1bndyYXBFbGVtZW50IiwiZWwyIiwicmVjdDIiLCJ4IiwiY29vcmRzIiwiTWF0aCIsInJvdW5kIiwiY2xpY2tDb29yZHMiLCJuYXRpdmVXZWJUYXAiLCJ1c2VBdG9tc0VsZW1lbnQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibmF0aXZlV2ViVGFwU3RyaWN0IiwiY3VyV2ViQ29vcmRzIiwiY2xpY2tXZWJDb29yZHMiLCJwZXJmb3JtVG91Y2giLCJhY3Rpb24iLCJvcHRpb25zIiwidHJhbnNsYXRlV2ViQ29vcmRzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndlYnZpZXciLCJ3ZWJ2aWV3cyIsIkVycm9yIiwiY21kIiwid3ZEaW1zIiwicmVtb3RlIiwieFJhdGlvIiwieVJhdGlvIiwibmV3Q29vcmRzIiwiY2hlY2tGb3JBbGVydCIsImlzU3RyaW5nIiwiZ2V0QWxlcnRUZXh0Iiwid2FpdEZvckF0b20iLCJwcm9taXNlIiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0IiwiZG9uZSIsImVycm9yIiwiQiIsInJlc29sdmUiLCJ0aW1lb3V0IiwiY2F0Y2giLCJUaW1lb3V0RXJyb3IiLCJnZXREdXJhdGlvbiIsImFzTWlsbGlTZWNvbmRzIiwidG9GaXhlZCIsImZpbmFsbHkiLCJpIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImlnbiIsInJlcyIsImFueSIsInBhcnNlRXhlY3V0ZVJlc3BvbnNlIiwibW9iaWxlV2ViTmF2IiwibmF2VHlwZSIsImFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7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LENBQUMsS0FBS3pCLGFBQUwsRUFBRCxFQUF1QkksT0FBdkIsQ0FBTixDQUFsQjs7QUFDQSxVQUFJTSxLQUFKLEVBQVc7QUFDVCxjQUFNQSxLQUFOO0FBQ0Q7O0FBQ0QsYUFBTyxLQUFLZ0Isb0JBQUwsQ0FBMEJGLEdBQTFCLENBQVA7QUFDRCxLQU5ELENBTUUsT0FBT2pHLEdBQVAsRUFBWTtBQUVaQyxzQkFBSUUsS0FBSixDQUFXLG1CQUFrQkgsR0FBRyxDQUFDSSxPQUFRLEVBQXpDO0FBQ0Q7QUFDRjs7QUFJRCxRQUFNNkYsR0FBRyxHQUFHLE1BQU1wQixPQUFsQjs7QUFDQSxNQUFJTSxLQUFKLEVBQVc7QUFDVCxVQUFNQSxLQUFOO0FBQ0Q7O0FBQ0QsU0FBTyxLQUFLZ0Isb0JBQUwsQ0FBMEJGLEdBQTFCLENBQVA7QUFDRCxDQXZERDs7QUF5REE3RyxVQUFVLENBQUNnSCxZQUFYLEdBQTBCLGVBQWVBLFlBQWYsQ0FBNkJDLE9BQTdCLEVBQXNDO0FBQzlELE9BQUtoQyxNQUFMLENBQVlpQyw0QkFBWixHQUEyQyxJQUEzQzs7QUFDQSxNQUFJO0FBQ0YsVUFBTSxLQUFLaEUsV0FBTCxDQUFpQixnQkFBakIsRUFBbUMsQ0FBRSxXQUFVK0QsT0FBUSxLQUFwQixFQUEwQixJQUExQixDQUFuQyxDQUFOO0FBQ0QsR0FGRCxTQUVVO0FBQ1IsU0FBS2hDLE1BQUwsQ0FBWWlDLDRCQUFaLEdBQTJDLEtBQTNDO0FBQ0Q7QUFDRixDQVBEOztlQVVlbEgsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlvc0NvbW1hbmRzIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IHsgcmV0cnlJbnRlcnZhbCwgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5cbmNvbnN0IElQSE9ORV9UT1BfQkFSX0hFSUdIVCA9IDcxO1xuY29uc3QgSVBIT05FX1NDUk9MTEVEX1RPUF9CQVJfSEVJR0hUID0gNDE7XG5jb25zdCBJUEhPTkVfWF9TQ1JPTExFRF9PRkZTRVQgPSA1NTtcbmNvbnN0IElQSE9ORV9YX05PVENIX09GRlNFVF9JT1MgPSAyNDtcbmNvbnN0IElQSE9ORV9YX05PVENIX09GRlNFVF9JT1NfMTMgPSAyMDtcblxuY29uc3QgSVBIT05FX0xBTkRTQ0FQRV9UT1BfQkFSX0hFSUdIVCA9IDUxO1xuY29uc3QgSVBIT05FX0JPVFRPTV9CQVJfT0ZGU0VUID0gNDk7XG5jb25zdCBUQUJfQkFSX09GRlNFVCA9IDMzO1xuY29uc3QgSVBIT05FX1dFQl9DT09SRF9TTUFSVF9BUFBfQkFOTkVSX09GRlNFVCA9IDg0O1xuY29uc3QgSVBBRF9XRUJfQ09PUkRfU01BUlRfQVBQX0JBTk5FUl9PRkZTRVQgPSA5NTtcblxuY29uc3QgTk9UQ0hFRF9ERVZJQ0VfU0laRVMgPSBbXG4gIHt3OiAxMTI1LCBoOiAyNDM2fSwgLy8gMTEgUHJvLCBYLCBYc1xuICB7dzogODI4LCBoOiAxNzkyfSwgLy8gMTEsIFhyXG4gIHt3OiAxMjQyLCBoOiAyNjg4fSwgLy8gMTEgUHJvIE1heCwgWHMgTWF4XG5dO1xuXG5jb25zdCBBVE9NX1dBSVRfVElNRU9VVCA9IDIgKiA2MDAwMDtcbmNvbnN0IEFUT01fV0FJVF9BTEVSVF9XQUlUID0gNDAwO1xuXG5sZXQgZXh0ZW5zaW9ucyA9IHt9O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGlvc0NvbW1hbmRzLndlYik7XG5cblxuXG5leHRlbnNpb25zLmdldFNhZmFyaUlzSXBob25lID0gXy5tZW1vaXplKGFzeW5jIGZ1bmN0aW9uIGdldFNhZmFyaUlzSXBob25lICgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VyQWdlbnQgPSBhd2FpdCB0aGlzLmV4ZWN1dGUoJ3JldHVybiBuYXZpZ2F0b3IudXNlckFnZW50Jyk7XG4gICAgcmV0dXJuIHVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdpcGhvbmUnKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYFVuYWJsZSB0byBmaW5kIGRldmljZSB0eXBlIGZyb20gdXNlcmFnZW50LiBBc3N1bWluZyBpUGhvbmVgKTtcbiAgICBsb2cuZGVidWcoYEVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG4gIHJldHVybiB0cnVlO1xufSk7XG5cbmV4dGVuc2lvbnMuZ2V0U2FmYXJpRGV2aWNlU2l6ZSA9IF8ubWVtb2l6ZShhc3luYyBmdW5jdGlvbiBnZXRTYWZhcmlEZXZpY2VTaXplICgpIHtcbiAgY29uc3Qgc2NyaXB0ID0gJ3JldHVybiB7aGVpZ2h0OiB3aW5kb3cuc2NyZWVuLmF2YWlsSGVpZ2h0ICogd2luZG93LmRldmljZVBpeGVsUmF0aW8sIHdpZHRoOiB3aW5kb3cuc2NyZWVuLmF2YWlsV2lkdGggKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb307JztcbiAgY29uc3Qge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5leGVjdXRlKHNjcmlwdCk7XG4gIGNvbnN0IFtub3JtSGVpZ2h0LCBub3JtV2lkdGhdID0gaGVpZ2h0ID4gd2lkdGggPyBbaGVpZ2h0LCB3aWR0aF0gOiBbd2lkdGgsIGhlaWdodF07XG4gIHJldHVybiB7XG4gICAgd2lkdGg6IG5vcm1XaWR0aCxcbiAgICBoZWlnaHQ6IG5vcm1IZWlnaHQsXG4gIH07XG59KTtcblxuZXh0ZW5zaW9ucy5nZXRTYWZhcmlJc05vdGNoZWQgPSBfLm1lbW9pemUoYXN5bmMgZnVuY3Rpb24gZ2V0U2FmYXJpSXNOb3RjaGVkICgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmdldFNhZmFyaURldmljZVNpemUoKTtcbiAgICBmb3IgKGNvbnN0IGRldmljZSBvZiBOT1RDSEVEX0RFVklDRV9TSVpFUykge1xuICAgICAgaWYgKGRldmljZS53ID09PSB3aWR0aCAmJiBkZXZpY2UuaCA9PT0gaGVpZ2h0KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYFVuYWJsZSB0byBmaW5kIGRldmljZSB0eXBlIGZyb20gZGltZW5zaW9ucy4gQXNzdW1pbmcgdGhlIGRldmljZSBpcyBub3Qgbm90Y2hlZGApO1xuICAgIGxvZy5kZWJ1ZyhgRXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufSk7XG5cbmV4dGVuc2lvbnMuZ2V0RXh0cmFUcmFuc2xhdGVXZWJDb29yZHNPZmZzZXQgPSBhc3luYyBmdW5jdGlvbiBnZXRFeHRyYVRyYW5zbGF0ZVdlYkNvb3Jkc09mZnNldCAod3ZQb3MsIHJlYWxEaW1zKSB7XG4gIGxldCB0b3BPZmZzZXQgPSAwO1xuICBsZXQgYm90dG9tT2Zmc2V0ID0gMDtcblxuICBjb25zdCBpc0lwaG9uZSA9IGF3YWl0IHRoaXMuZ2V0U2FmYXJpSXNJcGhvbmUoKTtcbiAgY29uc3QgaXNOb3RjaGVkID0gaXNJcGhvbmUgJiYgYXdhaXQgdGhpcy5nZXRTYWZhcmlJc05vdGNoZWQoKTtcblxuICBjb25zdCBvcmllbnRhdGlvbiA9IHJlYWxEaW1zLmggPiByZWFsRGltcy53ID8gJ1BPUlRSQUlUJyA6ICdMQU5EU0NBUEUnO1xuXG4gIGNvbnN0IG5vdGNoT2Zmc2V0ID0gaXNOb3RjaGVkXG4gICAgPyB1dGlsLmNvbXBhcmVWZXJzaW9ucyh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLCAnPScsICcxMy4wJylcbiAgICAgID8gSVBIT05FX1hfTk9UQ0hfT0ZGU0VUX0lPU18xM1xuICAgICAgOiBJUEhPTkVfWF9OT1RDSF9PRkZTRVRfSU9TXG4gICAgOiAwO1xuXG4gIGNvbnN0IGlzU2Nyb2xsZWQgPSBhd2FpdCB0aGlzLmV4ZWN1dGUoJ3JldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID4gMCcpO1xuICBpZiAoaXNTY3JvbGxlZCkge1xuICAgIHRvcE9mZnNldCA9IElQSE9ORV9TQ1JPTExFRF9UT1BfQkFSX0hFSUdIVCArIG5vdGNoT2Zmc2V0O1xuXG4gICAgaWYgKGlzTm90Y2hlZCkge1xuICAgICAgdG9wT2Zmc2V0IC09IElQSE9ORV9YX1NDUk9MTEVEX09GRlNFVDtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGUgaVBob25lIGlzIGxhbmRzY2FwZSB0aGVuIHRoZXJlIGlzIG5vIHRvcCBiYXJcbiAgICBpZiAob3JpZW50YXRpb24gPT09ICdMQU5EU0NBUEUnICYmIGlzSXBob25lKSB7XG4gICAgICB0b3BPZmZzZXQgPSAwO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0b3BPZmZzZXQgPSBJUEhPTkVfVE9QX0JBUl9IRUlHSFQgKyBub3RjaE9mZnNldDtcblxuICAgIGlmIChpc0lwaG9uZSkge1xuICAgICAgaWYgKG9yaWVudGF0aW9uID09PSAnUE9SVFJBSVQnKSB7XG4gICAgICAgIC8vIFRoZSBib3R0b20gYmFyIGlzIG9ubHkgdmlzaWJsZSB3aGVuIHBvcnRyYWl0XG4gICAgICAgIGJvdHRvbU9mZnNldCA9IElQSE9ORV9CT1RUT01fQkFSX09GRlNFVDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvcE9mZnNldCA9IElQSE9ORV9MQU5EU0NBUEVfVE9QX0JBUl9IRUlHSFQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSAnTEFORFNDQVBFJyB8fCAhaXNJcGhvbmUpIHtcbiAgICAgIC8vIFRhYnMgb25seSBhcHBlYXIgaWYgdGhlIGRldmljZSBpcyBsYW5kc2NhcGUgb3IgaWYgaXQncyBhbiBpUGFkIHNvIHdlIG9ubHkgY2hlY2sgdmlzaWJpbGl0eSBpbiB0aGlzIGNhc2VcbiAgICAgIGNvbnN0IHRhYnMgPSBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cygnLWlvcyBwcmVkaWNhdGUgc3RyaW5nJywgYG5hbWUgTElLRSAnKiwgVGFiJyBBTkQgdmlzaWJsZSA9IDFgLCB0cnVlKTtcbiAgICAgIGlmICh0YWJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdG9wT2Zmc2V0ICs9IFRBQl9CQVJfT0ZGU0VUO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRvcE9mZnNldCArPSBhd2FpdCB0aGlzLmdldEV4dHJhTmF0aXZlV2ViVGFwT2Zmc2V0KCk7XG5cbiAgd3ZQb3MueSArPSB0b3BPZmZzZXQ7XG4gIHJlYWxEaW1zLmggLT0gKHRvcE9mZnNldCArIGJvdHRvbU9mZnNldCk7XG59O1xuXG5leHRlbnNpb25zLmdldEV4dHJhTmF0aXZlV2ViVGFwT2Zmc2V0ID0gYXN5bmMgZnVuY3Rpb24gZ2V0RXh0cmFOYXRpdmVXZWJUYXBPZmZzZXQgKCkge1xuICBsZXQgb2Zmc2V0ID0gMDtcblxuICAvLyB0cnkgdG8gc2VlIGlmIHRoZXJlIGlzIGFuIFNtYXJ0IEFwcCBCYW5uZXJcbiAgY29uc3QgYmFubmVycyA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdhY2Nlc3NpYmlsaXR5IGlkJywgJ0Nsb3NlIGFwcCBkb3dubG9hZCBvZmZlcicsIHRydWUpO1xuICBpZiAoYmFubmVycy5sZW5ndGggPiAwKSB7XG4gICAgb2Zmc2V0ICs9IGF3YWl0IHRoaXMuZ2V0U2FmYXJpSXNJcGhvbmUoKSA/XG4gICAgICBJUEhPTkVfV0VCX0NPT1JEX1NNQVJUX0FQUF9CQU5ORVJfT0ZGU0VUIDpcbiAgICAgIElQQURfV0VCX0NPT1JEX1NNQVJUX0FQUF9CQU5ORVJfT0ZGU0VUO1xuICB9XG5cbiAgbG9nLmRlYnVnKGBBZGRpdGlvbmFsIG5hdGl2ZSB3ZWIgdGFwIG9mZnNldCBjb21wdXRlZDogJHtvZmZzZXR9YCk7XG4gIHJldHVybiBvZmZzZXQ7XG59O1xuXG5hc3luYyBmdW5jdGlvbiB0YXBXZWJFbGVtZW50TmF0aXZlbHkgKGRyaXZlciwgYXRvbXNFbGVtZW50KSB7XG4gIC8vIHRyeSB0byBnZXQgdGhlIHRleHQgb2YgdGhlIGVsZW1lbnQsIHdoaWNoIHdpbGwgYmUgYWNjZXNzaWJsZSBpbiB0aGVcbiAgLy8gbmF0aXZlIGNvbnRleHRcbiAgdHJ5IHtcbiAgICBsZXQgdGV4dCA9IGF3YWl0IGRyaXZlci5leGVjdXRlQXRvbSgnZ2V0X3RleHQnLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgaWYgKCF0ZXh0KSB7XG4gICAgICB0ZXh0ID0gYXdhaXQgZHJpdmVyLmV4ZWN1dGVBdG9tKCdnZXRfYXR0cmlidXRlX3ZhbHVlJywgW2F0b21zRWxlbWVudCwgJ3ZhbHVlJ10pO1xuICAgIH1cblxuICAgIGlmICh0ZXh0KSB7XG4gICAgICBjb25zdCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdhY2Nlc3NpYmlsaXR5IGlkJywgdGV4dCwgdHJ1ZSk7XG4gICAgICBpZiAoZWxzLmxlbmd0aCA9PT0gMSB8fCBlbHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIGNvbnN0IGVsID0gZWxzWzBdO1xuICAgICAgICAvLyB1c2UgdGFwIGJlY2F1c2Ugb24gaU9TIDExLjIgYW5kIGJlbG93IGBuYXRpdmVDbGlja2AgY3Jhc2hlcyBXREFcbiAgICAgICAgY29uc3QgcmVjdCA9IGF3YWl0IGRyaXZlci5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7dXRpbC51bndyYXBFbGVtZW50KGVsKX0vcmVjdGAsICdHRVQnKTtcbiAgICAgICAgaWYgKGVscy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICBjb25zdCBlbDIgPSBlbHNbMV07XG4gICAgICAgICAgY29uc3QgcmVjdDIgPSBhd2FpdCBkcml2ZXIucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke3V0aWwudW53cmFwRWxlbWVudChlbDIpfS9yZWN0YCwgJ0dFVCcpO1xuXG4gICAgICAgICAgaWYgKChyZWN0LnggIT09IHJlY3QyLnggfHwgcmVjdC55ICE9PSByZWN0Mi55KSB8fFxuICAgICAgICAgIChyZWN0LndpZHRoICE9PSByZWN0Mi53aWR0aCB8fCByZWN0LmhlaWdodCAhPT0gcmVjdDIuaGVpZ2h0KSkge1xuICAgICAgICAgICAgLy8gVGhlc2UgMiBuYXRpdmUgZWxlbWVudHMgYXJlIG5vdCByZWZlcnJpbmcgdG8gdGhlIHNhbWUgd2ViIGVsZW1lbnRcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29vcmRzID0ge1xuICAgICAgICAgIHg6IE1hdGgucm91bmQocmVjdC54ICsgcmVjdC53aWR0aCAvIDIpLFxuICAgICAgICAgIHk6IE1hdGgucm91bmQocmVjdC55ICsgcmVjdC5oZWlnaHQgLyAyKSxcbiAgICAgICAgfTtcbiAgICAgICAgYXdhaXQgZHJpdmVyLmNsaWNrQ29vcmRzKGNvb3Jkcyk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgLy8gYW55IGZhaWx1cmUgc2hvdWxkIGZhbGwgdGhyb3VnaCBhbmQgdHJpZ2dlciB0aGUgbW9yZSBlbGFib3JhdGVcbiAgICAvLyBtZXRob2Qgb2YgY2xpY2tpbmdcbiAgICBsb2cud2FybihgRXJyb3IgYXR0ZW1wdGluZyB0byBjbGljazogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4dGVuc2lvbnMubmF0aXZlV2ViVGFwID0gYXN5bmMgZnVuY3Rpb24gbmF0aXZlV2ViVGFwIChlbCkge1xuICBjb25zdCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG5cbiAgLy8gaWYgc3RyaWN0IG5hdGl2ZSB0YXAsIGRvIG5vdCB0cnkgdG8gZG8gaXQgd2l0aCBXREEgZGlyZWN0bHlcbiAgaWYgKCEoYXdhaXQgdGhpcy5zZXR0aW5ncy5nZXRTZXR0aW5ncygpKS5uYXRpdmVXZWJUYXBTdHJpY3QgJiYgYXdhaXQgdGFwV2ViRWxlbWVudE5hdGl2ZWx5KHRoaXMsIGF0b21zRWxlbWVudCkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgbG9nLndhcm4oJ1VuYWJsZSB0byBkbyBzaW1wbGUgbmF0aXZlIHdlYiB0YXAuIEF0dGVtcHRpbmcgdG8gY29udmVydCBjb29yZGluYXRlcycpO1xuXG4gIC8vIGBnZXRfdG9wX2xlZnRfY29vcmRpbmF0ZXNgIHJldHVybnMgdGhlIHdyb25nIHZhbHVlIHNvbWV0aW1lcyxcbiAgLy8gdW5sZXNzIHdlIHByZS1jYWxsIGJvdGggb2YgdGhlc2UgZnVuY3Rpb25zIGJlZm9yZSB0aGUgYWN0dWFsIGNhbGxzXG4gIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9zaXplJywgW2F0b21zRWxlbWVudF0pO1xuICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdG9wX2xlZnRfY29vcmRpbmF0ZXMnLCBbYXRvbXNFbGVtZW50XSk7XG5cbiAgY29uc3Qge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3NpemUnLCBbYXRvbXNFbGVtZW50XSk7XG4gIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdG9wX2xlZnRfY29vcmRpbmF0ZXMnLCBbYXRvbXNFbGVtZW50XSk7XG4gIHggKz0gd2lkdGggLyAyO1xuICB5ICs9IGhlaWdodCAvIDI7XG5cbiAgdGhpcy5jdXJXZWJDb29yZHMgPSB7eCwgeX07XG4gIGF3YWl0IHRoaXMuY2xpY2tXZWJDb29yZHMoKTtcbn07XG5cbmV4dGVuc2lvbnMuY2xpY2tDb29yZHMgPSBhc3luYyBmdW5jdGlvbiBjbGlja0Nvb3JkcyAoY29vcmRzKSB7XG4gIGF3YWl0IHRoaXMucGVyZm9ybVRvdWNoKFtcbiAgICB7XG4gICAgICBhY3Rpb246ICd0YXAnLFxuICAgICAgb3B0aW9uczogY29vcmRzLFxuICAgIH0sXG4gIF0pO1xufTtcblxuZXh0ZW5zaW9ucy50cmFuc2xhdGVXZWJDb29yZHMgPSBhc3luYyBmdW5jdGlvbiB0cmFuc2xhdGVXZWJDb29yZHMgKGNvb3Jkcykge1xuICBsb2cuZGVidWcoYFRyYW5zbGF0aW5nIGNvb3JkaW5hdGVzICgke0pTT04uc3RyaW5naWZ5KGNvb3Jkcyl9KSB0byB3ZWIgY29vcmRpbmF0ZXNgKTtcblxuICAvLyBhYnNvbHV0aXplIHdlYiBjb29yZHNcbiAgbGV0IHdlYnZpZXcgPSBhd2FpdCByZXRyeUludGVydmFsKDUsIDEwMCwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHdlYnZpZXdzID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoJ2NsYXNzIG5hbWUnLCAnWENVSUVsZW1lbnRUeXBlV2ViVmlldycsIHRydWUpO1xuICAgIGlmICh3ZWJ2aWV3cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gd2Vidmlld3MgZm91bmQuIFVuYWJsZSB0byB0cmFuc2xhdGUgd2ViIGNvb3JkaW5hdGVzIGZvciBuYXRpdmUgd2ViIHRhcGApO1xuICAgIH1cbiAgICByZXR1cm4gd2Vidmlld3NbMF07XG4gIH0pO1xuICB3ZWJ2aWV3ID0gdXRpbC51bndyYXBFbGVtZW50KHdlYnZpZXcpO1xuXG4gIGNvbnN0IHJlY3QgPSBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHt3ZWJ2aWV3fS9yZWN0YCwgJ0dFVCcpO1xuICBjb25zdCB3dlBvcyA9IHt4OiByZWN0LngsIHk6IHJlY3QueX07XG4gIGNvbnN0IHJlYWxEaW1zID0ge3c6IHJlY3Qud2lkdGgsIGg6IHJlY3QuaGVpZ2h0fTtcblxuICBjb25zdCBjbWQgPSAnKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHt3OiB3aW5kb3cuaW5uZXJXaWR0aCwgaDogd2luZG93LmlubmVySGVpZ2h0fTsgfSkoKSc7XG4gIGNvbnN0IHd2RGltcyA9IGF3YWl0IHRoaXMucmVtb3RlLmV4ZWN1dGUoY21kKTtcblxuICBhd2FpdCB0aGlzLmdldEV4dHJhVHJhbnNsYXRlV2ViQ29vcmRzT2Zmc2V0KHd2UG9zLCByZWFsRGltcyk7XG5cbiAgaWYgKHd2RGltcyAmJiByZWFsRGltcyAmJiB3dlBvcykge1xuICAgIGxldCB4UmF0aW8gPSByZWFsRGltcy53IC8gd3ZEaW1zLnc7XG4gICAgbGV0IHlSYXRpbyA9IHJlYWxEaW1zLmggLyB3dkRpbXMuaDtcbiAgICBsZXQgbmV3Q29vcmRzID0ge1xuICAgICAgeDogd3ZQb3MueCArIE1hdGgucm91bmQoeFJhdGlvICogY29vcmRzLngpLFxuICAgICAgeTogd3ZQb3MueSArIE1hdGgucm91bmQoeVJhdGlvICogY29vcmRzLnkpLFxuICAgIH07XG5cbiAgICAvLyBhZGRpdGlvbmFsIGxvZ2dpbmcgZm9yIGNvb3JkaW5hdGVzLCBzaW5jZSBpdCBpcyBzb21ldGltZXMgYnJva2VuXG4gICAgLy8gICBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzkxNTlcbiAgICBsb2cuZGVidWcoYENvbnZlcnRlZCBjb29yZGluYXRlczogJHtKU09OLnN0cmluZ2lmeShuZXdDb29yZHMpfWApO1xuICAgIGxvZy5kZWJ1ZyhgICAgIHJlY3Q6ICR7SlNPTi5zdHJpbmdpZnkocmVjdCl9YCk7XG4gICAgbG9nLmRlYnVnKGAgICAgd3ZQb3M6ICR7SlNPTi5zdHJpbmdpZnkod3ZQb3MpfWApO1xuICAgIGxvZy5kZWJ1ZyhgICAgIHJlYWxEaW1zOiAke0pTT04uc3RyaW5naWZ5KHJlYWxEaW1zKX1gKTtcbiAgICBsb2cuZGVidWcoYCAgICB3dkRpbXM6ICR7SlNPTi5zdHJpbmdpZnkod3ZEaW1zKX1gKTtcbiAgICBsb2cuZGVidWcoYCAgICB4UmF0aW86ICR7SlNPTi5zdHJpbmdpZnkoeFJhdGlvKX1gKTtcbiAgICBsb2cuZGVidWcoYCAgICB5UmF0aW86ICR7SlNPTi5zdHJpbmdpZnkoeVJhdGlvKX1gKTtcblxuICAgIGxvZy5kZWJ1ZyhgQ29udmVydGVkIHdlYiBjb29yZHMgJHtKU09OLnN0cmluZ2lmeShjb29yZHMpfSBgICtcbiAgICAgICAgICAgICAgYGludG8gcmVhbCBjb29yZHMgJHtKU09OLnN0cmluZ2lmeShuZXdDb29yZHMpfWApO1xuICAgIHJldHVybiBuZXdDb29yZHM7XG4gIH1cbn07XG5cbmV4dGVuc2lvbnMuY2hlY2tGb3JBbGVydCA9IGFzeW5jIGZ1bmN0aW9uIGNoZWNrRm9yQWxlcnQgKCkge1xuICByZXR1cm4gXy5pc1N0cmluZyhhd2FpdCB0aGlzLmdldEFsZXJ0VGV4dCgpKTtcbn07XG5cbmV4dGVuc2lvbnMud2FpdEZvckF0b20gPSBhc3luYyBmdW5jdGlvbiB3YWl0Rm9yQXRvbSAocHJvbWlzZSkge1xuICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuXG4gIC8vIG5lZWQgdG8gY2hlY2sgZm9yIGFsZXJ0IHdoaWxlIHRoZSBhdG9tIGlzIGJlaW5nIGV4ZWN1dGVkLlxuICAvLyBzbyBub3RpZnkgb3Vyc2VsdmVzIHdoZW4gaXQgaGFwcGVuc1xuICBsZXQgZG9uZSA9IGZhbHNlO1xuICBsZXQgZXJyb3IgPSBudWxsO1xuICBwcm9taXNlID0gQi5yZXNvbHZlKHByb21pc2UpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9jYXRjaC1vci1yZXR1cm5cbiAgICAudGltZW91dChBVE9NX1dBSVRfVElNRU9VVClcbiAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgbG9nLmRlYnVnKGBFcnJvciByZWNlaXZlZCB3aGlsZSBleGVjdXRpbmcgYXRvbTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBCLlRpbWVvdXRFcnJvcikge1xuICAgICAgICBlcnIgPSBuZXcgRXJyb3IoYERpZCBub3QgZ2V0IGFueSByZXNwb25zZSBmb3IgYXRvbSBleGVjdXRpb24gYWZ0ZXIgJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbiAgICAgIH1cbiAgICAgIC8vIHNhdmUgYW5kIGNoZWNrIGxhdGVyLCBvciBhbiBVbmhhbmRsZWQgcmVqZWN0aW9uIHdpbGwgYmUgcmVwb3J0ZWRcbiAgICAgIGVycm9yID0gZXJyO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgZG9uZSA9IHRydWU7XG4gICAgfSk7XG5cbiAgLy8gdHJ5IHRlbiB0aW1lcyB0byBjaGVjayBhbGVydFxuICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAvLyBwYXVzZSwgb3IgdGhlIGF0b20gcHJvbWlzZSBpcyByZXNvbHZlZFxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKCgpID0+IGRvbmUsIHtcbiAgICAgICAgd2FpdE1zOiBBVE9NX1dBSVRfQUxFUlRfV0FJVCxcbiAgICAgICAgaW50ZXJ2YWxNczogMCwgLy8ganVzdCBmb3IgdGhlIHBhdXNlIGluIGV4ZWN1dGlvblxuICAgICAgfSk7XG4gICAgICAvLyBgZG9uZWAgYmVjYW1lIHRydWUsIHNvIGF0b20gcHJvbWlzZSBpcyByZXNvbHZlZFxuICAgICAgYnJlYWs7XG4gICAgfSBjYXRjaCAoaWduKSB7XG4gICAgICAvLyBgZG9uZWAgbmV2ZXIgYmVjYW1lIHRydWUsIHNvIG1vdmUgb24gdG8gdHJ5aW5nIHRvIGZpbmQgYW4gYWxlcnRcbiAgICB9XG5cbiAgICAvLyBjaGVjayBpZiB0aGVyZSBpcyBhbiBhbGVydCwgb3IgdGhlIGF0b20gcHJvbWlzZSBpcyByZXNvbHZlZFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBCLmFueShbdGhpcy5jaGVja0ZvckFsZXJ0KCksIHByb21pc2VdKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLnBhcnNlRXhlY3V0ZVJlc3BvbnNlKHJlcyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyBubyBhbGVydCBmb3VuZCwgc28gcGFzcyB0aHJvdWdoXG4gICAgICBsb2cuZGVidWcoYE5vIGFsZXJ0IGZvdW5kOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8vIGF0IHRoaXMgcG9pbnQsIGFsbCB0aGF0IGNhbiBiZSBkb25lIGlzIHdhaXQgZm9yIHRoZSBhdG9tIHByb21pc2UgdG8gYmVcbiAgLy8gcmVzb2x2ZWRcbiAgY29uc3QgcmVzID0gYXdhaXQgcHJvbWlzZTtcbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbiAgcmV0dXJuIHRoaXMucGFyc2VFeGVjdXRlUmVzcG9uc2UocmVzKTtcbn07XG5cbmV4dGVuc2lvbnMubW9iaWxlV2ViTmF2ID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlV2ViTmF2IChuYXZUeXBlKSB7XG4gIHRoaXMucmVtb3RlLmFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgPSB0cnVlO1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW2BoaXN0b3J5LiR7bmF2VHlwZX0oKTtgLCBudWxsXSk7XG4gIH0gZmluYWxseSB7XG4gICAgdGhpcy5yZW1vdGUuYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCA9IGZhbHNlO1xuICB9XG59O1xuXG5cbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy93ZWIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
