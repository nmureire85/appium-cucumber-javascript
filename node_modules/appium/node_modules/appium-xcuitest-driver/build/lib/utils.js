"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.detectUdid = detectUdid;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.checkAppPresent = checkAppPresent;
exports.getDriverInfo = getDriverInfo;
exports.clearSystemFiles = clearSystemFiles;
exports.translateDeviceName = translateDeviceName;
exports.normalizeCommandTimeouts = normalizeCommandTimeouts;
exports.markSystemFilesForCleanup = markSystemFilesForCleanup;
exports.printUser = printUser;
exports.getPIDsListeningOnPort = getPIDsListeningOnPort;
exports.encodeBase64OrUpload = encodeBase64OrUpload;
exports.removeAllSessionWebSocketHandlers = removeAllSessionWebSocketHandlers;
exports.verifyApplicationPlatform = verifyApplicationPlatform;
exports.isLocalHost = isLocalHost;
exports.normalizePlatformVersion = normalizePlatformVersion;
exports.DEFAULT_TIMEOUT_KEY = void 0;

require("source-map-support/register");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumIosDevice = require("appium-ios-device");

var _appiumSupport = require("appium-support");

var _path = _interopRequireDefault(require("path"));

var _appiumIosDriver = require("appium-ios-driver");

var _teen_process = require("teen_process");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _iosGenericSimulators = _interopRequireDefault(require("./ios-generic-simulators"));

var _url = _interopRequireDefault(require("url"));

var _os = _interopRequireDefault(require("os"));

var _semver = _interopRequireDefault(require("semver"));

const DEFAULT_TIMEOUT_KEY = 'default';
exports.DEFAULT_TIMEOUT_KEY = DEFAULT_TIMEOUT_KEY;
const XCTEST_LOG_FILES_PATTERNS = [/^Session-WebDriverAgentRunner.*\.log$/i, /^StandardOutputAndStandardError\.txt$/i];
const XCTEST_LOGS_CACHE_FOLDER_PREFIX = 'com.apple.dt.XCTest';

async function detectUdid() {
  _logger.default.debug('Auto-detecting real device udid...');

  const udids = await _appiumIosDevice.utilities.getConnectedDevices();

  if (_lodash.default.isEmpty(udids)) {
    throw new Error('No device is connected to the host');
  }

  const udid = _lodash.default.last(udids);

  if (udids.length > 1) {
    _logger.default.warn(`Multiple devices found: ${udids.join(', ')}`);

    _logger.default.warn(`Choosing '${udid}'. If this is wrong, manually set with 'udid' desired capability`);
  }

  _logger.default.debug(`Detected real device udid: '${udid}'`);

  return udid;
}

async function getAndCheckXcodeVersion() {
  let version;

  try {
    version = await _appiumXcode.default.getVersion(true);
  } catch (err) {
    _logger.default.debug(err);

    _logger.default.errorAndThrow(`Could not determine Xcode version: ${err.message}`);
  }

  if (version.versionFloat < 7.3) {
    _logger.default.errorAndThrow(`Xcode version '${version.versionString}'. Support for ` + `Xcode ${version.versionString} is not supported. ` + `Please upgrade to version 7.3 or higher`);
  }

  return version;
}

async function getAndCheckIosSdkVersion() {
  try {
    return await _appiumXcode.default.getMaxIOSSDK();
  } catch (err) {
    _logger.default.errorAndThrow(`Could not determine iOS SDK version: ${err.message}`);
  }
}

function getGenericSimulatorForIosVersion(platformVersion, deviceName) {
  let genericSimulators = _iosGenericSimulators.default[deviceName];

  if (genericSimulators) {
    genericSimulators = genericSimulators.sort(([simOne], [simTwo]) => _appiumSupport.util.compareVersions(simOne, '<', simTwo) ? -1 : 1);
    let genericIosSimulator;

    for (const [platformVersionFromList, iosSimulator] of genericSimulators) {
      if (_appiumSupport.util.compareVersions(platformVersionFromList, '>', platformVersion)) {
        break;
      }

      genericIosSimulator = iosSimulator;
    }

    return genericIosSimulator;
  }
}

function translateDeviceName(platformVersion, deviceName = '') {
  const deviceNameTranslated = getGenericSimulatorForIosVersion(platformVersion, deviceName.toLowerCase().trim());

  if (deviceNameTranslated) {
    _logger.default.debug(`Changing deviceName from '${deviceName}' to '${deviceNameTranslated}'`);

    return deviceNameTranslated;
  }

  return deviceName;
}

const derivedDataCleanupMarkers = new Map();

async function markSystemFilesForCleanup(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to mark system files for cleanup');

    return;
  }

  const logsRoot = _path.default.resolve(await wda.retrieveDerivedDataPath(), 'Logs');

  let markersCount = 0;

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    markersCount = derivedDataCleanupMarkers.get(logsRoot);
  }

  derivedDataCleanupMarkers.set(logsRoot, ++markersCount);
}

async function clearSystemFiles(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to clear system files');

    return;
  }

  const logsRoot = _path.default.resolve(await wda.retrieveDerivedDataPath(), 'Logs');

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    let markersCount = derivedDataCleanupMarkers.get(logsRoot);
    derivedDataCleanupMarkers.set(logsRoot, --markersCount);

    if (markersCount > 0) {
      _logger.default.info(`Not cleaning '${logsRoot}' folder, because the other session does not expect it to be cleaned`);

      return;
    }
  }

  derivedDataCleanupMarkers.set(logsRoot, 0);
  const globPattern = `${_os.default.tmpdir()}/${XCTEST_LOGS_CACHE_FOLDER_PREFIX}*/`;
  const dstFolders = await _appiumSupport.fs.glob(globPattern);

  if (_lodash.default.isEmpty(dstFolders)) {
    _logger.default.debug(`Did not find the temporary XCTest logs root at '${globPattern}'`);
  } else {
    for (const dstFolder of dstFolders) {
      let scheduledFilesCount = 0;

      _bluebird.default.resolve(_appiumSupport.fs.walkDir(dstFolder, true, (itemPath, isDir) => {
        if (isDir) {
          return;
        }

        const fileName = _path.default.basename(itemPath);

        if (!XCTEST_LOG_FILES_PATTERNS.some(p => p.test(fileName))) {
          return;
        }

        _appiumSupport.fs.unlink(itemPath).catch(e => {
          _logger.default.info(e.message);
        });

        scheduledFilesCount++;
      })).finally(() => {
        if (scheduledFilesCount > 0) {
          _logger.default.info(`Scheduled ${scheduledFilesCount} temporary XCTest log ` + `${_appiumSupport.util.pluralize('file', scheduledFilesCount)} for cleanup in '${dstFolder}'`);
        }
      }).catch(e => {
        _logger.default.info(e.message);
      });
    }

    _logger.default.debug(`Started background XCTest logs cleanup in '${dstFolders}'`);
  }

  if (await _appiumSupport.fs.exists(logsRoot)) {
    _logger.default.info(`Cleaning test logs in '${logsRoot}' folder`);

    await _appiumIosDriver.utils.clearLogs([logsRoot]);
    return;
  }

  _logger.default.info(`There is no ${logsRoot} folder, so not cleaning files`);
}

async function checkAppPresent(app) {
  _logger.default.debug(`Checking whether app '${app}' is actually present on file system`);

  if (!(await _appiumSupport.fs.exists(app))) {
    _logger.default.errorAndThrow(`Could not find app at '${app}'`);
  }

  _logger.default.debug('App is present');
}

async function getDriverInfo() {
  const stat = await _appiumSupport.fs.stat(_path.default.resolve(__dirname, '..'));
  const built = stat.mtime.getTime();

  const pkg = require(__filename.includes('build/lib/utils') ? '../../package.json' : '../package.json');

  const version = pkg.version;
  return {
    built,
    version
  };
}

function normalizeCommandTimeouts(value) {
  if (typeof value !== 'string') {
    return value;
  }

  let result = {};

  if (!isNaN(value)) {
    result[DEFAULT_TIMEOUT_KEY] = _lodash.default.toInteger(value);
    return result;
  }

  try {
    result = JSON.parse(value);

    if (!_lodash.default.isPlainObject(result)) {
      throw new Error();
    }
  } catch (err) {
    _logger.default.errorAndThrow(`"commandTimeouts" capability should be a valid JSON object. "${value}" was given instead`);
  }

  for (let [cmd, timeout] of _lodash.default.toPairs(result)) {
    if (!_lodash.default.isInteger(timeout) || timeout <= 0) {
      _logger.default.errorAndThrow(`The timeout for "${cmd}" should be a valid natural number of milliseconds. "${timeout}" was given instead`);
    }
  }

  return result;
}

async function printUser() {
  try {
    let {
      stdout
    } = await (0, _teen_process.exec)('whoami');

    _logger.default.debug(`Current user: '${stdout.trim()}'`);
  } catch (err) {
    _logger.default.debug(`Unable to get username running server: ${err.message}`);
  }
}

async function getPIDsListeningOnPort(port, filteringFunc = null) {
  const result = [];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('lsof', ['-ti', `tcp:${port}`]);
    result.push(...stdout.trim().split(/\n+/));
  } catch (e) {
    return result;
  }

  if (!_lodash.default.isFunction(filteringFunc)) {
    return result;
  }

  return await _bluebird.default.filter(result, async x => {
    const {
      stdout
    } = await (0, _teen_process.exec)('ps', ['-p', x, '-o', 'command']);
    return await filteringFunc(stdout);
  });
}

async function encodeBase64OrUpload(localPath, remotePath = null, uploadOptions = {}) {
  if (!(await _appiumSupport.fs.exists(localPath))) {
    _logger.default.errorAndThrow(`The file at '${localPath}' does not exist or is not accessible`);
  }

  if (_lodash.default.isEmpty(remotePath)) {
    const {
      size
    } = await _appiumSupport.fs.stat(localPath);

    _logger.default.debug(`The size of the file is ${_appiumSupport.util.toReadableSizeString(size)}`);

    return (await _appiumSupport.util.toInMemoryBase64(localPath)).toString();
  }

  const {
    user,
    pass,
    method,
    headers,
    fileFieldName,
    formFields
  } = uploadOptions;
  const options = {
    method: method || 'PUT',
    headers,
    fileFieldName,
    formFields
  };

  if (user && pass) {
    options.auth = {
      user,
      pass
    };
  }

  await _appiumSupport.net.uploadFile(localPath, remotePath, options);
  return '';
}

async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
}

async function verifyApplicationPlatform(app, expectedPlatform) {
  _logger.default.debug('Verifying application platform');

  const infoPlist = _path.default.resolve(app, 'Info.plist');

  if (!(await _appiumSupport.fs.exists(infoPlist))) {
    _logger.default.debug(`'${infoPlist}' does not exist`);

    return;
  }

  const {
    CFBundleSupportedPlatforms
  } = await _appiumSupport.plist.parsePlistFile(infoPlist);

  _logger.default.debug(`CFBundleSupportedPlatforms: ${JSON.stringify(CFBundleSupportedPlatforms)}`);

  if (!_lodash.default.isArray(CFBundleSupportedPlatforms)) {
    _logger.default.debug(`CFBundleSupportedPlatforms key does not exist in '${infoPlist}'`);

    return;
  }

  const {
    isSimulator,
    isTvOS
  } = expectedPlatform;
  const prefix = isTvOS ? 'AppleTV' : 'iPhone';
  const suffix = isSimulator ? 'Simulator' : 'OS';
  const dstPlatform = `${prefix}${suffix}`;

  if (!CFBundleSupportedPlatforms.includes(dstPlatform)) {
    throw new Error(`${isSimulator ? 'Simulator' : 'Real device'} architecture is unsupported by the '${app}' application. ` + `Make sure the correct deployment target has been selected for its compilation in Xcode.`);
  }
}

function isLocalHost(urlString) {
  try {
    const {
      hostname
    } = _url.default.parse(urlString);

    return ['localhost', '127.0.0.1', '::1', '::ffff:127.0.0.1'].includes(hostname);
  } catch (ign) {
    _logger.default.warn(`'${urlString}' cannot be parsed as a valid URL`);
  }

  return false;
}

function normalizePlatformVersion(originalVersion) {
  const normalizedVersion = _semver.default.coerce(originalVersion);

  if (!normalizedVersion) {
    throw new Error(`The platform version '${originalVersion}' should be a valid version number`);
  }

  return `${normalizedVersion.major}.${normalizedVersion.minor}`;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJERUZBVUxUX1RJTUVPVVRfS0VZIiwiWENURVNUX0xPR19GSUxFU19QQVRURVJOUyIsIlhDVEVTVF9MT0dTX0NBQ0hFX0ZPTERFUl9QUkVGSVgiLCJkZXRlY3RVZGlkIiwibG9nIiwiZGVidWciLCJ1ZGlkcyIsInV0aWxpdGllcyIsImdldENvbm5lY3RlZERldmljZXMiLCJfIiwiaXNFbXB0eSIsIkVycm9yIiwidWRpZCIsImxhc3QiLCJsZW5ndGgiLCJ3YXJuIiwiam9pbiIsImdldEFuZENoZWNrWGNvZGVWZXJzaW9uIiwidmVyc2lvbiIsInhjb2RlIiwiZ2V0VmVyc2lvbiIsImVyciIsImVycm9yQW5kVGhyb3ciLCJtZXNzYWdlIiwidmVyc2lvbkZsb2F0IiwidmVyc2lvblN0cmluZyIsImdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiIsImdldE1heElPU1NESyIsImdldEdlbmVyaWNTaW11bGF0b3JGb3JJb3NWZXJzaW9uIiwicGxhdGZvcm1WZXJzaW9uIiwiZGV2aWNlTmFtZSIsImdlbmVyaWNTaW11bGF0b3JzIiwiaW9zR2VuZXJpY1NpbXVsYXRvcnMiLCJzb3J0Iiwic2ltT25lIiwic2ltVHdvIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsImdlbmVyaWNJb3NTaW11bGF0b3IiLCJwbGF0Zm9ybVZlcnNpb25Gcm9tTGlzdCIsImlvc1NpbXVsYXRvciIsInRyYW5zbGF0ZURldmljZU5hbWUiLCJkZXZpY2VOYW1lVHJhbnNsYXRlZCIsInRvTG93ZXJDYXNlIiwidHJpbSIsImRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMiLCJNYXAiLCJtYXJrU3lzdGVtRmlsZXNGb3JDbGVhbnVwIiwid2RhIiwicmV0cmlldmVEZXJpdmVkRGF0YVBhdGgiLCJsb2dzUm9vdCIsInBhdGgiLCJyZXNvbHZlIiwibWFya2Vyc0NvdW50IiwiaGFzIiwiZ2V0Iiwic2V0IiwiY2xlYXJTeXN0ZW1GaWxlcyIsImluZm8iLCJnbG9iUGF0dGVybiIsIm9zIiwidG1wZGlyIiwiZHN0Rm9sZGVycyIsImZzIiwiZ2xvYiIsImRzdEZvbGRlciIsInNjaGVkdWxlZEZpbGVzQ291bnQiLCJCIiwid2Fsa0RpciIsIml0ZW1QYXRoIiwiaXNEaXIiLCJmaWxlTmFtZSIsImJhc2VuYW1lIiwic29tZSIsInAiLCJ0ZXN0IiwidW5saW5rIiwiY2F0Y2giLCJlIiwiZmluYWxseSIsInBsdXJhbGl6ZSIsImV4aXN0cyIsImlvc1V0aWxzIiwiY2xlYXJMb2dzIiwiY2hlY2tBcHBQcmVzZW50IiwiYXBwIiwiZ2V0RHJpdmVySW5mbyIsInN0YXQiLCJfX2Rpcm5hbWUiLCJidWlsdCIsIm10aW1lIiwiZ2V0VGltZSIsInBrZyIsInJlcXVpcmUiLCJfX2ZpbGVuYW1lIiwiaW5jbHVkZXMiLCJub3JtYWxpemVDb21tYW5kVGltZW91dHMiLCJ2YWx1ZSIsInJlc3VsdCIsImlzTmFOIiwidG9JbnRlZ2VyIiwiSlNPTiIsInBhcnNlIiwiaXNQbGFpbk9iamVjdCIsImNtZCIsInRpbWVvdXQiLCJ0b1BhaXJzIiwiaXNJbnRlZ2VyIiwicHJpbnRVc2VyIiwic3Rkb3V0IiwiZ2V0UElEc0xpc3RlbmluZ09uUG9ydCIsInBvcnQiLCJmaWx0ZXJpbmdGdW5jIiwicHVzaCIsInNwbGl0IiwiaXNGdW5jdGlvbiIsImZpbHRlciIsIngiLCJlbmNvZGVCYXNlNjRPclVwbG9hZCIsImxvY2FsUGF0aCIsInJlbW90ZVBhdGgiLCJ1cGxvYWRPcHRpb25zIiwic2l6ZSIsInRvUmVhZGFibGVTaXplU3RyaW5nIiwidG9Jbk1lbW9yeUJhc2U2NCIsInRvU3RyaW5nIiwidXNlciIsInBhc3MiLCJtZXRob2QiLCJoZWFkZXJzIiwiZmlsZUZpZWxkTmFtZSIsImZvcm1GaWVsZHMiLCJvcHRpb25zIiwiYXV0aCIsIm5ldCIsInVwbG9hZEZpbGUiLCJyZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMiLCJzZXJ2ZXIiLCJzZXNzaW9uSWQiLCJnZXRXZWJTb2NrZXRIYW5kbGVycyIsImFjdGl2ZUhhbmRsZXJzIiwicGF0aG5hbWUiLCJrZXlzIiwicmVtb3ZlV2ViU29ja2V0SGFuZGxlciIsInZlcmlmeUFwcGxpY2F0aW9uUGxhdGZvcm0iLCJleHBlY3RlZFBsYXRmb3JtIiwiaW5mb1BsaXN0IiwiQ0ZCdW5kbGVTdXBwb3J0ZWRQbGF0Zm9ybXMiLCJwbGlzdCIsInBhcnNlUGxpc3RGaWxlIiwic3RyaW5naWZ5IiwiaXNBcnJheSIsImlzU2ltdWxhdG9yIiwiaXNUdk9TIiwicHJlZml4Iiwic3VmZml4IiwiZHN0UGxhdGZvcm0iLCJpc0xvY2FsSG9zdCIsInVybFN0cmluZyIsImhvc3RuYW1lIiwidXJsIiwiaWduIiwibm9ybWFsaXplUGxhdGZvcm1WZXJzaW9uIiwib3JpZ2luYWxWZXJzaW9uIiwibm9ybWFsaXplZFZlcnNpb24iLCJzZW12ZXIiLCJjb2VyY2UiLCJtYWpvciIsIm1pbm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxtQkFBbUIsR0FBRyxTQUE1Qjs7QUFDQSxNQUFNQyx5QkFBeUIsR0FBRyxDQUNoQyx3Q0FEZ0MsRUFFaEMsd0NBRmdDLENBQWxDO0FBSUEsTUFBTUMsK0JBQStCLEdBQUcscUJBQXhDOztBQUdBLGVBQWVDLFVBQWYsR0FBNkI7QUFDM0JDLGtCQUFJQyxLQUFKLENBQVUsb0NBQVY7O0FBQ0EsUUFBTUMsS0FBSyxHQUFHLE1BQU1DLDJCQUFVQyxtQkFBVixFQUFwQjs7QUFDQSxNQUFJQyxnQkFBRUMsT0FBRixDQUFVSixLQUFWLENBQUosRUFBc0I7QUFDcEIsVUFBTSxJQUFJSyxLQUFKLENBQVUsb0NBQVYsQ0FBTjtBQUNEOztBQUNELFFBQU1DLElBQUksR0FBR0gsZ0JBQUVJLElBQUYsQ0FBT1AsS0FBUCxDQUFiOztBQUNBLE1BQUlBLEtBQUssQ0FBQ1EsTUFBTixHQUFlLENBQW5CLEVBQXNCO0FBQ3BCVixvQkFBSVcsSUFBSixDQUFVLDJCQUEwQlQsS0FBSyxDQUFDVSxJQUFOLENBQVcsSUFBWCxDQUFpQixFQUFyRDs7QUFDQVosb0JBQUlXLElBQUosQ0FBVSxhQUFZSCxJQUFLLGtFQUEzQjtBQUNEOztBQUNEUixrQkFBSUMsS0FBSixDQUFXLCtCQUE4Qk8sSUFBSyxHQUE5Qzs7QUFDQSxTQUFPQSxJQUFQO0FBQ0Q7O0FBRUQsZUFBZUssdUJBQWYsR0FBMEM7QUFDeEMsTUFBSUMsT0FBSjs7QUFDQSxNQUFJO0FBQ0ZBLElBQUFBLE9BQU8sR0FBRyxNQUFNQyxxQkFBTUMsVUFBTixDQUFpQixJQUFqQixDQUFoQjtBQUNELEdBRkQsQ0FFRSxPQUFPQyxHQUFQLEVBQVk7QUFDWmpCLG9CQUFJQyxLQUFKLENBQVVnQixHQUFWOztBQUNBakIsb0JBQUlrQixhQUFKLENBQW1CLHNDQUFxQ0QsR0FBRyxDQUFDRSxPQUFRLEVBQXBFO0FBQ0Q7O0FBR0QsTUFBSUwsT0FBTyxDQUFDTSxZQUFSLEdBQXVCLEdBQTNCLEVBQWdDO0FBQzlCcEIsb0JBQUlrQixhQUFKLENBQW1CLGtCQUFpQkosT0FBTyxDQUFDTyxhQUFjLGlCQUF4QyxHQUNDLFNBQVFQLE9BQU8sQ0FBQ08sYUFBYyxxQkFEL0IsR0FFQyx5Q0FGbkI7QUFHRDs7QUFDRCxTQUFPUCxPQUFQO0FBQ0Q7O0FBRUQsZUFBZVEsd0JBQWYsR0FBMkM7QUFDekMsTUFBSTtBQUNGLFdBQU8sTUFBTVAscUJBQU1RLFlBQU4sRUFBYjtBQUNELEdBRkQsQ0FFRSxPQUFPTixHQUFQLEVBQVk7QUFDWmpCLG9CQUFJa0IsYUFBSixDQUFtQix3Q0FBdUNELEdBQUcsQ0FBQ0UsT0FBUSxFQUF0RTtBQUNEO0FBQ0Y7O0FBVUQsU0FBU0ssZ0NBQVQsQ0FBMkNDLGVBQTNDLEVBQTREQyxVQUE1RCxFQUF3RTtBQUN0RSxNQUFJQyxpQkFBaUIsR0FBR0MsOEJBQXFCRixVQUFyQixDQUF4Qjs7QUFFQSxNQUFJQyxpQkFBSixFQUF1QjtBQUNyQkEsSUFBQUEsaUJBQWlCLEdBQUdBLGlCQUFpQixDQUFDRSxJQUFsQixDQUF1QixDQUFDLENBQUNDLE1BQUQsQ0FBRCxFQUFXLENBQUNDLE1BQUQsQ0FBWCxLQUF3QkMsb0JBQUtDLGVBQUwsQ0FBcUJILE1BQXJCLEVBQTZCLEdBQTdCLEVBQWtDQyxNQUFsQyxJQUE0QyxDQUFDLENBQTdDLEdBQWlELENBQWhHLENBQXBCO0FBR0EsUUFBSUcsbUJBQUo7O0FBQ0EsU0FBSyxNQUFNLENBQUNDLHVCQUFELEVBQTBCQyxZQUExQixDQUFYLElBQXNEVCxpQkFBdEQsRUFBeUU7QUFDdkUsVUFBSUssb0JBQUtDLGVBQUwsQ0FBcUJFLHVCQUFyQixFQUE4QyxHQUE5QyxFQUFtRFYsZUFBbkQsQ0FBSixFQUF5RTtBQUN2RTtBQUNEOztBQUNEUyxNQUFBQSxtQkFBbUIsR0FBR0UsWUFBdEI7QUFDRDs7QUFDRCxXQUFPRixtQkFBUDtBQUNEO0FBQ0Y7O0FBRUQsU0FBU0csbUJBQVQsQ0FBOEJaLGVBQTlCLEVBQStDQyxVQUFVLEdBQUcsRUFBNUQsRUFBZ0U7QUFDOUQsUUFBTVksb0JBQW9CLEdBQUdkLGdDQUFnQyxDQUFDQyxlQUFELEVBQWtCQyxVQUFVLENBQUNhLFdBQVgsR0FBeUJDLElBQXpCLEVBQWxCLENBQTdEOztBQUNBLE1BQUlGLG9CQUFKLEVBQTBCO0FBQ3hCdEMsb0JBQUlDLEtBQUosQ0FBVyw2QkFBNEJ5QixVQUFXLFNBQVFZLG9CQUFxQixHQUEvRTs7QUFDQSxXQUFPQSxvQkFBUDtBQUNEOztBQUNELFNBQU9aLFVBQVA7QUFDRDs7QUFLRCxNQUFNZSx5QkFBeUIsR0FBRyxJQUFJQyxHQUFKLEVBQWxDOztBQUVBLGVBQWVDLHlCQUFmLENBQTBDQyxHQUExQyxFQUErQztBQUM3QyxNQUFJLENBQUNBLEdBQUQsSUFBUSxFQUFDLE1BQU1BLEdBQUcsQ0FBQ0MsdUJBQUosRUFBUCxDQUFaLEVBQWtEO0FBQ2hEN0Msb0JBQUlXLElBQUosQ0FBUyxzRkFBVDs7QUFDQTtBQUNEOztBQUVELFFBQU1tQyxRQUFRLEdBQUdDLGNBQUtDLE9BQUwsQ0FBYSxNQUFNSixHQUFHLENBQUNDLHVCQUFKLEVBQW5CLEVBQWtELE1BQWxELENBQWpCOztBQUNBLE1BQUlJLFlBQVksR0FBRyxDQUFuQjs7QUFDQSxNQUFJUix5QkFBeUIsQ0FBQ1MsR0FBMUIsQ0FBOEJKLFFBQTlCLENBQUosRUFBNkM7QUFDM0NHLElBQUFBLFlBQVksR0FBR1IseUJBQXlCLENBQUNVLEdBQTFCLENBQThCTCxRQUE5QixDQUFmO0FBQ0Q7O0FBQ0RMLEVBQUFBLHlCQUF5QixDQUFDVyxHQUExQixDQUE4Qk4sUUFBOUIsRUFBd0MsRUFBRUcsWUFBMUM7QUFDRDs7QUFFRCxlQUFlSSxnQkFBZixDQUFpQ1QsR0FBakMsRUFBc0M7QUFFcEMsTUFBSSxDQUFDQSxHQUFELElBQVEsRUFBQyxNQUFNQSxHQUFHLENBQUNDLHVCQUFKLEVBQVAsQ0FBWixFQUFrRDtBQUNoRDdDLG9CQUFJVyxJQUFKLENBQVMsMkVBQVQ7O0FBQ0E7QUFDRDs7QUFFRCxRQUFNbUMsUUFBUSxHQUFHQyxjQUFLQyxPQUFMLENBQWEsTUFBTUosR0FBRyxDQUFDQyx1QkFBSixFQUFuQixFQUFrRCxNQUFsRCxDQUFqQjs7QUFDQSxNQUFJSix5QkFBeUIsQ0FBQ1MsR0FBMUIsQ0FBOEJKLFFBQTlCLENBQUosRUFBNkM7QUFDM0MsUUFBSUcsWUFBWSxHQUFHUix5QkFBeUIsQ0FBQ1UsR0FBMUIsQ0FBOEJMLFFBQTlCLENBQW5CO0FBQ0FMLElBQUFBLHlCQUF5QixDQUFDVyxHQUExQixDQUE4Qk4sUUFBOUIsRUFBd0MsRUFBRUcsWUFBMUM7O0FBQ0EsUUFBSUEsWUFBWSxHQUFHLENBQW5CLEVBQXNCO0FBQ3BCakQsc0JBQUlzRCxJQUFKLENBQVUsaUJBQWdCUixRQUFTLHNFQUFuQzs7QUFDQTtBQUNEO0FBQ0Y7O0FBQ0RMLEVBQUFBLHlCQUF5QixDQUFDVyxHQUExQixDQUE4Qk4sUUFBOUIsRUFBd0MsQ0FBeEM7QUFHQSxRQUFNUyxXQUFXLEdBQUksR0FBRUMsWUFBR0MsTUFBSCxFQUFZLElBQUczRCwrQkFBZ0MsSUFBdEU7QUFDQSxRQUFNNEQsVUFBVSxHQUFHLE1BQU1DLGtCQUFHQyxJQUFILENBQVFMLFdBQVIsQ0FBekI7O0FBQ0EsTUFBSWxELGdCQUFFQyxPQUFGLENBQVVvRCxVQUFWLENBQUosRUFBMkI7QUFDekIxRCxvQkFBSUMsS0FBSixDQUFXLG1EQUFrRHNELFdBQVksR0FBekU7QUFDRCxHQUZELE1BRU87QUFFTCxTQUFLLE1BQU1NLFNBQVgsSUFBd0JILFVBQXhCLEVBQW9DO0FBQ2xDLFVBQUlJLG1CQUFtQixHQUFHLENBQTFCOztBQUNBQyx3QkFBRWYsT0FBRixDQUFVVyxrQkFBR0ssT0FBSCxDQUFXSCxTQUFYLEVBQXNCLElBQXRCLEVBQTRCLENBQUNJLFFBQUQsRUFBV0MsS0FBWCxLQUFxQjtBQUN6RCxZQUFJQSxLQUFKLEVBQVc7QUFDVDtBQUNEOztBQUNELGNBQU1DLFFBQVEsR0FBR3BCLGNBQUtxQixRQUFMLENBQWNILFFBQWQsQ0FBakI7O0FBQ0EsWUFBSSxDQUFDcEUseUJBQXlCLENBQUN3RSxJQUExQixDQUFnQ0MsQ0FBRCxJQUFPQSxDQUFDLENBQUNDLElBQUYsQ0FBT0osUUFBUCxDQUF0QyxDQUFMLEVBQThEO0FBQzVEO0FBQ0Q7O0FBR0RSLDBCQUFHYSxNQUFILENBQVVQLFFBQVYsRUFBb0JRLEtBQXBCLENBQTJCQyxDQUFELElBQU87QUFDL0IxRSwwQkFBSXNELElBQUosQ0FBU29CLENBQUMsQ0FBQ3ZELE9BQVg7QUFDRCxTQUZEOztBQUdBMkMsUUFBQUEsbUJBQW1CO0FBQ3BCLE9BZFMsQ0FBVixFQWNJYSxPQWRKLENBY1ksTUFBTTtBQUNoQixZQUFJYixtQkFBbUIsR0FBRyxDQUExQixFQUE2QjtBQUMzQjlELDBCQUFJc0QsSUFBSixDQUFVLGFBQVlRLG1CQUFvQix3QkFBakMsR0FDTixHQUFFOUIsb0JBQUs0QyxTQUFMLENBQWUsTUFBZixFQUF1QmQsbUJBQXZCLENBQTRDLG9CQUFtQkQsU0FBVSxHQUQ5RTtBQUVEO0FBQ0YsT0FuQkQsRUFtQkdZLEtBbkJILENBbUJVQyxDQUFELElBQU87QUFDZDFFLHdCQUFJc0QsSUFBSixDQUFTb0IsQ0FBQyxDQUFDdkQsT0FBWDtBQUNELE9BckJEO0FBc0JEOztBQUNEbkIsb0JBQUlDLEtBQUosQ0FBVyw4Q0FBNkN5RCxVQUFXLEdBQW5FO0FBQ0Q7O0FBRUQsTUFBSSxNQUFNQyxrQkFBR2tCLE1BQUgsQ0FBVS9CLFFBQVYsQ0FBVixFQUErQjtBQUM3QjlDLG9CQUFJc0QsSUFBSixDQUFVLDBCQUF5QlIsUUFBUyxVQUE1Qzs7QUFDQSxVQUFNZ0MsdUJBQVNDLFNBQVQsQ0FBbUIsQ0FBQ2pDLFFBQUQsQ0FBbkIsQ0FBTjtBQUNBO0FBQ0Q7O0FBQ0Q5QyxrQkFBSXNELElBQUosQ0FBVSxlQUFjUixRQUFTLGdDQUFqQztBQUNEOztBQUVELGVBQWVrQyxlQUFmLENBQWdDQyxHQUFoQyxFQUFxQztBQUNuQ2pGLGtCQUFJQyxLQUFKLENBQVcseUJBQXdCZ0YsR0FBSSxzQ0FBdkM7O0FBQ0EsTUFBSSxFQUFFLE1BQU10QixrQkFBR2tCLE1BQUgsQ0FBVUksR0FBVixDQUFSLENBQUosRUFBNkI7QUFDM0JqRixvQkFBSWtCLGFBQUosQ0FBbUIsMEJBQXlCK0QsR0FBSSxHQUFoRDtBQUNEOztBQUNEakYsa0JBQUlDLEtBQUosQ0FBVSxnQkFBVjtBQUNEOztBQUVELGVBQWVpRixhQUFmLEdBQWdDO0FBQzlCLFFBQU1DLElBQUksR0FBRyxNQUFNeEIsa0JBQUd3QixJQUFILENBQVFwQyxjQUFLQyxPQUFMLENBQWFvQyxTQUFiLEVBQXdCLElBQXhCLENBQVIsQ0FBbkI7QUFDQSxRQUFNQyxLQUFLLEdBQUdGLElBQUksQ0FBQ0csS0FBTCxDQUFXQyxPQUFYLEVBQWQ7O0FBR0EsUUFBTUMsR0FBRyxHQUFHQyxPQUFPLENBQUNDLFVBQVUsQ0FBQ0MsUUFBWCxDQUFvQixpQkFBcEIsSUFBeUMsb0JBQXpDLEdBQWdFLGlCQUFqRSxDQUFuQjs7QUFDQSxRQUFNN0UsT0FBTyxHQUFHMEUsR0FBRyxDQUFDMUUsT0FBcEI7QUFFQSxTQUFPO0FBQ0x1RSxJQUFBQSxLQURLO0FBRUx2RSxJQUFBQTtBQUZLLEdBQVA7QUFJRDs7QUFFRCxTQUFTOEUsd0JBQVQsQ0FBbUNDLEtBQW5DLEVBQTBDO0FBRXhDLE1BQUksT0FBT0EsS0FBUCxLQUFpQixRQUFyQixFQUErQjtBQUM3QixXQUFPQSxLQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsTUFBTSxHQUFHLEVBQWI7O0FBRUEsTUFBSSxDQUFDQyxLQUFLLENBQUNGLEtBQUQsQ0FBVixFQUFtQjtBQUNqQkMsSUFBQUEsTUFBTSxDQUFDbEcsbUJBQUQsQ0FBTixHQUE4QlMsZ0JBQUUyRixTQUFGLENBQVlILEtBQVosQ0FBOUI7QUFDQSxXQUFPQyxNQUFQO0FBQ0Q7O0FBR0QsTUFBSTtBQUNGQSxJQUFBQSxNQUFNLEdBQUdHLElBQUksQ0FBQ0MsS0FBTCxDQUFXTCxLQUFYLENBQVQ7O0FBQ0EsUUFBSSxDQUFDeEYsZ0JBQUU4RixhQUFGLENBQWdCTCxNQUFoQixDQUFMLEVBQThCO0FBQzVCLFlBQU0sSUFBSXZGLEtBQUosRUFBTjtBQUNEO0FBQ0YsR0FMRCxDQUtFLE9BQU9VLEdBQVAsRUFBWTtBQUNaakIsb0JBQUlrQixhQUFKLENBQW1CLGdFQUErRDJFLEtBQU0scUJBQXhGO0FBQ0Q7O0FBQ0QsT0FBSyxJQUFJLENBQUNPLEdBQUQsRUFBTUMsT0FBTixDQUFULElBQTJCaEcsZ0JBQUVpRyxPQUFGLENBQVVSLE1BQVYsQ0FBM0IsRUFBOEM7QUFDNUMsUUFBSSxDQUFDekYsZ0JBQUVrRyxTQUFGLENBQVlGLE9BQVosQ0FBRCxJQUF5QkEsT0FBTyxJQUFJLENBQXhDLEVBQTJDO0FBQ3pDckcsc0JBQUlrQixhQUFKLENBQW1CLG9CQUFtQmtGLEdBQUksd0RBQXVEQyxPQUFRLHFCQUF6RztBQUNEO0FBQ0Y7O0FBQ0QsU0FBT1AsTUFBUDtBQUNEOztBQUVELGVBQWVVLFNBQWYsR0FBNEI7QUFDMUIsTUFBSTtBQUNGLFFBQUk7QUFBQ0MsTUFBQUE7QUFBRCxRQUFXLE1BQU0sd0JBQUssUUFBTCxDQUFyQjs7QUFDQXpHLG9CQUFJQyxLQUFKLENBQVcsa0JBQWlCd0csTUFBTSxDQUFDakUsSUFBUCxFQUFjLEdBQTFDO0FBQ0QsR0FIRCxDQUdFLE9BQU92QixHQUFQLEVBQVk7QUFDWmpCLG9CQUFJQyxLQUFKLENBQVcsMENBQXlDZ0IsR0FBRyxDQUFDRSxPQUFRLEVBQWhFO0FBQ0Q7QUFDRjs7QUFlRCxlQUFldUYsc0JBQWYsQ0FBdUNDLElBQXZDLEVBQTZDQyxhQUFhLEdBQUcsSUFBN0QsRUFBbUU7QUFDakUsUUFBTWQsTUFBTSxHQUFHLEVBQWY7O0FBQ0EsTUFBSTtBQUVGLFVBQU07QUFBQ1csTUFBQUE7QUFBRCxRQUFXLE1BQU0sd0JBQUssTUFBTCxFQUFhLENBQUMsS0FBRCxFQUFTLE9BQU1FLElBQUssRUFBcEIsQ0FBYixDQUF2QjtBQUNBYixJQUFBQSxNQUFNLENBQUNlLElBQVAsQ0FBWSxHQUFJSixNQUFNLENBQUNqRSxJQUFQLEdBQWNzRSxLQUFkLENBQW9CLEtBQXBCLENBQWhCO0FBQ0QsR0FKRCxDQUlFLE9BQU9wQyxDQUFQLEVBQVU7QUFDVixXQUFPb0IsTUFBUDtBQUNEOztBQUVELE1BQUksQ0FBQ3pGLGdCQUFFMEcsVUFBRixDQUFhSCxhQUFiLENBQUwsRUFBa0M7QUFDaEMsV0FBT2QsTUFBUDtBQUNEOztBQUNELFNBQU8sTUFBTS9CLGtCQUFFaUQsTUFBRixDQUFTbEIsTUFBVCxFQUFpQixNQUFPbUIsQ0FBUCxJQUFhO0FBQ3pDLFVBQU07QUFBQ1IsTUFBQUE7QUFBRCxRQUFXLE1BQU0sd0JBQUssSUFBTCxFQUFXLENBQUMsSUFBRCxFQUFPUSxDQUFQLEVBQVUsSUFBVixFQUFnQixTQUFoQixDQUFYLENBQXZCO0FBQ0EsV0FBTyxNQUFNTCxhQUFhLENBQUNILE1BQUQsQ0FBMUI7QUFDRCxHQUhZLENBQWI7QUFJRDs7QUE0QkQsZUFBZVMsb0JBQWYsQ0FBcUNDLFNBQXJDLEVBQWdEQyxVQUFVLEdBQUcsSUFBN0QsRUFBbUVDLGFBQWEsR0FBRyxFQUFuRixFQUF1RjtBQUNyRixNQUFJLEVBQUMsTUFBTTFELGtCQUFHa0IsTUFBSCxDQUFVc0MsU0FBVixDQUFQLENBQUosRUFBaUM7QUFDL0JuSCxvQkFBSWtCLGFBQUosQ0FBbUIsZ0JBQWVpRyxTQUFVLHVDQUE1QztBQUNEOztBQUVELE1BQUk5RyxnQkFBRUMsT0FBRixDQUFVOEcsVUFBVixDQUFKLEVBQTJCO0FBQ3pCLFVBQU07QUFBQ0UsTUFBQUE7QUFBRCxRQUFTLE1BQU0zRCxrQkFBR3dCLElBQUgsQ0FBUWdDLFNBQVIsQ0FBckI7O0FBQ0FuSCxvQkFBSUMsS0FBSixDQUFXLDJCQUEwQitCLG9CQUFLdUYsb0JBQUwsQ0FBMEJELElBQTFCLENBQWdDLEVBQXJFOztBQUNBLFdBQU8sQ0FBQyxNQUFNdEYsb0JBQUt3RixnQkFBTCxDQUFzQkwsU0FBdEIsQ0FBUCxFQUF5Q00sUUFBekMsRUFBUDtBQUNEOztBQUVELFFBQU07QUFBQ0MsSUFBQUEsSUFBRDtBQUFPQyxJQUFBQSxJQUFQO0FBQWFDLElBQUFBLE1BQWI7QUFBcUJDLElBQUFBLE9BQXJCO0FBQThCQyxJQUFBQSxhQUE5QjtBQUE2Q0MsSUFBQUE7QUFBN0MsTUFBMkRWLGFBQWpFO0FBQ0EsUUFBTVcsT0FBTyxHQUFHO0FBQ2RKLElBQUFBLE1BQU0sRUFBRUEsTUFBTSxJQUFJLEtBREo7QUFFZEMsSUFBQUEsT0FGYztBQUdkQyxJQUFBQSxhQUhjO0FBSWRDLElBQUFBO0FBSmMsR0FBaEI7O0FBTUEsTUFBSUwsSUFBSSxJQUFJQyxJQUFaLEVBQWtCO0FBQ2hCSyxJQUFBQSxPQUFPLENBQUNDLElBQVIsR0FBZTtBQUFDUCxNQUFBQSxJQUFEO0FBQU9DLE1BQUFBO0FBQVAsS0FBZjtBQUNEOztBQUNELFFBQU1PLG1CQUFJQyxVQUFKLENBQWVoQixTQUFmLEVBQTBCQyxVQUExQixFQUFzQ1ksT0FBdEMsQ0FBTjtBQUNBLFNBQU8sRUFBUDtBQUNEOztBQVVELGVBQWVJLGlDQUFmLENBQWtEQyxNQUFsRCxFQUEwREMsU0FBMUQsRUFBcUU7QUFDbkUsTUFBSSxDQUFDRCxNQUFELElBQVcsQ0FBQ2hJLGdCQUFFMEcsVUFBRixDQUFhc0IsTUFBTSxDQUFDRSxvQkFBcEIsQ0FBaEIsRUFBMkQ7QUFDekQ7QUFDRDs7QUFFRCxRQUFNQyxjQUFjLEdBQUcsTUFBTUgsTUFBTSxDQUFDRSxvQkFBUCxDQUE0QkQsU0FBNUIsQ0FBN0I7O0FBQ0EsT0FBSyxNQUFNRyxRQUFYLElBQXVCcEksZ0JBQUVxSSxJQUFGLENBQU9GLGNBQVAsQ0FBdkIsRUFBK0M7QUFDN0MsVUFBTUgsTUFBTSxDQUFDTSxzQkFBUCxDQUE4QkYsUUFBOUIsQ0FBTjtBQUNEO0FBQ0Y7O0FBaUJELGVBQWVHLHlCQUFmLENBQTBDM0QsR0FBMUMsRUFBK0M0RCxnQkFBL0MsRUFBaUU7QUFDL0Q3SSxrQkFBSUMsS0FBSixDQUFVLGdDQUFWOztBQUVBLFFBQU02SSxTQUFTLEdBQUcvRixjQUFLQyxPQUFMLENBQWFpQyxHQUFiLEVBQWtCLFlBQWxCLENBQWxCOztBQUNBLE1BQUksRUFBQyxNQUFNdEIsa0JBQUdrQixNQUFILENBQVVpRSxTQUFWLENBQVAsQ0FBSixFQUFpQztBQUMvQjlJLG9CQUFJQyxLQUFKLENBQVcsSUFBRzZJLFNBQVUsa0JBQXhCOztBQUNBO0FBQ0Q7O0FBRUQsUUFBTTtBQUFDQyxJQUFBQTtBQUFELE1BQStCLE1BQU1DLHFCQUFNQyxjQUFOLENBQXFCSCxTQUFyQixDQUEzQzs7QUFDQTlJLGtCQUFJQyxLQUFKLENBQVcsK0JBQThCZ0csSUFBSSxDQUFDaUQsU0FBTCxDQUFlSCwwQkFBZixDQUEyQyxFQUFwRjs7QUFDQSxNQUFJLENBQUMxSSxnQkFBRThJLE9BQUYsQ0FBVUosMEJBQVYsQ0FBTCxFQUE0QztBQUMxQy9JLG9CQUFJQyxLQUFKLENBQVcscURBQW9ENkksU0FBVSxHQUF6RTs7QUFDQTtBQUNEOztBQUVELFFBQU07QUFDSk0sSUFBQUEsV0FESTtBQUVKQyxJQUFBQTtBQUZJLE1BR0ZSLGdCQUhKO0FBSUEsUUFBTVMsTUFBTSxHQUFHRCxNQUFNLEdBQUcsU0FBSCxHQUFlLFFBQXBDO0FBQ0EsUUFBTUUsTUFBTSxHQUFHSCxXQUFXLEdBQUcsV0FBSCxHQUFpQixJQUEzQztBQUNBLFFBQU1JLFdBQVcsR0FBSSxHQUFFRixNQUFPLEdBQUVDLE1BQU8sRUFBdkM7O0FBQ0EsTUFBSSxDQUFDUiwwQkFBMEIsQ0FBQ3BELFFBQTNCLENBQW9DNkQsV0FBcEMsQ0FBTCxFQUF1RDtBQUNyRCxVQUFNLElBQUlqSixLQUFKLENBQVcsR0FBRTZJLFdBQVcsR0FBRyxXQUFILEdBQWlCLGFBQWMsd0NBQXVDbkUsR0FBSSxpQkFBeEYsR0FDYix5RkFERyxDQUFOO0FBRUQ7QUFDRjs7QUFPRCxTQUFTd0UsV0FBVCxDQUFzQkMsU0FBdEIsRUFBaUM7QUFDL0IsTUFBSTtBQUNGLFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFhQyxhQUFJMUQsS0FBSixDQUFVd0QsU0FBVixDQUFuQjs7QUFDQSxXQUFPLENBQUMsV0FBRCxFQUFjLFdBQWQsRUFBMkIsS0FBM0IsRUFBa0Msa0JBQWxDLEVBQXNEL0QsUUFBdEQsQ0FBK0RnRSxRQUEvRCxDQUFQO0FBQ0QsR0FIRCxDQUdFLE9BQU9FLEdBQVAsRUFBWTtBQUNaN0osb0JBQUlXLElBQUosQ0FBVSxJQUFHK0ksU0FBVSxtQ0FBdkI7QUFDRDs7QUFDRCxTQUFPLEtBQVA7QUFDRDs7QUFTRCxTQUFTSSx3QkFBVCxDQUFtQ0MsZUFBbkMsRUFBb0Q7QUFDbEQsUUFBTUMsaUJBQWlCLEdBQUdDLGdCQUFPQyxNQUFQLENBQWNILGVBQWQsQ0FBMUI7O0FBQ0EsTUFBSSxDQUFDQyxpQkFBTCxFQUF3QjtBQUN0QixVQUFNLElBQUl6SixLQUFKLENBQVcseUJBQXdCd0osZUFBZ0Isb0NBQW5ELENBQU47QUFDRDs7QUFDRCxTQUFRLEdBQUVDLGlCQUFpQixDQUFDRyxLQUFNLElBQUdILGlCQUFpQixDQUFDSSxLQUFNLEVBQTdEO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyB1dGlsaXRpZXMgfSBmcm9tICdhcHBpdW0taW9zLWRldmljZSc7XG5pbXBvcnQgeyBmcywgdXRpbCwgbmV0LCBwbGlzdCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgdXRpbHMgYXMgaW9zVXRpbHMgfSBmcm9tICdhcHBpdW0taW9zLWRyaXZlcic7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IGlvc0dlbmVyaWNTaW11bGF0b3JzIGZyb20gJy4vaW9zLWdlbmVyaWMtc2ltdWxhdG9ycyc7XG5pbXBvcnQgdXJsIGZyb20gJ3VybCc7XG5pbXBvcnQgb3MgZnJvbSAnb3MnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuXG5cbmNvbnN0IERFRkFVTFRfVElNRU9VVF9LRVkgPSAnZGVmYXVsdCc7XG5jb25zdCBYQ1RFU1RfTE9HX0ZJTEVTX1BBVFRFUk5TID0gW1xuICAvXlNlc3Npb24tV2ViRHJpdmVyQWdlbnRSdW5uZXIuKlxcLmxvZyQvaSxcbiAgL15TdGFuZGFyZE91dHB1dEFuZFN0YW5kYXJkRXJyb3JcXC50eHQkL2ksXG5dO1xuY29uc3QgWENURVNUX0xPR1NfQ0FDSEVfRk9MREVSX1BSRUZJWCA9ICdjb20uYXBwbGUuZHQuWENUZXN0JztcblxuXG5hc3luYyBmdW5jdGlvbiBkZXRlY3RVZGlkICgpIHtcbiAgbG9nLmRlYnVnKCdBdXRvLWRldGVjdGluZyByZWFsIGRldmljZSB1ZGlkLi4uJyk7XG4gIGNvbnN0IHVkaWRzID0gYXdhaXQgdXRpbGl0aWVzLmdldENvbm5lY3RlZERldmljZXMoKTtcbiAgaWYgKF8uaXNFbXB0eSh1ZGlkcykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGRldmljZSBpcyBjb25uZWN0ZWQgdG8gdGhlIGhvc3QnKTtcbiAgfVxuICBjb25zdCB1ZGlkID0gXy5sYXN0KHVkaWRzKTtcbiAgaWYgKHVkaWRzLmxlbmd0aCA+IDEpIHtcbiAgICBsb2cud2FybihgTXVsdGlwbGUgZGV2aWNlcyBmb3VuZDogJHt1ZGlkcy5qb2luKCcsICcpfWApO1xuICAgIGxvZy53YXJuKGBDaG9vc2luZyAnJHt1ZGlkfScuIElmIHRoaXMgaXMgd3JvbmcsIG1hbnVhbGx5IHNldCB3aXRoICd1ZGlkJyBkZXNpcmVkIGNhcGFiaWxpdHlgKTtcbiAgfVxuICBsb2cuZGVidWcoYERldGVjdGVkIHJlYWwgZGV2aWNlIHVkaWQ6ICcke3VkaWR9J2ApO1xuICByZXR1cm4gdWRpZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24gKCkge1xuICBsZXQgdmVyc2lvbjtcbiAgdHJ5IHtcbiAgICB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbih0cnVlKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmRlYnVnKGVycik7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBkZXRlcm1pbmUgWGNvZGUgdmVyc2lvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuXG4gIC8vIHdlIGRvIG5vdCBzdXBwb3J0IFhjb2RlcyA8IDcuMyxcbiAgaWYgKHZlcnNpb24udmVyc2lvbkZsb2F0IDwgNy4zKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFhjb2RlIHZlcnNpb24gJyR7dmVyc2lvbi52ZXJzaW9uU3RyaW5nfScuIFN1cHBvcnQgZm9yIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBYY29kZSAke3ZlcnNpb24udmVyc2lvblN0cmluZ30gaXMgbm90IHN1cHBvcnRlZC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYFBsZWFzZSB1cGdyYWRlIHRvIHZlcnNpb24gNy4zIG9yIGhpZ2hlcmApO1xuICB9XG4gIHJldHVybiB2ZXJzaW9uO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24gKCkge1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBkZXRlcm1pbmUgaU9TIFNESyB2ZXJzaW9uOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG59XG5cbi8qKlxuICogR2V0IHRoZSBnZW5lcmljIHNpbXVsYXRvciBmb3IgYSBnaXZlbiBJT1MgdmVyc2lvbiBhbmQgZGV2aWNlIHR5cGUgKGlQaG9uZSwgaVBhZClcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHBsYXRmb3JtVmVyc2lvbiBJT1MgdmVyc2lvbi4gZS5nLikgMTMuMFxuICogQHBhcmFtIHtzdHJpbmd9IGRldmljZU5hbWUgVHlwZSBvZiBJT1MgZGV2aWNlLiBDYW4gYmUgaVBob25lLCBpUGFkIChwb3NzaWJseSBtb3JlIGluIHRoZSBmdXR1cmUpXG4gKlxuICogQHJldHVybnMge3N0cmluZ30gR2VuZXJpYyBpUGhvbmUgb3IgaVBhZCBzaW11bGF0b3IgKGlmIGFwcGxpY2FibGUpXG4gKi9cbmZ1bmN0aW9uIGdldEdlbmVyaWNTaW11bGF0b3JGb3JJb3NWZXJzaW9uIChwbGF0Zm9ybVZlcnNpb24sIGRldmljZU5hbWUpIHtcbiAgbGV0IGdlbmVyaWNTaW11bGF0b3JzID0gaW9zR2VuZXJpY1NpbXVsYXRvcnNbZGV2aWNlTmFtZV07XG5cbiAgaWYgKGdlbmVyaWNTaW11bGF0b3JzKSB7XG4gICAgZ2VuZXJpY1NpbXVsYXRvcnMgPSBnZW5lcmljU2ltdWxhdG9ycy5zb3J0KChbc2ltT25lXSwgW3NpbVR3b10pID0+IHV0aWwuY29tcGFyZVZlcnNpb25zKHNpbU9uZSwgJzwnLCBzaW1Ud28pID8gLTEgOiAxKTtcblxuICAgIC8vIEZpbmQgdGhlIGhpZ2hlc3QgaU9TIHZlcnNpb24gaW4gdGhlIGxpc3QgdGhhdCBpcyBiZWxvdyB0aGUgcHJvdmlkZWQgdmVyc2lvblxuICAgIGxldCBnZW5lcmljSW9zU2ltdWxhdG9yO1xuICAgIGZvciAoY29uc3QgW3BsYXRmb3JtVmVyc2lvbkZyb21MaXN0LCBpb3NTaW11bGF0b3JdIG9mIGdlbmVyaWNTaW11bGF0b3JzKSB7XG4gICAgICBpZiAodXRpbC5jb21wYXJlVmVyc2lvbnMocGxhdGZvcm1WZXJzaW9uRnJvbUxpc3QsICc+JywgcGxhdGZvcm1WZXJzaW9uKSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGdlbmVyaWNJb3NTaW11bGF0b3IgPSBpb3NTaW11bGF0b3I7XG4gICAgfVxuICAgIHJldHVybiBnZW5lcmljSW9zU2ltdWxhdG9yO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyYW5zbGF0ZURldmljZU5hbWUgKHBsYXRmb3JtVmVyc2lvbiwgZGV2aWNlTmFtZSA9ICcnKSB7XG4gIGNvbnN0IGRldmljZU5hbWVUcmFuc2xhdGVkID0gZ2V0R2VuZXJpY1NpbXVsYXRvckZvcklvc1ZlcnNpb24ocGxhdGZvcm1WZXJzaW9uLCBkZXZpY2VOYW1lLnRvTG93ZXJDYXNlKCkudHJpbSgpKTtcbiAgaWYgKGRldmljZU5hbWVUcmFuc2xhdGVkKSB7XG4gICAgbG9nLmRlYnVnKGBDaGFuZ2luZyBkZXZpY2VOYW1lIGZyb20gJyR7ZGV2aWNlTmFtZX0nIHRvICcke2RldmljZU5hbWVUcmFuc2xhdGVkfSdgKTtcbiAgICByZXR1cm4gZGV2aWNlTmFtZVRyYW5zbGF0ZWQ7XG4gIH1cbiAgcmV0dXJuIGRldmljZU5hbWU7XG59XG5cbi8vIFRoaXMgbWFwIGNvbnRhaW5zIGRlcml2ZWQgZGF0YSBsb2dzIGZvbGRlcnMgYXMga2V5c1xuLy8gYW5kIHZhbHVlcyBhcmUgdGhlIGNvdW50IG9mIHRpbWVzIHRoZSBwYXJ0aWN1bGFyXG4vLyBmb2xkZXIgaGFzIGJlZW4gc2NoZWR1bGVkIGZvciByZW1vdmFsXG5jb25zdCBkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzID0gbmV3IE1hcCgpO1xuXG5hc3luYyBmdW5jdGlvbiBtYXJrU3lzdGVtRmlsZXNGb3JDbGVhbnVwICh3ZGEpIHtcbiAgaWYgKCF3ZGEgfHwgIWF3YWl0IHdkYS5yZXRyaWV2ZURlcml2ZWREYXRhUGF0aCgpKSB7XG4gICAgbG9nLndhcm4oJ05vIFdlYkRyaXZlckFnZW50IGRlcml2ZWQgZGF0YSBhdmFpbGFibGUsIHNvIHVuYWJsZSB0byBtYXJrIHN5c3RlbSBmaWxlcyBmb3IgY2xlYW51cCcpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGxvZ3NSb290ID0gcGF0aC5yZXNvbHZlKGF3YWl0IHdkYS5yZXRyaWV2ZURlcml2ZWREYXRhUGF0aCgpLCAnTG9ncycpO1xuICBsZXQgbWFya2Vyc0NvdW50ID0gMDtcbiAgaWYgKGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuaGFzKGxvZ3NSb290KSkge1xuICAgIG1hcmtlcnNDb3VudCA9IGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuZ2V0KGxvZ3NSb290KTtcbiAgfVxuICBkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLnNldChsb2dzUm9vdCwgKyttYXJrZXJzQ291bnQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjbGVhclN5c3RlbUZpbGVzICh3ZGEpIHtcbiAgLy8gb25seSB3YW50IHRvIGNsZWFyIHRoZSBzeXN0ZW0gZmlsZXMgZm9yIHRoZSBwYXJ0aWN1bGFyIFdEQSB4Y29kZSBydW5cbiAgaWYgKCF3ZGEgfHwgIWF3YWl0IHdkYS5yZXRyaWV2ZURlcml2ZWREYXRhUGF0aCgpKSB7XG4gICAgbG9nLndhcm4oJ05vIFdlYkRyaXZlckFnZW50IGRlcml2ZWQgZGF0YSBhdmFpbGFibGUsIHNvIHVuYWJsZSB0byBjbGVhciBzeXN0ZW0gZmlsZXMnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBsb2dzUm9vdCA9IHBhdGgucmVzb2x2ZShhd2FpdCB3ZGEucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKSwgJ0xvZ3MnKTtcbiAgaWYgKGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuaGFzKGxvZ3NSb290KSkge1xuICAgIGxldCBtYXJrZXJzQ291bnQgPSBkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLmdldChsb2dzUm9vdCk7XG4gICAgZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5zZXQobG9nc1Jvb3QsIC0tbWFya2Vyc0NvdW50KTtcbiAgICBpZiAobWFya2Vyc0NvdW50ID4gMCkge1xuICAgICAgbG9nLmluZm8oYE5vdCBjbGVhbmluZyAnJHtsb2dzUm9vdH0nIGZvbGRlciwgYmVjYXVzZSB0aGUgb3RoZXIgc2Vzc2lvbiBkb2VzIG5vdCBleHBlY3QgaXQgdG8gYmUgY2xlYW5lZGApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLnNldChsb2dzUm9vdCwgMCk7XG5cbiAgLy8gQ2xlYW5pbmcgdXAgYmlnIHRlbXBvcmFyeSBmaWxlcyBjcmVhdGVkIGJ5IFhDVGVzdDogaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzk0MTBcbiAgY29uc3QgZ2xvYlBhdHRlcm4gPSBgJHtvcy50bXBkaXIoKX0vJHtYQ1RFU1RfTE9HU19DQUNIRV9GT0xERVJfUFJFRklYfSovYDtcbiAgY29uc3QgZHN0Rm9sZGVycyA9IGF3YWl0IGZzLmdsb2IoZ2xvYlBhdHRlcm4pO1xuICBpZiAoXy5pc0VtcHR5KGRzdEZvbGRlcnMpKSB7XG4gICAgbG9nLmRlYnVnKGBEaWQgbm90IGZpbmQgdGhlIHRlbXBvcmFyeSBYQ1Rlc3QgbG9ncyByb290IGF0ICcke2dsb2JQYXR0ZXJufSdgKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBwZXJmb3JtIHRoZSBjbGVhbnVwIGFzeW5jaHJvbm91c2x5XG4gICAgZm9yIChjb25zdCBkc3RGb2xkZXIgb2YgZHN0Rm9sZGVycykge1xuICAgICAgbGV0IHNjaGVkdWxlZEZpbGVzQ291bnQgPSAwO1xuICAgICAgQi5yZXNvbHZlKGZzLndhbGtEaXIoZHN0Rm9sZGVyLCB0cnVlLCAoaXRlbVBhdGgsIGlzRGlyKSA9PiB7XG4gICAgICAgIGlmIChpc0Rpcikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHBhdGguYmFzZW5hbWUoaXRlbVBhdGgpO1xuICAgICAgICBpZiAoIVhDVEVTVF9MT0dfRklMRVNfUEFUVEVSTlMuc29tZSgocCkgPT4gcC50ZXN0KGZpbGVOYW1lKSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkZWxldGUgdGhlIGZpbGUgYXN5bmNocm9ub3VzbHlcbiAgICAgICAgZnMudW5saW5rKGl0ZW1QYXRoKS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgIGxvZy5pbmZvKGUubWVzc2FnZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzY2hlZHVsZWRGaWxlc0NvdW50Kys7XG4gICAgICB9KSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGlmIChzY2hlZHVsZWRGaWxlc0NvdW50ID4gMCkge1xuICAgICAgICAgIGxvZy5pbmZvKGBTY2hlZHVsZWQgJHtzY2hlZHVsZWRGaWxlc0NvdW50fSB0ZW1wb3JhcnkgWENUZXN0IGxvZyBgICtcbiAgICAgICAgICAgIGAke3V0aWwucGx1cmFsaXplKCdmaWxlJywgc2NoZWR1bGVkRmlsZXNDb3VudCl9IGZvciBjbGVhbnVwIGluICcke2RzdEZvbGRlcn0nYCk7XG4gICAgICAgIH1cbiAgICAgIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIGxvZy5pbmZvKGUubWVzc2FnZSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBTdGFydGVkIGJhY2tncm91bmQgWENUZXN0IGxvZ3MgY2xlYW51cCBpbiAnJHtkc3RGb2xkZXJzfSdgKTtcbiAgfVxuXG4gIGlmIChhd2FpdCBmcy5leGlzdHMobG9nc1Jvb3QpKSB7XG4gICAgbG9nLmluZm8oYENsZWFuaW5nIHRlc3QgbG9ncyBpbiAnJHtsb2dzUm9vdH0nIGZvbGRlcmApO1xuICAgIGF3YWl0IGlvc1V0aWxzLmNsZWFyTG9ncyhbbG9nc1Jvb3RdKTtcbiAgICByZXR1cm47XG4gIH1cbiAgbG9nLmluZm8oYFRoZXJlIGlzIG5vICR7bG9nc1Jvb3R9IGZvbGRlciwgc28gbm90IGNsZWFuaW5nIGZpbGVzYCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNoZWNrQXBwUHJlc2VudCAoYXBwKSB7XG4gIGxvZy5kZWJ1ZyhgQ2hlY2tpbmcgd2hldGhlciBhcHAgJyR7YXBwfScgaXMgYWN0dWFsbHkgcHJlc2VudCBvbiBmaWxlIHN5c3RlbWApO1xuICBpZiAoIShhd2FpdCBmcy5leGlzdHMoYXBwKSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGZpbmQgYXBwIGF0ICcke2FwcH0nYCk7XG4gIH1cbiAgbG9nLmRlYnVnKCdBcHAgaXMgcHJlc2VudCcpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXREcml2ZXJJbmZvICgpIHtcbiAgY29uc3Qgc3RhdCA9IGF3YWl0IGZzLnN0YXQocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJykpO1xuICBjb25zdCBidWlsdCA9IHN0YXQubXRpbWUuZ2V0VGltZSgpO1xuXG4gIC8vIGdldCB0aGUgcGFja2FnZS5qc29uIGFuZCB0aGUgdmVyc2lvbiBmcm9tIGl0XG4gIGNvbnN0IHBrZyA9IHJlcXVpcmUoX19maWxlbmFtZS5pbmNsdWRlcygnYnVpbGQvbGliL3V0aWxzJykgPyAnLi4vLi4vcGFja2FnZS5qc29uJyA6ICcuLi9wYWNrYWdlLmpzb24nKTtcbiAgY29uc3QgdmVyc2lvbiA9IHBrZy52ZXJzaW9uO1xuXG4gIHJldHVybiB7XG4gICAgYnVpbHQsXG4gICAgdmVyc2lvbixcbiAgfTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplQ29tbWFuZFRpbWVvdXRzICh2YWx1ZSkge1xuICAvLyBUaGUgdmFsdWUgaXMgbm9ybWFsaXplZCBhbHJlYWR5XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgbGV0IHJlc3VsdCA9IHt9O1xuICAvLyBVc2UgYXMgZGVmYXVsdCB0aW1lb3V0IGZvciBhbGwgY29tbWFuZHMgaWYgYSBzaW5nbGUgaW50ZWdlciB2YWx1ZSBpcyBwcm92aWRlZFxuICBpZiAoIWlzTmFOKHZhbHVlKSkge1xuICAgIHJlc3VsdFtERUZBVUxUX1RJTUVPVVRfS0VZXSA9IF8udG9JbnRlZ2VyKHZhbHVlKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gSlNPTiBvYmplY3QgaGFzIGJlZW4gcHJvdmlkZWQuIExldCdzIHBhcnNlIGl0XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh2YWx1ZSk7XG4gICAgaWYgKCFfLmlzUGxhaW5PYmplY3QocmVzdWx0KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgXCJjb21tYW5kVGltZW91dHNcIiBjYXBhYmlsaXR5IHNob3VsZCBiZSBhIHZhbGlkIEpTT04gb2JqZWN0LiBcIiR7dmFsdWV9XCIgd2FzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICBmb3IgKGxldCBbY21kLCB0aW1lb3V0XSBvZiBfLnRvUGFpcnMocmVzdWx0KSkge1xuICAgIGlmICghXy5pc0ludGVnZXIodGltZW91dCkgfHwgdGltZW91dCA8PSAwKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIHRpbWVvdXQgZm9yIFwiJHtjbWR9XCIgc2hvdWxkIGJlIGEgdmFsaWQgbmF0dXJhbCBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLiBcIiR7dGltZW91dH1cIiB3YXMgZ2l2ZW4gaW5zdGVhZGApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5hc3luYyBmdW5jdGlvbiBwcmludFVzZXIgKCkge1xuICB0cnkge1xuICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3dob2FtaScpO1xuICAgIGxvZy5kZWJ1ZyhgQ3VycmVudCB1c2VyOiAnJHtzdGRvdXQudHJpbSgpfSdgKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmRlYnVnKGBVbmFibGUgdG8gZ2V0IHVzZXJuYW1lIHJ1bm5pbmcgc2VydmVyOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG59XG5cbi8qKlxuICogR2V0IHRoZSBJRHMgb2YgcHJvY2Vzc2VzIGxpc3RlbmluZyBvbiB0aGUgcGFydGljdWxhciBzeXN0ZW0gcG9ydC5cbiAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gYXBwbHkgYWRkaXRpb25hbCBmaWx0ZXJpbmcgYmFzZWQgb24gdGhlXG4gKiBwcm9jZXNzIGNvbW1hbmQgbGluZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHBvcnQgLSBUaGUgcG9ydCBudW1iZXIuXG4gKiBAcGFyYW0gez9GdW5jdGlvbn0gZmlsdGVyaW5nRnVuYyAtIE9wdGlvbmFsIGxhbWJkYSBmdW5jdGlvbiwgd2hpY2hcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXMgY29tbWFuZCBsaW5lIHN0cmluZyBvZiB0aGUgcGFydGljdWxhciBwcm9jZXNzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmluZyBvbiBnaXZlbiBwb3J0LCBhbmQgaXMgZXhwZWN0ZWQgdG8gcmV0dXJuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVpdGhlciB0cnVlIG9yIGZhbHNlIHRvIGluY2x1ZGUvZXhjbHVkZSB0aGUgY29ycmVzcG9uZGluZyBQSURcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSB0aGUgcmVzdWx0aW5nIGFycmF5LlxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IC0gdGhlIGxpc3Qgb2YgbWF0Y2hlZCBwcm9jZXNzIGlkcy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0UElEc0xpc3RlbmluZ09uUG9ydCAocG9ydCwgZmlsdGVyaW5nRnVuYyA9IG51bGwpIHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIHRyeSB7XG4gICAgLy8gVGhpcyBvbmx5IHdvcmtzIHNpbmNlIE1hYyBPUyBYIEVsIENhcGl0YW5cbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2xzb2YnLCBbJy10aScsIGB0Y3A6JHtwb3J0fWBdKTtcbiAgICByZXN1bHQucHVzaCguLi4oc3Rkb3V0LnRyaW0oKS5zcGxpdCgvXFxuKy8pKSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgaWYgKCFfLmlzRnVuY3Rpb24oZmlsdGVyaW5nRnVuYykpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIHJldHVybiBhd2FpdCBCLmZpbHRlcihyZXN1bHQsIGFzeW5jICh4KSA9PiB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdwcycsIFsnLXAnLCB4LCAnLW8nLCAnY29tbWFuZCddKTtcbiAgICByZXR1cm4gYXdhaXQgZmlsdGVyaW5nRnVuYyhzdGRvdXQpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBVcGxvYWRPcHRpb25zXG4gKlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB1c2VyIC0gVGhlIG5hbWUgb2YgdGhlIHVzZXIgZm9yIHRoZSByZW1vdGUgYXV0aGVudGljYXRpb24uIE9ubHkgd29ya3MgaWYgYHJlbW90ZVBhdGhgIGlzIHByb3ZpZGVkLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBwYXNzIC0gVGhlIHBhc3N3b3JkIGZvciB0aGUgcmVtb3RlIGF1dGhlbnRpY2F0aW9uLiBPbmx5IHdvcmtzIGlmIGByZW1vdGVQYXRoYCBpcyBwcm92aWRlZC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gbWV0aG9kIC0gVGhlIGh0dHAgbXVsdGlwYXJ0IHVwbG9hZCBtZXRob2QgbmFtZS4gVGhlICdQVVQnIG9uZSBpcyB1c2VkIGJ5IGRlZmF1bHQuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9ubHkgd29ya3MgaWYgYHJlbW90ZVBhdGhgIGlzIHByb3ZpZGVkLlxuICogQHByb3BlcnR5IHs/T2JqZWN0fSBoZWFkZXJzIC0gQWRkaXRpb25hbCBoZWFkZXJzIG1hcHBpbmcgZm9yIG11bHRpcGFydCBodHRwKHMpIHVwbG9hZHNcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gZmlsZUZpZWxkTmFtZSBbZmlsZV0gLSBUaGUgbmFtZSBvZiB0aGUgZm9ybSBmaWVsZCwgd2hlcmUgdGhlIGZpbGUgY29udGVudCBCTE9CIHNob3VsZCBiZSBzdG9yZWQgZm9yXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cChzKSB1cGxvYWRzXG4gKiBAcHJvcGVydHkgez9PYmplY3R8QXJyYXk8UGFpcj59IGZvcm1GaWVsZHMgLSBBZGRpdGlvbmFsIGZvcm0gZmllbGRzIGZvciBtdWx0aXBhcnQgaHR0cChzKSB1cGxvYWRzXG4gKi9cblxuXG4vKipcbiAqIEVuY29kZXMgdGhlIGdpdmVuIGxvY2FsIGZpbGUgdG8gYmFzZTY0IGFuZCByZXR1cm5zIHRoZSByZXN1bHRpbmcgc3RyaW5nXG4gKiBvciB1cGxvYWRzIGl0IHRvIGEgcmVtb3RlIHNlcnZlciB1c2luZyBodHRwL2h0dHBzIG9yIGZ0cCBwcm90b2NvbHNcbiAqIGlmIGByZW1vdGVQYXRoYCBpcyBzZXRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxQYXRoIC0gVGhlIHBhdGggdG8gYW4gZXhpc3RpbmcgbG9jYWwgZmlsZVxuICogQHBhcmFtIHs/c3RyaW5nfSByZW1vdGVQYXRoIC0gVGhlIHBhdGggdG8gdGhlIHJlbW90ZSBsb2NhdGlvbiwgd2hlcmVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMgZmlsZSBzaG91bGQgYmUgdXBsb2FkZWRcbiAqIEBwYXJhbSB7P1VwbG9hZE9wdGlvbnN9IHVwbG9hZE9wdGlvbnMgLSBTZXQgb2YgdXBsb2FkIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEVpdGhlciBhbiBlbXB0eSBzdHJpbmcgaWYgdGhlIHVwbG9hZCB3YXMgc3VjY2Vzc2Z1bCBvclxuICogYmFzZTY0LWVuY29kZWQgZmlsZSByZXByZXNlbnRhdGlvbiBpZiBgcmVtb3RlUGF0aGAgaXMgZmFsc3lcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZW5jb2RlQmFzZTY0T3JVcGxvYWQgKGxvY2FsUGF0aCwgcmVtb3RlUGF0aCA9IG51bGwsIHVwbG9hZE9wdGlvbnMgPSB7fSkge1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhsb2NhbFBhdGgpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFRoZSBmaWxlIGF0ICcke2xvY2FsUGF0aH0nIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlYCk7XG4gIH1cblxuICBpZiAoXy5pc0VtcHR5KHJlbW90ZVBhdGgpKSB7XG4gICAgY29uc3Qge3NpemV9ID0gYXdhaXQgZnMuc3RhdChsb2NhbFBhdGgpO1xuICAgIGxvZy5kZWJ1ZyhgVGhlIHNpemUgb2YgdGhlIGZpbGUgaXMgJHt1dGlsLnRvUmVhZGFibGVTaXplU3RyaW5nKHNpemUpfWApO1xuICAgIHJldHVybiAoYXdhaXQgdXRpbC50b0luTWVtb3J5QmFzZTY0KGxvY2FsUGF0aCkpLnRvU3RyaW5nKCk7XG4gIH1cblxuICBjb25zdCB7dXNlciwgcGFzcywgbWV0aG9kLCBoZWFkZXJzLCBmaWxlRmllbGROYW1lLCBmb3JtRmllbGRzfSA9IHVwbG9hZE9wdGlvbnM7XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgbWV0aG9kOiBtZXRob2QgfHwgJ1BVVCcsXG4gICAgaGVhZGVycyxcbiAgICBmaWxlRmllbGROYW1lLFxuICAgIGZvcm1GaWVsZHMsXG4gIH07XG4gIGlmICh1c2VyICYmIHBhc3MpIHtcbiAgICBvcHRpb25zLmF1dGggPSB7dXNlciwgcGFzc307XG4gIH1cbiAgYXdhaXQgbmV0LnVwbG9hZEZpbGUobG9jYWxQYXRoLCByZW1vdGVQYXRoLCBvcHRpb25zKTtcbiAgcmV0dXJuICcnO1xufVxuXG4vKipcbiAqIFN0b3BzIGFuZCByZW1vdmVzIGFsbCB3ZWIgc29ja2V0IGhhbmRsZXJzIHRoYXQgYXJlIGxpc3RlbmluZ1xuICogaW4gc2NvcGUgb2YgdGhlIGN1cnJlY3Qgc2Vzc2lvbi5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gc2VydmVyIC0gVGhlIGluc3RhbmNlIG9mIE5vZGVKcyBIVFRQIHNlcnZlcixcbiAqIHdoaWNoIGhvc3RzIEFwcGl1bVxuICogQHBhcmFtIHtzdHJpbmd9IHNlc3Npb25JZCAtIFRoZSBpZCBvZiB0aGUgY3VycmVudCBzZXNzaW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyAoc2VydmVyLCBzZXNzaW9uSWQpIHtcbiAgaWYgKCFzZXJ2ZXIgfHwgIV8uaXNGdW5jdGlvbihzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlSGFuZGxlcnMgPSBhd2FpdCBzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMoc2Vzc2lvbklkKTtcbiAgZm9yIChjb25zdCBwYXRobmFtZSBvZiBfLmtleXMoYWN0aXZlSGFuZGxlcnMpKSB7XG4gICAgYXdhaXQgc2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIocGF0aG5hbWUpO1xuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUGxhdGZvcm1PcHRzXG4gKlxuICogQHByb3BlcnR5IHtib29sZWFufSBpc1NpbXVsYXRvciAtIFdoZXRoZXIgdGhlIGRlc3RpbmF0aW9uIHBsYXRmb3JtIGlzIGEgU2ltdWxhdG9yXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzVHZPUyAtIFdoZXRoZXIgdGhlIGRlc3RpbmF0aW9uIHBsYXRmb3JtIGlzIGEgU2ltdWxhdG9yXG4gKi9cblxuLyoqXG4gKiBWZXJpZnkgd2hldGhlciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gaXMgY29tcGF0aWJsZSB0byB0aGVcbiAqIHBsYXRmb3JtIHdoZXJlIGl0IGlzIGdvaW5nIHRvIGJlIGluc3RhbGxlZCBhbmQgdGVzdGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHAgLSBUaGUgYWN0dWFsIHBhdGggdG8gdGhlIGFwcGxpY2F0aW9uIGJ1bmRsZVxuICogQHBhcmFtIHtQbGF0Zm9ybU9wdHN9IGV4cGVjdGVkUGxhdGZvcm1cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBidW5kbGUgYXJjaGl0ZWN0dXJlIGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZCBkZXZpY2UgYXJjaGl0ZWN0dXJlLlxuICovXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlBcHBsaWNhdGlvblBsYXRmb3JtIChhcHAsIGV4cGVjdGVkUGxhdGZvcm0pIHtcbiAgbG9nLmRlYnVnKCdWZXJpZnlpbmcgYXBwbGljYXRpb24gcGxhdGZvcm0nKTtcblxuICBjb25zdCBpbmZvUGxpc3QgPSBwYXRoLnJlc29sdmUoYXBwLCAnSW5mby5wbGlzdCcpO1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhpbmZvUGxpc3QpKSB7XG4gICAgbG9nLmRlYnVnKGAnJHtpbmZvUGxpc3R9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHtDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3Jtc30gPSBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShpbmZvUGxpc3QpO1xuICBsb2cuZGVidWcoYENGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zOiAke0pTT04uc3RyaW5naWZ5KENGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zKX1gKTtcbiAgaWYgKCFfLmlzQXJyYXkoQ0ZCdW5kbGVTdXBwb3J0ZWRQbGF0Zm9ybXMpKSB7XG4gICAgbG9nLmRlYnVnKGBDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3JtcyBrZXkgZG9lcyBub3QgZXhpc3QgaW4gJyR7aW5mb1BsaXN0fSdgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB7XG4gICAgaXNTaW11bGF0b3IsXG4gICAgaXNUdk9TLFxuICB9ID0gZXhwZWN0ZWRQbGF0Zm9ybTtcbiAgY29uc3QgcHJlZml4ID0gaXNUdk9TID8gJ0FwcGxlVFYnIDogJ2lQaG9uZSc7XG4gIGNvbnN0IHN1ZmZpeCA9IGlzU2ltdWxhdG9yID8gJ1NpbXVsYXRvcicgOiAnT1MnO1xuICBjb25zdCBkc3RQbGF0Zm9ybSA9IGAke3ByZWZpeH0ke3N1ZmZpeH1gO1xuICBpZiAoIUNGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zLmluY2x1ZGVzKGRzdFBsYXRmb3JtKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtpc1NpbXVsYXRvciA/ICdTaW11bGF0b3InIDogJ1JlYWwgZGV2aWNlJ30gYXJjaGl0ZWN0dXJlIGlzIHVuc3VwcG9ydGVkIGJ5IHRoZSAnJHthcHB9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICBgTWFrZSBzdXJlIHRoZSBjb3JyZWN0IGRlcGxveW1lbnQgdGFyZ2V0IGhhcyBiZWVuIHNlbGVjdGVkIGZvciBpdHMgY29tcGlsYXRpb24gaW4gWGNvZGUuYCk7XG4gIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqIEBwYXJhbSB7P3N0cmluZ30gdXJsU3RyaW5nXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJuIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqL1xuZnVuY3Rpb24gaXNMb2NhbEhvc3QgKHVybFN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHtob3N0bmFtZX0gPSB1cmwucGFyc2UodXJsU3RyaW5nKTtcbiAgICByZXR1cm4gWydsb2NhbGhvc3QnLCAnMTI3LjAuMC4xJywgJzo6MScsICc6OmZmZmY6MTI3LjAuMC4xJ10uaW5jbHVkZXMoaG9zdG5hbWUpO1xuICB9IGNhdGNoIChpZ24pIHtcbiAgICBsb2cud2FybihgJyR7dXJsU3RyaW5nfScgY2Fubm90IGJlIHBhcnNlZCBhcyBhIHZhbGlkIFVSTGApO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBOb3JtYWxpemVzIHBsYXRmb3JtVmVyc2lvbiB0byBhIHZhbGlkIGlPUyB2ZXJzaW9uIHN0cmluZ1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcmlnaW5hbFZlcnNpb24gLSBMb29zZSB2ZXJzaW9uIG51bWJlciwgdGhhdCBjYW4gYmUgcGFyc2VkIGJ5IHNlbXZlclxuICogQHJldHVybiB7c3RyaW5nfSBpT1MgdmVyc2lvbiBudW1iZXIgaW4gPG1ham9yPi48bWlub3I+IGZvcm1hdFxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSB2ZXJzaW9uIG51bWJlciBjYW5ub3QgYmUgcGFyc2VkXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbiAob3JpZ2luYWxWZXJzaW9uKSB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRWZXJzaW9uID0gc2VtdmVyLmNvZXJjZShvcmlnaW5hbFZlcnNpb24pO1xuICBpZiAoIW5vcm1hbGl6ZWRWZXJzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGxhdGZvcm0gdmVyc2lvbiAnJHtvcmlnaW5hbFZlcnNpb259JyBzaG91bGQgYmUgYSB2YWxpZCB2ZXJzaW9uIG51bWJlcmApO1xuICB9XG4gIHJldHVybiBgJHtub3JtYWxpemVkVmVyc2lvbi5tYWpvcn0uJHtub3JtYWxpemVkVmVyc2lvbi5taW5vcn1gO1xufVxuXG5cbmV4cG9ydCB7IGRldGVjdFVkaWQsIGdldEFuZENoZWNrWGNvZGVWZXJzaW9uLCBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24sXG4gIGNoZWNrQXBwUHJlc2VudCwgZ2V0RHJpdmVySW5mbyxcbiAgY2xlYXJTeXN0ZW1GaWxlcywgdHJhbnNsYXRlRGV2aWNlTmFtZSwgbm9ybWFsaXplQ29tbWFuZFRpbWVvdXRzLFxuICBERUZBVUxUX1RJTUVPVVRfS0VZLCBtYXJrU3lzdGVtRmlsZXNGb3JDbGVhbnVwLCBwcmludFVzZXIsXG4gIGdldFBJRHNMaXN0ZW5pbmdPblBvcnQsIGVuY29kZUJhc2U2NE9yVXBsb2FkLCByZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMsXG4gIHZlcmlmeUFwcGxpY2F0aW9uUGxhdGZvcm0sIGlzTG9jYWxIb3N0LCBub3JtYWxpemVQbGF0Zm9ybVZlcnNpb24gfTtcbiJdLCJmaWxlIjoibGliL3V0aWxzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
