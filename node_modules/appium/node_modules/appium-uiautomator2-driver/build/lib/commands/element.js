"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _appiumBaseDriver = require("appium-base-driver");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

function toBool(s) {
  return _lodash.default.isString(s) ? s.toLowerCase() === 'true' : !!s;
}

commands.getAttribute = async function (attribute, elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/attribute/${attribute}`, 'GET', {});
};

commands.elementDisplayed = async function (elementId) {
  return toBool(await this.getAttribute('displayed', elementId));
};

commands.elementEnabled = async function (elementId) {
  return toBool(await this.getAttribute('enabled', elementId));
};

commands.elementSelected = async function (elementId) {
  return toBool(await this.getAttribute('selected', elementId));
};

commands.getName = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/name`, 'GET', {});
};

commands.getLocation = async function (elementId) {
  _logger.default.info(`calling get location: ${elementId}`);

  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/location`, 'GET', {});
};

commands.getSize = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/size`, 'GET', {});
};

commands.touchLongClick = async function (element, x, y, duration) {
  let params = {
    element,
    x,
    y,
    duration
  };
  return await this.uiautomator2.jwproxy.command(`/touch/longclick`, 'POST', {
    params
  });
};

commands.touchDown = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/down`, 'POST', {
    params
  });
};

commands.touchUp = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/up`, 'POST', {
    params
  });
};

commands.touchMove = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/move`, 'POST', {
    params
  });
};

helpers.doSetElementValue = async function (params) {
  return await this.uiautomator2.jwproxy.command(`/element/${params.elementId}/value`, 'POST', params);
};

commands.setValueImmediate = async function (keys, elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/value`, 'POST', {
    elementId,
    text: _lodash.default.isArray(keys) ? keys.join('') : keys,
    replace: false,
    unicodeKeyboard: this.opts.unicodeKeyboard
  });
};

commands.getText = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/text`, 'GET', {});
};

commands.click = async function (element) {
  return await this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', {
    element
  });
};

commands.getElementScreenshot = async function (element) {
  return await this.uiautomator2.jwproxy.command(`/element/${element}/screenshot`, 'GET', {});
};

commands.tap = async function (elementId = null, x = null, y = null, count = 1) {
  const areCoordinatesDefined = _appiumSupport.util.hasValue(x) && _appiumSupport.util.hasValue(y);

  if (!_appiumSupport.util.hasValue(elementId) && !areCoordinatesDefined) {
    throw new Error(`Either element id to tap or both absolute coordinates should be defined`);
  }

  for (let i = 0; i < count; i++) {
    if (_appiumSupport.util.hasValue(elementId) && !areCoordinatesDefined) {
      await this.uiautomator2.jwproxy.command(`/element/${elementId}/click`, 'POST');
    } else {
      await this.uiautomator2.jwproxy.command(`/appium/tap`, 'POST', {
        x,
        y,
        [_appiumBaseDriver.W3C_ELEMENT_KEY]: elementId
      });
    }
  }
};

commands.clear = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/clear`, 'POST', {
    elementId
  });
};

commands.getElementRect = async function (elementId) {
  if (this.isWebContext()) {
    _logger.default.debug(`Detected downstream chromedriver protocol: ${this.chromedriver.jwproxy.downstreamProtocol}`);

    if (this.chromedriver.jwproxy.downstreamProtocol === _appiumBaseDriver.PROTOCOLS.MJSONWP) {
      const {
        x,
        y
      } = await this.chromedriver.jwproxy.command(`/element/${elementId}/location`, 'GET');
      const {
        width,
        height
      } = await this.chromedriver.jwproxy.command(`/element/${elementId}/size`, 'GET');
      return {
        x,
        y,
        width,
        height
      };
    }

    return await this.chromedriver.jwproxy.command(`/element/${elementId}/rect`, 'GET');
  }

  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/rect`, 'GET');
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJ0b0Jvb2wiLCJzIiwiXyIsImlzU3RyaW5nIiwidG9Mb3dlckNhc2UiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbGVtZW50SWQiLCJ1aWF1dG9tYXRvcjIiLCJqd3Byb3h5IiwiY29tbWFuZCIsImVsZW1lbnREaXNwbGF5ZWQiLCJlbGVtZW50RW5hYmxlZCIsImVsZW1lbnRTZWxlY3RlZCIsImdldE5hbWUiLCJnZXRMb2NhdGlvbiIsImxvZyIsImluZm8iLCJnZXRTaXplIiwidG91Y2hMb25nQ2xpY2siLCJlbGVtZW50IiwieCIsInkiLCJkdXJhdGlvbiIsInBhcmFtcyIsInRvdWNoRG93biIsInRvdWNoVXAiLCJ0b3VjaE1vdmUiLCJkb1NldEVsZW1lbnRWYWx1ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwia2V5cyIsInRleHQiLCJpc0FycmF5Iiwiam9pbiIsInJlcGxhY2UiLCJ1bmljb2RlS2V5Ym9hcmQiLCJvcHRzIiwiZ2V0VGV4dCIsImNsaWNrIiwiZ2V0RWxlbWVudFNjcmVlbnNob3QiLCJ0YXAiLCJjb3VudCIsImFyZUNvb3JkaW5hdGVzRGVmaW5lZCIsInV0aWwiLCJoYXNWYWx1ZSIsIkVycm9yIiwiaSIsIlczQ19FTEVNRU5UX0tFWSIsImNsZWFyIiwiZ2V0RWxlbWVudFJlY3QiLCJpc1dlYkNvbnRleHQiLCJkZWJ1ZyIsImNocm9tZWRyaXZlciIsImRvd25zdHJlYW1Qcm90b2NvbCIsIlBST1RPQ09MUyIsIk1KU09OV1AiLCJ3aWR0aCIsImhlaWdodCIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVB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QjtBQUN2QmxDLG9CQUFJbUMsS0FBSixDQUFXLDhDQUE2QyxLQUFLQyxZQUFMLENBQWtCM0MsT0FBbEIsQ0FBMEI0QyxrQkFBbUIsRUFBckc7O0FBQ0EsUUFBSSxLQUFLRCxZQUFMLENBQWtCM0MsT0FBbEIsQ0FBMEI0QyxrQkFBMUIsS0FBaURDLDRCQUFVQyxPQUEvRCxFQUF3RTtBQUN0RSxZQUFNO0FBQUNsQyxRQUFBQSxDQUFEO0FBQUlDLFFBQUFBO0FBQUosVUFBUyxNQUFNLEtBQUs4QixZQUFMLENBQWtCM0MsT0FBbEIsQ0FBMEJDLE9BQTFCLENBQW1DLFlBQVdILFNBQVUsV0FBeEQsRUFBb0UsS0FBcEUsQ0FBckI7QUFDQSxZQUFNO0FBQUNpRCxRQUFBQSxLQUFEO0FBQVFDLFFBQUFBO0FBQVIsVUFBa0IsTUFBTSxLQUFLTCxZQUFMLENBQWtCM0MsT0FBbEIsQ0FBMEJDLE9BQTFCLENBQW1DLFlBQVdILFNBQVUsT0FBeEQsRUFBZ0UsS0FBaEUsQ0FBOUI7QUFDQSxhQUFPO0FBQUNjLFFBQUFBLENBQUQ7QUFBSUMsUUFBQUEsQ0FBSjtBQUFPa0MsUUFBQUEsS0FBUDtBQUFjQyxRQUFBQTtBQUFkLE9BQVA7QUFDRDs7QUFDRCxXQUFPLE1BQU0sS0FBS0wsWUFBTCxDQUFrQjNDLE9BQWxCLENBQTBCQyxPQUExQixDQUFtQyxZQUFXSCxTQUFVLE9BQXhELEVBQWdFLEtBQWhFLENBQWI7QUFDRDs7QUFDRCxTQUFPLE1BQU0sS0FBS0MsWUFBTCxDQUFrQkMsT0FBbEIsQ0FBMEJDLE9BQTFCLENBQW1DLFlBQVdILFNBQVUsT0FBeEQsRUFBZ0UsS0FBaEUsQ0FBYjtBQUNELENBWEQ7O0FBYUFtRCxNQUFNLENBQUNDLE1BQVAsQ0FBYzVELFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBQUk9UT0NPTFMsIFczQ19FTEVNRU5UX0tFWSB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuZnVuY3Rpb24gdG9Cb29sIChzKSB7XG4gIHJldHVybiBfLmlzU3RyaW5nKHMpID8gKHMudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnKSA6ICEhcztcbn1cblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9hdHRyaWJ1dGUvJHthdHRyaWJ1dGV9YCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnREaXNwbGF5ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiB0b0Jvb2woYXdhaXQgdGhpcy5nZXRBdHRyaWJ1dGUoJ2Rpc3BsYXllZCcsIGVsZW1lbnRJZCkpO1xufTtcblxuY29tbWFuZHMuZWxlbWVudEVuYWJsZWQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiB0b0Jvb2woYXdhaXQgdGhpcy5nZXRBdHRyaWJ1dGUoJ2VuYWJsZWQnLCBlbGVtZW50SWQpKTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRTZWxlY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIHRvQm9vbChhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZSgnc2VsZWN0ZWQnLCBlbGVtZW50SWQpKTtcbn07XG5cbmNvbW1hbmRzLmdldE5hbWUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9uYW1lYCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICBsb2cuaW5mbyhgY2FsbGluZyBnZXQgbG9jYXRpb246ICR7ZWxlbWVudElkfWApO1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vbG9jYXRpb25gLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L3NpemVgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMudG91Y2hMb25nQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCwgeCwgeSwgZHVyYXRpb24pIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50LCB4LCB5LCBkdXJhdGlvbn07XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC90b3VjaC9sb25nY2xpY2tgLCAnUE9TVCcsIHtwYXJhbXN9KTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoRG93biA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudCwgeCwgeX07XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC90b3VjaC9kb3duYCwgJ1BPU1QnLCB7cGFyYW1zfSk7XG59O1xuXG5jb21tYW5kcy50b3VjaFVwID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHgsIHkpIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50LCB4LCB5fTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL3RvdWNoL3VwYCwgJ1BPU1QnLCB7cGFyYW1zfSk7XG59O1xuXG5jb21tYW5kcy50b3VjaE1vdmUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCwgeCwgeSkge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnQsIHgsIHl9O1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvdG91Y2gvbW92ZWAsICdQT1NUJywge3BhcmFtc30pO1xufTtcblxuaGVscGVycy5kb1NldEVsZW1lbnRWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtwYXJhbXMuZWxlbWVudElkfS92YWx1ZWAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlSW1tZWRpYXRlID0gYXN5bmMgZnVuY3Rpb24gKGtleXMsIGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vdmFsdWVgLCAnUE9TVCcsIHtcbiAgICBlbGVtZW50SWQsXG4gICAgdGV4dDogXy5pc0FycmF5KGtleXMpID8ga2V5cy5qb2luKCcnKSA6IGtleXMsXG4gICAgcmVwbGFjZTogZmFsc2UsXG4gICAgdW5pY29kZUtleWJvYXJkOiB0aGlzLm9wdHMudW5pY29kZUtleWJvYXJkLFxuICB9KTtcbn07XG5cbmNvbW1hbmRzLmdldFRleHQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS90ZXh0YCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50fS9jbGlja2AsICdQT1NUJywge2VsZW1lbnR9KTtcbn07XG5cbmNvbW1hbmRzLmdldEVsZW1lbnRTY3JlZW5zaG90ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50fS9zY3JlZW5zaG90YCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLnRhcCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQgPSBudWxsLCB4ID0gbnVsbCwgeSA9IG51bGwsIGNvdW50ID0gMSkge1xuICBjb25zdCBhcmVDb29yZGluYXRlc0RlZmluZWQgPSB1dGlsLmhhc1ZhbHVlKHgpICYmIHV0aWwuaGFzVmFsdWUoeSk7XG4gIGlmICghdXRpbC5oYXNWYWx1ZShlbGVtZW50SWQpICYmICFhcmVDb29yZGluYXRlc0RlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVpdGhlciBlbGVtZW50IGlkIHRvIHRhcCBvciBib3RoIGFic29sdXRlIGNvb3JkaW5hdGVzIHNob3VsZCBiZSBkZWZpbmVkYCk7XG4gIH1cblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICBpZiAodXRpbC5oYXNWYWx1ZShlbGVtZW50SWQpICYmICFhcmVDb29yZGluYXRlc0RlZmluZWQpIHtcbiAgICAgIC8vIHdlIGFyZSBlaXRoZXIgdGFwcGluZyBvbiB0aGUgZGVmYXVsdCBsb2NhdGlvbiBvZiB0aGUgZWxlbWVudFxuICAgICAgLy8gb3IgYW4gb2Zmc2V0IGZyb20gdGhlIHRvcCBsZWZ0IGNvcm5lclxuICAgICAgYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vY2xpY2tgLCAnUE9TVCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9hcHBpdW0vdGFwYCwgJ1BPU1QnLCB7XG4gICAgICAgIHgsIHksXG4gICAgICAgIFtXM0NfRUxFTUVOVF9LRVldOiBlbGVtZW50SWQsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbW1hbmRzLmNsZWFyID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vY2xlYXJgLCAnUE9TVCcsIHtlbGVtZW50SWR9KTtcbn07XG5cbmNvbW1hbmRzLmdldEVsZW1lbnRSZWN0ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxvZy5kZWJ1ZyhgRGV0ZWN0ZWQgZG93bnN0cmVhbSBjaHJvbWVkcml2ZXIgcHJvdG9jb2w6ICR7dGhpcy5jaHJvbWVkcml2ZXIuandwcm94eS5kb3duc3RyZWFtUHJvdG9jb2x9YCk7XG4gICAgaWYgKHRoaXMuY2hyb21lZHJpdmVyLmp3cHJveHkuZG93bnN0cmVhbVByb3RvY29sID09PSBQUk9UT0NPTFMuTUpTT05XUCkge1xuICAgICAgY29uc3Qge3gsIHl9ID0gYXdhaXQgdGhpcy5jaHJvbWVkcml2ZXIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vbG9jYXRpb25gLCAnR0VUJyk7XG4gICAgICBjb25zdCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmNocm9tZWRyaXZlci5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9zaXplYCwgJ0dFVCcpO1xuICAgICAgcmV0dXJuIHt4LCB5LCB3aWR0aCwgaGVpZ2h0fTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2hyb21lZHJpdmVyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L3JlY3RgLCAnR0VUJyk7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L3JlY3RgLCAnR0VUJyk7XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZWxlbWVudC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
